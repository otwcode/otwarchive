env:
  - TEST_GROUP=importing
  - TEST_GROUP=gift_exchanges
  - TEST_GROUP=prompt_memes
  - TEST_GROUP=collections
  - TEST_GROUP=users
  - TEST_GROUP=works
  - TEST_GROUP=tags_and_wrangling
  - TEST_GROUP=other
before_install:
  - sudo apt-get update -qq
  - sudo apt-get install -qq calibre
  - wget https://wkhtmltopdf.googlecode.com/files/wkhtmltopdf-0.9.9-static-i386.tar.bz2 
  - tar -vxf wkhtmltopdf-0.9.9-static-i386.tar.bz2
  - mv wkhtmltopdf-i386 wkhtmltopdf
  - chmod a+x wkhtmltopdf
  - sudo mv wkhtmltopdf /usr/bin
  - mkdir -p public/downloads/11/22/33/44/55/12345/
  - echo "<html><head><title>Foo</title></head><body><p>Here is a test work</p></body></html>" > public/downloads/11/22/33/44/55/12345/test.html
  - wkhtmltopdf /home/travis/build/otwcode/otwarchive/public/downloads/11/22/33/44/55/12345/test.html /home/travis/build/otwcode/otwarchive/public/downloads/11/22/33/44/55/12345/test.pdf
rvm:
  - "1.9.3"
services:
  - elasticsearch
  - redis-server
  - memcached
script:
  - bundle exec rake db:create:all --trace
  - bundle exec rake db:schema:load --trace
  - RAILS_ENV=test bundle exec rake db:migrate --trace
  - bundle exec cucumber -f progress -r features features/$TEST_GROUP -b
before_script:
  - mysql -e 'create database otwarchive_test;'
  - cp config/database.travis.yml config/database.yml
  - cp config/newrelic.example config/newrelic.yml
  - cp config/redis-cucumber.conf.example config/redis-cucumber.conf
  - cp config/redis.travis.example config/redis.yml
notifications:
  email:
    recipients:
      - otw-coders@transformativeworks.org
    on_success: change
    on_failure: always
  irc:
   channels:
     - "irc.freenode.org#otw-dev"
   on_success: always
   on_failure: always
