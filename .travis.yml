language: ruby
sudo: required
env:
  - TEST_GROUP="./script/check_syntax"
  - TEST_GROUP="bundle exec rspec spec"
  - TEST_GROUP="bundle exec cucumber -f progress -r features features/admins"
  - TEST_GROUP="bundle exec cucumber -f progress -r features features/bookmarks"
  - TEST_GROUP="bundle exec cucumber -f progress -r features features/collections"
  - TEST_GROUP="bundle exec cucumber -f progress -r features features/comments_and_kudos"
  - TEST_GROUP="bundle exec cucumber -f progress -r features features/gift_exchanges"
  - TEST_GROUP="bundle exec cucumber -f progress -r features features/importing"
  - TEST_GROUP="bundle exec cucumber -f progress -r features features/other_a"
  - TEST_GROUP="bundle exec cucumber -f progress -r features features/other_b"
  - TEST_GROUP="bundle exec cucumber -f progress -r features features/prompt_memes_a"
  - TEST_GROUP="bundle exec cucumber -f progress -r features features/prompt_memes_b"
  - TEST_GROUP="bundle exec cucumber -f progress -r features features/prompt_memes_c"
  - TEST_GROUP="bundle exec cucumber -f progress -r features features/tags_and_wrangling"
  - TEST_GROUP="bundle exec cucumber -f progress -r features features/users"
  - TEST_GROUP="bundle exec cucumber -f progress -r features features/works"
  - TEST_GROUP="export DIRTYDB=yes ; bundle exec cucumber features/commit_critical/tag_wrangling_special_b.feature ;bundle exec cucumber features/commit_critical/tag_wrangling_special_c.feature"
rvm:
  - "2.2.5"
services:
  - elasticsearch
  - redis-server
  - memcached
script:
  - rm -f structure.sql
  - RAILS_ENV=test bundle exec rake db:create:all --trace
  - RAILS_ENV=test bundle exec rake db:schema:load --trace
  - RAILS_ENV=test bundle exec rake db:migrate --trace
  - travis_retry $TEST_GROUP
before_script:
  - bash script/travis_configure.sh
  - bash script/travis_elasticsearch_upgrade.sh
notifications:
  email:
    recipients:
      - otw-coders-extra@transformativeworks.org
    on_success: change
    on_failure: always
  irc:
   channels:
     - "irc.freenode.org#otw-dev"
   on_success: change
   on_failure: change
