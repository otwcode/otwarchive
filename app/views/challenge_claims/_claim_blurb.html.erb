<% # expects "claim" %>

<% prompt = claim.request_prompt %>
<% collection = claim.collection %>
<% challenge = claim.collection.challenge %>
<li class="collection claim picture blurb">
  <div class="header module">
    <!-- FRONT END this is actually the title of the fulfilling work only, if there is one -->      
    <h4 class="heading" title="fill title">  
      <% if claim.creation && claim.creation.is_a?(Work) %>
        <%= link_to claim.creation.title, work_path(claim.creation) %>
      <% else %>
        <%= ts("(Unfulfilled)")%>
      <% end %>
    </h4>

    <!--collection title and recipient forline-->
    <h5 class="heading">
      In <%= link_to collection.title, collection_url(collection) %>  
      <span class="byline">
        For 
        <% if claim.request_signup && !prompt.anonymous? %>
          <%= link_to(claim.request_signup.pseud.byline, collection_claim_path(claim.collection, claim)) %>
        <% else %>
          <%= link_to(ts("Anonymous"), collection_claim_path(claim.collection, claim)) %>
        <% end %>
      </span>
    </h5>

    <!--due date-->
    <% if @challenge.respond_to?("assignments_due_at") %>
      <p class="datetime">Due <%= time_in_zone(@challenge.assignments_due_at, (@challenge.time_zone || Time.zone.name)) %></p>
    <% end %>

    <div class="icon"></div>
  </div>
  
  <!--prompt tags -->
  <h6 class="landmark heading">Tags</h6>
  <% TagSet::TAG_TYPES.each do |type| %>
    <% if prompt && prompt.tag_set && !prompt.tag_set.with_type(type).empty? %>
      <ul class="<%= type %> type tags commas" title="<%= type %>">
        <%= tag_link_list(prompt.tag_set.with_type(type)) %>
      </ul>
    <% end %>  
  <% end %>
    

  <!--claim status-->
  <p class="status">
    <% if !claim.fulfilled? && claim.creation %>
      <%= ts("This work has not yet been approved by the challenge moderators.") %>
    <% elsif claim.fulfilled? %>
      <%= ts("This claim has been fulfilled!") %>
    <% else %>
      <%= ts("Not yet posted.") %>      
    <% end %>
  </p>
  
  <!--actions-->
  <ul class="actions" role="menu">
    <% if claim.claiming_pseud.user == current_user %>
      <li><%= link_to ts("Post To Fulfill"), new_collection_work_path(claim.collection, :claim_id => claim.id) %></li>
    <% end %>
    <% if !claim.fulfilled? && (claim.claiming_pseud.user == current_user || @collection.user_is_maintainer?(current_user)) %>
      <li><%= link_to ts("Delete"), collection_claim_path(claim.collection, claim), :confirm => ts('Are you sure you want to delete this claim?'), :method => :delete %></li>
    <% end %>
  </ul>
</li>

