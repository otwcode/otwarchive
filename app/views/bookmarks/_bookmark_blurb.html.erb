<!-- This partial requires local variable 'bookmark' -->
<li id="bookmark_<%= "#{bookmark.id}" %>" class="bookmark blurb" role="article">

  <% if bookmark.bookmarkable.blank? %>
    <p class="message"><%= "This has been deleted, sorry!" %></p>
  <% else %>
    <% bookmark_count = bookmark.bookmarkable.bookmarks.is_public.count %>
    <p class="symbols count" title="<%= bookmark_count %> Bookmarks">
      <%= get_symbol_for_bookmark(bookmark) %>
      <span><%=  (bookmark_count < 100) ? bookmark_count : '*' %></span>
    </p>

    <%= render "bookmarks/bookmarkable", :bookmarkable => bookmark.bookmarkable %>   

    <!--summary-->
    <% unless bookmark.bookmarkable.summary.blank? || (bookmark.bookmarkable.respond_to?('unrevealed?') && bookmark.bookmarkable.unrevealed?) %>
      <h6 class="landmark heading">Summary</h6>
      <blockquote class="userstuff summary" title="summary">
        <%=raw strip_images(sanitize_field(bookmark.bookmarkable, :summary)) %>
      </blockquote>
    <% end %>

    <!--navigation and actions-->
    <ul class="navigation actions" role="navigation">
      <% if bookmark_count > 1 %>
        <li><%= link_to_bookmarkable_bookmarks(bookmark.bookmarkable, ts('Bookmarked %{count} times', :count=>bookmark_count)) %></li>
      <% else %>
        <li><%= link_to_bookmarkable_bookmarks(bookmark.bookmarkable, ts('Bookmarked %{count} time', :count=>bookmark_count)) %></li>
      <% end %>

      <% if logged_in? && !is_author_of?(bookmark) %>
        <li><%= render "bookmarks/bookmark_blurb_form", :bookmarkable => bookmark.bookmarkable %></li>
      <% end %>

      <% if bookmark_count > 1 %>
        <% if params[:tag_id] || @most_recent_bookmarks %>
          <li id="recent_link_<%= "#{bookmark.bookmarkable_type.underscore}_#{bookmark.bookmarkable_id}" %>" style="display: none;" class="showme">
            <%= link_to ts("View most recent bookmarks"), 
              url_for({:controller => 'bookmarks', :action => 'fetch_recent', :id => bookmark.id }), :remote => true %>
          </li>
        <% end %>
      <% end %>
    </ul>
    <!--/actions-->

  <% end %>

  <div class="user module<% if is_author_of?(bookmark) %> own<% end %>">
    <!--bookmarker, time-->
    <h5 class="byline">
      <%= ts("Last bookmarked by ") %>
      <%= link_to(bookmark.pseud.byline, user_pseud_path(bookmark.pseud.user, bookmark.pseud)) %>
    </h5>
    <p class="datetime"><%= set_format_for_date(bookmark.created_at) %></p>

    <!--tags-->
    <% unless bookmark.tag_string.blank? %>
      <h6 class="landmark heading">Tags</h6>
      <ul class="tags commas">
        <% bookmark.tags.each do |tag| %>
          <li><%= link_to(tag.name, link_to_tag_bookmarks(tag), :class => 'tag') %></li>
        <% end %>
      </ul>
    <% end %>

    <!--notes-->
    <% unless bookmark.notes.blank? %>
      <h6 class="landmark heading">Notes</h6>
      <blockquote class="userstuff notes" title="notes">
        <%=raw sanitize_field(bookmark, :notes) %>
      </blockquote>
    <% end %>

    <!--navigation and actions-->
    <% if is_author_of?(bookmark) %>
      <%= render 'bookmarks/bookmark_owner_navi', :bookmark => bookmark %>
    <% elsif logged_in_as_admin? %>
      <%= render 'admin/admin_options', :item => bookmark %>
    <% end %>
  </div>

  <div id="recent_<%= "#{bookmark.bookmarkable_type.underscore}_#{bookmark.bookmarkable_id}" %>"></div>

  <% if logged_in_as_admin? && bookmark.bookmarkable.class == ExternalWork %>
    <%= render 'admin/admin_options', :item => bookmark.bookmarkable %>
  <% end %>
</li>
