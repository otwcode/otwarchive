<% # Use the bookmarkable item's id unless we're dealing with a bookmark of a deleted item %> 
<% bookmark_form_id = (@bookmarkable.blank? ? "#{@bookmark.id}" : "#{@bookmarkable.id}") %>

var bookmark_div = $j("#bookmark_form_placement_for_<%= bookmark_form_id %>");

if (!bookmark_div.children().length) { bookmark_div.html("<%= escape_javascript(render "bookmarks/bookmark_form", bookmarkable: @bookmarkable, bookmark: @bookmark, button_name: @button_name, action: @action, in_page: true, dynamic: true) %>"); }
$j(".bookmark_form_trigger_for_<%= bookmark_form_id %>").hide();

$j("#bookmark_form_close_for_<%= bookmark_form_id %>").click(function(){
  $j("#bookmark_form_placement_for_<%= bookmark_form_id %>").hide();
  $j(".bookmark_form_trigger_for_<%= bookmark_form_id %>").show();
  $j(".bookmark_form_trigger_for_<%= bookmark_form_id %>").attr("href", j(".bookmark_form_trigger_for_<%= bookmark_form_id %>").attr("data-path"));
});

// if canceled we don't want to generate the form a second time, just reopen it
$j(".bookmark_form_trigger_for_<%= bookmark_form_id %>").click(function(event){
  $j("#bookmark_form_placement_for_<%= bookmark_form_id %>").show();
  $j(".bookmark_form_trigger_for_<%= bookmark_form_id %>").hide();
  event.preventDefault();
});
