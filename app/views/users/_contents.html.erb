<!--main content-->
<!-- expects @fandoms, @works, @series, @bookmarks -->
  <% unless @fandoms.empty? %>
  <div class="fandom listbox group" id="user-fandoms">
    <!--NOTE TO BACK END, can this be regularised to one list and make expandable?-->
    <h3 class="heading"><%= ts("Fandoms") %></h3>
    <ol id="fandoms-dashboard" class="index group">
      <% @fandoms.each_with_index do |fandom, i| %>
        <li<%= i >= ArchiveConfig.NUMBER_OF_ITEMS_VISIBLE_IN_DASHBOARD && !params[:expand_fandoms] ? " class='expanded-list hidden'" : "" %>>
          <% if fandom.merger %>
            <%= link_to fandom.name, {:controller => :works, :user_id => @user, :pseud_id => @author, :fandom_id => fandom.merger.id} %> (<%= fandom.work_count %>)
          <% else %>
            <%= link_to fandom.name, {:controller => :works, :user_id => @user, :pseud_id => @author, :fandom_id => fandom.id} %> (<%= fandom.work_count %>)
          <% end %>
        </li>
     <% end %>
    </ol>
    <% if @fandoms.length > ArchiveConfig.NUMBER_OF_ITEMS_VISIBLE_IN_DASHBOARD %>
      <p class="actions">
        <noscript>  
          <% if params[:expand_fandoms] %>
            <%= link_to ts("Hide full list"), [@user, @author] %>
          <% else %>
            <%= link_to ts("Expand full list"), url_for(:expand_fandoms => true) %>
          <% end %>
        </noscript>
        <a class="hidden" id="expand-fandoms" href="#"><%= ts("Toggle full list") %></a>
      </p>
      <script type="text/javascript">
        $j(document).ready(function() {
          $j("#expand-fandoms").removeClass("hidden").click(function() {
            $j("#fandoms-dashboard>li.expanded-list").toggleClass("hidden");
          });
        });
      </script>
    <% end %>
  </div>
  <% end %> 
              
  <% unless @works.blank? %>
  <div class="work listbox group" id="user-works">
    <h3 class="heading"><%= ts("Recent works") %></h3>
    <ul class="index group">
      <% for work in @works %>
    	  <%= render :partial => 'works/work_blurb', :locals => {:work => work} %>
      <% end %>
    </ul>
    <% if @works.count > ArchiveConfig.NUMBER_OF_ITEMS_VISIBLE_IN_DASHBOARD %>
      <ul class="navigation actions" role="navigation"><li><%= @author ? print_pseud_works_link(@author) : print_works_link(@user) %></li></ul>
    <% end %>
  </div>
  <% end %>
  
  <% unless @series.blank? %>
  <div class="series listbox group" id="user-series">
    <h3 class="heading"><%= ts("Recent series") %></h3>
    <ol class="index group">
      <% for series in @series %>
        <%= render :partial => 'series/series_blurb', :locals => {:series => series} %>
      <% end %>
      <% if @author %>
        <% if @author.series.count > ArchiveConfig.NUMBER_OF_ITEMS_VISIBLE_IN_DASHBOARD %>
        <ul class="navigation actions" role="navigation"><li><%= print_pseud_series_link(@author) %></li></ul>
        <% end %>
      <% else %>
        <% if @user.series.count > ArchiveConfig.NUMBER_OF_ITEMS_VISIBLE_IN_DASHBOARD %>
        <ul class="navigation actions" role="navigation"><li><%= print_series_link(@user) %></li></ul>
        <% end %>
      <% end %> 
    </ol>
   </div>
  <% end %>
  
  <% unless @bookmarks.blank? %>
  <div class="bookmark listbox group" id="user-bookmarks">
    <h3 class="heading"><%= ts("Recent bookmarks") %></h3>
    <ol class="index group">
      <% for bookmark in @bookmarks %>
        <%= render 'bookmarks/bookmark_blurb', :bookmark => bookmark %>
      <% end %>
      <% unless @user == User.orphan_account %>
        <% if @author %>
          <% if @author.bookmarks.visible.size > ArchiveConfig.NUMBER_OF_ITEMS_VISIBLE_IN_DASHBOARD %>
            <ul class="navigation actions" role="navigation"><li><%= print_pseud_bookmarks_link(@author) %></li></ul>
          <% end %>
        <% else %>
          <% if @user.bookmarks.visible.size > ArchiveConfig.NUMBER_OF_ITEMS_VISIBLE_IN_DASHBOARD %>
            <ul class="navigation actions" role="navigation"><li><%= print_bookmarks_link(@user) %></li></ul>
          <% end %>
        <% end %> 
      <% end %>
    </ol>
  </div>
  <% end %>

<% if @works.blank? && @series.blank? && @bookmarks.blank? %>
  <% if current_user == @user %>
    <p class="alt message">
      <%= ts("You don't have anything posted under this name yet. ") %>
      <%= ts("Would you like to ")%>
      <%= link_to ts("post a new work"), new_work_path %>
      <%= ts("or maybe")%>
      <%= link_to ts("a new bookmark"), new_external_work_path %>?
    </p>
  <% else %>
    <p class="alt message">There are no works or bookmarks under this name yet.</p>
  <% end %>
<% end %>
<!--/content-->
