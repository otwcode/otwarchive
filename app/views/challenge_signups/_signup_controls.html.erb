<!-- requires 'challenge_signup' local -->
<% if challenge_signup.collection.challenge.signup_open || (!challenge_signup.collection.challenge.signup_open && challenge_signup.collection.user_is_owner?(current_user)) || challenge_signup.collection.challenge_type == "PromptMeme" %>
  <ul class="navigation" role="navigation">
    <!-- The edit link should show up only for the user who actually signed up while signups are open or for the owner once signups are closed -->
    <% if (challenge_signup.collection.challenge.signup_open && challenge_signup.pseud.user == current_user) || (!challenge_signup.collection.challenge.signup_open && challenge_signup.collection.user_is_owner?(current_user))  %>
      <li>
        <% unless challenge_signup.collection.potential_matches.count == 0 %>
          <%= link_to('Edit', edit_collection_signup_path(challenge_signup.collection, challenge_signup), 
                  :confirm => t("challenge_signups.potentials_already", 
                  :default => "Note: potential matches will need to be regenerated after your edits.")) %>
        <% else %>
          <%= link_to('Edit', edit_collection_signup_path(challenge_signup.collection, challenge_signup)) %>
        <% end %>
      </li>
    <% end %>
    <!-- The delete link should show up only for the user who actually signed up while signups are open or for the owner -->
    <% if (challenge_signup.collection.challenge.signup_open && challenge_signup.pseud.user == current_user) || (challenge_signup.collection.user_is_owner?(current_user))  %>
    <li>
      <% unless challenge_signup.collection.potential_matches.count == 0 %>
        <%= link_to t('.challenge_signup.delete_signup', :default => "Delete"), 
          collection_signup_path(challenge_signup.collection, challenge_signup), 
          :confirm => t('.challenge_signup.confirm_delete_signup', :default => "Are you sure? Potential matches will need to be regenerated afterwards."), 
          :method => :delete %>
      <% else %>
        <%= link_to t('.challenge_signup.delete_signup', :default => "Delete"), 
          collection_signup_path(challenge_signup.collection, challenge_signup), 
          :confirm => t('.challenge_signup.confirm_delete_signup', :default => "Are you sure? All information will be lost."), 
          :method => :delete %>
      <% end %>
    </li>
    <% end %>
    <% if current_user && challenge_signup.collection.challenge_type == "PromptMeme" && !@user && controller.action_name != "show" %>
    <% # hides this on a user's 'your signups' page and on a signup show page, since we only want it on the challenge index %>
      <li>
        <% new_claim = ChallengeClaim.new %>
          <%= form_for [@collection, new_claim], :url => collection_claims_path(@collection) do |claim_form| %>
              <%= claim_form.hidden_field :collection_id, :value => @collection.id %>
              <%= claim_form.hidden_field :request_signup_id, :value => challenge_signup.id %>
              <%= claim_form.hidden_field :request_prompt_id, :value => prompt_id %>
              <%= claim_form.hidden_field :claiming_user_id, :value => current_user.id %>
              <%= submit_tag "Claim", :id => "prompt_" + prompt_id.to_s %>
          <% end %>
      </li>
      <% prompt = Prompt.find(prompt_id) %>
      <% unless prompt.request_claims.blank? %>
        <li>Also claimed by: <% prompt.request_claims.each do |claim| %>
            <% if @collection.anonymous? && !(current_user && (@collection.user_is_moderator?(current_user) || @collection.user_is_owner?(current_user) || @collection.user_is_maintainer?(current_user))) %>
              (Anonymous)
            <% else %>
              <%= link_to(claim.claim_byline, collection_claim_path(claim.collection, claim)) %>
            <% end %>
        <% end %></li>
      <% end %>
    <% end %>
  </ul>
<% end %>
