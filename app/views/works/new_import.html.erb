<!--Descriptive page name, messages and instructions-->
<h2 class="heading"><%= ts("Import New Work") %> <%= link_to_help 'work-import'%></h2>
<%= error_messages_for :work %>
<div class="notice">
  <p class="important">
    <%= ts("Please note! Fanfiction.net does not allow imports from their site.") %>
  </p>
  <p>
    <%= ts("If you have trouble importing from another site, ") %> 
    <%= link_to ts("please let us know"), new_feedback_report_path %>
    <%= ts("so we can improve this tool!") %>
  </p>
  <p><%= ts("You might find the ") %><%= link_to ts("Import FAQ"), archive_faqs_path + "/9" %><%= ts(" useful.") %></p>
</div>

<!--/descriptions-->

<!--subnav-->
<ul class="navigation actions" role="menu">
  <% if @unposted %>
    <li id='restore-link'>
      <%= link_to ts('Restore From Last Unposted Draft?'), url_for(:action => :new, :load_unposted => true) %>
    </li>
  <% end %>
  <li id="form-link">
     <%= link_to( ts("Post New Work Instead?"),
       {:url => {:controller => :works, :action => :new, :import => false}},
       :href => url_for(:controller => :works, :action => :new, :import => nil)) %>
  </li>
</ul>
<!--/subnav-->

<!-- This partial renders a form for importing a work from an existing URL -->
  
<%= form_tag url_for(:controller => :works, :action => :import), :class => "import work post" do %>
  <fieldset>
    <legend><%= ts("Works URLs") %></legend>
    <dl>
      <dt class="required"><%= label_tag "urls", ts("URLs") + "*" %></dt>
      <dd><%= text_area_tag "urls", @urls ? @urls.join("\n") : "", :rows => 20, :cols => 90 %>
  	    <p class="footnote"><%= ts("URLs for existing work(s) or for the chapters of a single work; ") %><strong><%= ts("one URL per line.") %></strong></p>
      </dd>
      <dt><%= label_tag "encoding", ts("Set custom encoding") %> <%= link_to_help "encoding-help" %></dt> 
      <dd><%= select_tag "encoding", options_for_select([''] + Encoding.name_list.sort) %></dd>
      <dt><%= ts("Import as") %></dt>
      <dd>
        <ul>
      	  <li>
      	    <%= radio_button_tag "import_multiple", "works", true %>
            <%= label_tag "import_multiple_works", ts("Works (limit of %{max})", :max => current_user.archivist ? ArchiveConfig.IMPORT_MAX_WORKS_BY_ARCHIVIST : ArchiveConfig.IMPORT_MAX_WORKS) %>
          </li>
          <li>
            <%= radio_button_tag "import_multiple", "chapters" %>
            <%= label_tag "import_multiple_chapters", ts("Chapters in a single work (limit of %{max})", :max => ArchiveConfig.IMPORT_MAX_CHAPTERS) %>
          </li>
        </ul>
      </dd>
      <% if current_user.archivist %>
        <dt><%= check_box_tag "importing_for_others" %></dt>
        <dd>
          <%= label_tag "importing_for_others", ts("Import for others ONLY with permission") %>
          <fieldset>
            <dl>
              <dt class="required"><%= label_tag "external_author_name", ts("Author Name") + "*" %></dt>
              <dd><%= text_field_tag_original "external_author_name" %></dd>
              <dt class="required"><%= label_tag "external_author_email", ts("Author Email Address") + "*" %></dt>
              <dd><%= text_field_tag_original "external_author_email" %></dd>
              <dt><%= label_tag "external_coauthor_name", ts("Co-Author Name") %></dt>
              <dd><%= text_field_tag_original "external_coauthor_name" %></dd>
              <dt><%= label_tag "external_coauthor_email", ts("Co-Author Email Address") %></dt>
              <dd><%= text_field_tag_original "external_coauthor_email" %></dd>
            </dl>
          </fieldset>
        </dd>
      <% end %>
    
      <dt><%= ts("Preferences") %></dt>
	    <dd>
        <ul>
          <li>
            <%= check_box_tag "post_without_preview" %>
            <% if current_user.archivist %>
              <%= label_tag "post_without_preview", ts("Post without previewing (STRONGLY recommended if importing for others!)") %>
            <% else %>
              <%= label_tag "post_without_preview", ts("Post without previewing.") %>
            <% end %>
          </li>
          <li>
            <%= check_box_tag "restricted" %>
            <%= label_tag "restricted", ts("Lock all imports to registered users only.") %>
          </li>
          <li>
            <%= check_box_tag "override_tags" %>
            <%= label_tag "override_tags", ts("Set the following tags on all works, overriding whatever the importer finds.") %>
          </li>
        </ul>
      </dd>
    </dl>
  </fieldset>

  <%= render :partial => 'work_form_tags', :locals => {:include_blank => true} %>

  <fieldset>
    <legend><%= ts("Submit") %></legend>
    <p class="submit actions">
    <%= submit_tag ts("Import") %>
    </p>
  </fieldset>

<% end %>
