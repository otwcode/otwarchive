<!--Descriptive page name, messages and instructions-->
<h2 class="heading"><%= ts("Import New Work") %> <%= link_to_help 'work-import'%></h2>
<%= error_messages_for :work %>
<!--subnav-->
<ul class="actions" role="menu">
  <% if @unposted %>
      <li id='restore-link'>
        <%= link_to ts('Restore From Last Unposted Draft?'), url_for(:action => :new, :load_unposted => true) %>
      </li>
  <% end %>
  <li id="form-link">
    <%= link_to( ts("Post New Work Instead?"),
                 {:url => {:controller => :works, :action => :new, :import => false}},
                 :href => url_for(:controller => :works, :action => :new, :import => false)) %>
  </li>
</ul>

<div class="notice">
  <p class="important">
    <%= ts("Please note! Imports from fanfiction.net are no longer available because of a block on their end.") %>
  </p>
  <p>
    <%= ts("If you have troubles importing from another site, ") %>
    <%= link_to ts("please let us know"), new_feedback_report_path %>
    <%= ts("so we can improve this tool!") %>
  </p>
  <p>You might find the <a href="http://archiveofourown.org/archive_faqs/9">Import <abbr title="frequently asked questions">FAQ</abbr></a> useful.</p>
</div>

<!--/descriptions-->

<!-- This partial renders a form for importing a work from an existing URL -->


  <%= form_tag url_for(:controller => :works, :action => :import), :class => "verbose import work post" do %>
  <p class="required notice"><%= ts('* Required information') %></p>

  <fieldset>
  <legend><%= ts("Import Options") %></legend>
  <dl>
    <dt class="required"><%= label_tag "urls", ts("URLs*") %></dt>
   <dd><%= text_area_tag "urls", @urls ? @urls.join("\n") : "", :rows => 10, :cols => 90 %>
	<p class="footnote">URLs for existing work(s) or for the chapters of a single work; <strong>one URL per line</strong>.</p>
  </dd>
    <dt>URL Type</dt>
    <dd>
     <ul>
       <li><%= radio_button_tag "import_multiple", "works", true %>
         <%= label_tag "import_multiple_works", ts("Works (limit of %{max})", :max => current_user.archivist ? ArchiveConfig.IMPORT_MAX_WORKS_BY_ARCHIVIST : ArchiveConfig.IMPORT_MAX_WORKS) %>
       </li>
       <li><%= radio_button_tag "import_multiple", "chapters" %>
         <%= label_tag "import_multiple_chapters", ts("Chapters in a single work (limit of %{max})", :max => ArchiveConfig.IMPORT_MAX_CHAPTERS) %>
       </li>
       </ul>
    </dd>

   <dt>

    <%= label_tag "encoding", ts("Set custom encoding") %> <%= link_to_help "encoding-help" %></dt> 
    <dd><%= select_tag "encoding", options_for_select([''] + Encoding.name_list.sort) %></dd>


  
  <% if current_user.archivist %>
            <dt class="others">
              <%= check_box_tag "importing_for_others", "0",  :class => "toggle_formfield" %> Importing for others
            </dt>

            <dd class="others">
              <ul>
                <li>
                  <%= text_field_tag_original "e_name" %>
                  <%= label_tag "e_name", ts("Author Name") %>
                </li>
                <li>
                <%= text_field_tag_original "e_email" %>
                <%= label_tag "e_email", ts("Author Email Address") %>
              </li>
                <li>
                  <%= text_field_tag_original "ec_name" %>
                  <%= label_tag "ec_name", ts("CoAuthor Name") %>
                </li>
                <li>
                  <%= text_field_tag_original "ec_email" %>
                  <%= label_tag "ec_email", ts("CoAuthor Email Address") %>
                </li>
              </ul>
            </dd>

  <% end %>

    <dt>Preferences</dt>
    <dd>
      <ul>
      <li>
        <%= check_box_tag "post_without_preview" %>
        <% if current_user.archivist %>
          <%= label_tag "post_without_preview", ts("Post without previewing (STRONGLY recommended if importing for others!)") %>
        <% else %>
          <%= label_tag "post_without_preview", ts("Post without previewing.") %>
        <% end %>
      </li>

      <li>
        <%= check_box_tag "restricted" %>
        <%= label_tag "restricted", ts("Lock all imports to registered users only.") %>
      </li>

      <li>
        <%= check_box_tag "override_tags" %>
        <%= label_tag "override_tags", ts("Set the following tags on all stories, overriding whatever the importer finds.") %>
      </li>
      <li>
        <%= check_box_tag "enforce_blanks" %>
        <%= label_tag "enforce_blanks", ts("If you wish to tag the work with the information entered here, leaving anything not filled out blank, check me.") %>
      </li>
    </ul>
    </dd>
    </dl>
    </fieldset>

<%= render :partial => 'work_form_tags', :locals => {:include_blank => true} %>
<%= render :partial => 'work_import_associations', :locals => {:include_blank => true} %>

<fieldset>
  <legend><%= "Submit" %></legend>
  <p class="submit actions">
  <%= submit_tag ts("Import") %>
  </p>
</fieldset>

<% end %>

<%= content_for :footer_js do %>
    <%= javascript_tag do %>
        $j(document).ready(function(){
        $j(".toggle_formfield").click(function() {
        var targetId = $j(this).attr("id").replace("-show", "");
        toggleFormField(targetId);
        });
        })
    <% end %>
<% end %>