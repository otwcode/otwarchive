(function(e){var t,n,a,o,i={hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&times;",searchDelay:500,minChars:1,tokenLimit:null,jsonContainer:null,method:"GET",contentType:"json",queryParam:"q",tokenDelimiter:",",preventDuplicates:!1,prePopulate:null,processPrePopulate:!1,makeSortable:!1,escapeHTML:!0,animateDropdown:!0,onResult:null,onAdd:null,onDelete:null,noCache:!1},s={tokenList:"autocomplete",sortable:"sortable",token:"added tag",tokenDelete:"delete",selectedToken:"selected",highlightedToken:"highlighted",dropdown:"autocomplete dropdown",dropdownItem:"even",dropdownItem2:"odd",selectedDropdownItem:"selected",inputToken:"input",insertBefore:"selected",insertAfter:"selected"},l={BEFORE:0,AFTER:1,END:2};if(KeyboardEvent.prototype.hasOwnProperty("key")){var r=!0;t={BACKSPACE:"Backspace",TAB:"Tab",ENTER:"Enter",ESCAPE:"Escape",SPACE:" ",PAGE_UP:"PageUp",PAGE_DOWN:"PageDown",END:"End",HOME:"Home",LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown",DELETE:"Delete",NUMPAD_ENTER:"Enter",COMMA:","}}else t={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,NUMPAD_ENTER:108,COMMA:188},Object.defineProperty(KeyboardEvent.prototype,"key",{configurable:!0,enumerable:!0,get:function(){return this.keyCode}});r&&(n=KeyboardEvent.prototype,a=Object.getOwnPropertyDescriptor(n,"key"),o={Spacebar:" ",Esc:"Escape",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete"},Object.defineProperty(n,"key",{configurable:!0,enumerable:!0,get:function(){var e=a.get.call(this);return o.hasOwnProperty(e)?o[e]:e}})),e.fn.tokenInput=function(t,n){var a=e.extend({},i,n||{});return this.each(function(){new e.TokenList(this,t,a)})},e.TokenList=function(n,a,o){function i(t,n){if(!(n.indexOf(o.tokenDelimiter)>=0)){var a=e("<li>"+D(n)+" </li>").addClass(o.classes.token).insertBefore(M);o.makeSortable;var s=e("<span></span>").addClass(o.classes.tokenDelete).appendTo(a).click(function(){return f(e(this).parent()),!1});e('<a href="#">'+o.deleteText+"</a>").attr("title","remove "+n).appendTo(s);var l={id:t,name:n};e.data(a.get(0),"tokeninput",l),b=b.slice(0,B).concat([l]).concat(b.slice(B)),B++;var r=e.map(b,function(e){return e.id});return _.val(r.join(o.tokenDelimiter)),x+=1,a}e.each(n.split(o.tokenDelimiter),function(e,t){i(t,t)})}function r(t){var n;n="string"===e.type(t)?{id:t,name:t}:e.data(t.get(0),"tokeninput"),F.val("");var a=o.onAdd;if(x>0&&o.preventDuplicates){var s=null;if(I.children().each(function(){var t=e(this),a=e.data(t.get(0),"tokeninput");if(a&&a.id===n.id)return s=t,!1}),s)return u(s),void F.focus()}i(n.id,n.name),null!==o.tokenLimit&&x>=o.tokenLimit?(F.parent().prev("li").find("a").focus(),F.hide()):F.focus(),h(),e.isFunction(a)&&a.call(_,n),F.change()}function c(t){h();var n=e.data(t.get(0),"tokeninput");f(t),F.val(n.id)}function u(e){e.addClass(o.classes.selectedToken),j=e.get(0),F.val(""),h()}function d(e,t){e.removeClass(o.classes.selectedToken),j=null,t===l.BEFORE?B--:t===l.AFTER?B++:B=x,F.focus()}function p(t){var n=j;if(j){if(j===t.get(0))return void c(t);d(e(j),l.END)}n===t.get(0)?d(t,l.END):u(t)}function f(t){var n=e.data(t.get(0),"tokeninput"),a=o.onDelete,i=t.prevAll().length;i>B&&i--,t.remove(),j=null,F.focus(),b=b.slice(0,i).concat(b.slice(i+1)),i<B&&B--;var s=e.map(b,function(e){return e.id});_.val(s.join(o.tokenDelimiter)),x-=1,null!==o.tokenLimit&&F.show().val("").focus(),e.isFunction(a)&&a.call(_,n),F.change()}function h(){G.hide(),U&&e(U).removeClass(o.classes.selectedToken),U=null}function m(){G.css({position:"absolute"}).css("z-index",999).show()}function v(){o.searchingText&&(G.html("<p class='notice'>"+o.searchingText+"</p>"),m())}function k(){o.hintText&&(G.html("<p class='notice'>"+o.hintText+"</p>"),m())}function T(t,n){var a=t;return e.each(n.split(" "),function(e,t){t&&(t=t.replace(/([.?*+^$[\]\\(){}-])/g,"\\$1"),a=a.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>"))}),a}function g(t,n){if(n&&n.length){G.empty();var a=e('<ul role="listbox" aria-activedescendant="ui-active-menuitem">').appendTo(G).mouseover(function(t){E(e(t.target).closest("li"))}).mousedown(function(t){return r(e(t.target).closest("li")),!1}).hide();e.each(n,function(n,i){var s=e('<li role="option">'+T(D(i.name),t)+"</li>").appendTo(a);n%2?s.addClass(o.classes.dropdownItem):s.addClass(o.classes.dropdownItem2),0===n&&(S=s),e.data(s.get(0),"tokeninput",{id:i.id,name:i.name})}),m(),o.animateDropdown?a.slideDown("fast"):a.show()}else o.noResultsText&&(G.html("<p class='notice'>"+o.noResultsText+"</p>"),m())}function E(t){t&&(U&&C(e(U)),t.addClass(o.classes.selectedDropdownItem),U=t.get(0))}function C(e){e.removeClass(o.classes.selectedDropdownItem),U=null}function D(t){return o.escapeHTML?e("<p></p>").text(t).html():t}function y(){var t=F.val().toLowerCase();(t&&t.length||0==o.minChars)&&(U&&C(e(U)),j&&d(e(j),l.AFTER),0==o.minChars||t.length>=o.minChars?(v(),clearTimeout(L),L=setTimeout(function(){A(t)},o.searchDelay)):h())}function A(e){if(!o.noCache)var t=R.get(e);!o.noCache&&t?g(e,t):w(e)}function w(t){if(o.url)P(t);else if(o.local_data){var n=e.grep(o.local_data,function(e){return e.name.toLowerCase().indexOf(t.toLowerCase())>-1});e.isFunction(o.onResult)&&(n=o.onResult.call(_,n)),R.add(t,n),g(t,n)}}function P(t){var n={data:{}};if(o.url.indexOf("?")>-1){var a=o.url.split("?");n.url=a[0];var i=a[1].split("&");e.each(i,function(e,t){var a=t.split("=");n.data[a[0]]=a[1]})}else n.url=o.url;if(o.liveParams){var s=o.liveParams.split("&");e.each(s,function(t,a){var o=a.split("="),i="#"+o[1]+" input";0===e(i).size()?i="#"+o[1]:i+=":checked";var s=e(i).map(function(t,n){return e(n).val()}).get();s&&(n.data[o[0]]=s)})}n.data[o.queryParam]=t,n.type=o.method,n.dataType=o.contentType,o.crossDomain&&(n.dataType="jsonp"),n.success=function(n){e.isFunction(o.onResult)&&(n=o.onResult.call(_,n)),o.noCache||R.add(t,o.jsonContainer?n[o.jsonContainer]:n),F.val().toLowerCase()===t&&F.is(":focus")&&g(t,o.jsonContainer?n[o.jsonContainer]:n)},e.ajax(n)}"string"==typeof a?(o.url=a,void 0===o.crossDomain&&(-1===o.url.indexOf("://")?o.crossDomain=!1:o.crossDomain=location.href.split(/\/+/g)[1]!==o.url.split(/\/+/g)[1])):"object"==typeof a&&(o.local_data=a),o.classes?o.classes=e.extend({},s,o.classes):o.theme?(o.classes={},e.each(s,function(e,t){o.classes[e]=t+"-"+o.theme})):o.classes=s;var L,b=[],x=0,R=new e.TokenList.Cache,O=e(n).attr("id"),N=e('label[for="'+O+'"]');N.attr({for:O+"_autocomplete"});var F=e('<input type="text" class="text" autocomplete="off" role="combobox" aria-expanded="true" aria-autocomplete="list">').attr({id:O+"_autocomplete"}).focus(function(){(null===o.tokenLimit||x<o.tokenLimit)&&(e(this).val().length>=o.minChars?setTimeout(function(){y()},5):k())}).blur(function(){h()}).keydown(function(n){var a,i;switch(n.key){case t.LEFT:case t.RIGHT:case t.UP:case t.DOWN:if(S&&!S.is(":hidden")){if(n.key===t.LEFT||n.key===t.RIGHT)return!0;var s=null;return s=U?n.key===t.DOWN?e(U).next():e(U).prev():S,s.length?(E(s),e(G).scrollTo(e(s))):n.key===t.UP&&U&&C(e(U)),!1}j?(a=e(j).prev(),i=e(j).next(),n.key===t.LEFT||n.key===t.UP?d(e(j),l.BEFORE):d(e(j),l.AFTER)):(a=M.prev(),i=M.next()),n.key!==t.LEFT&&n.key!==t.UP||!a.length?n.key!==t.RIGHT&&n.key!==t.DOWN||!i.length||u(e(i.get(0))):u(e(a.get(0)));break;case t.BACKSPACE:case t.DELETE:if(a=M.prev(),!e(this).val().length)return j?f(e(j)):a.length&&u(e(a.get(0))),!1;1===e(this).val().length?h():setTimeout(function(){y()},5);break;case t.COMMA:case t.TAB:case t.ENTER:case t.NUMPAD_ENTER:if(U){if(r(e(U)),C(e(U)),h(),n.keyCode===t.TAB&&o.tokenLimit&&o.tokenLimit===x)break;return!1}if(F.val()){if(e.each(F.val().split(o.tokenDelimiter),function(t,n){r(e.trim(n))}),h(),n.keyCode===t.TAB&&o.tokenLimit&&o.tokenLimit===x)break;return!1}break;case t.ESCAPE:return h(),!0;default:String.fromCharCode(n.which)&&setTimeout(function(){y()},5)}});e(n).closest("form").submit(function(){F.val()&&e.each(F.val().split(o.tokenDelimiter),function(t,n){r(e.trim(n))})});var _=e(n).hide().focus(function(){F.focus()}).blur(function(){F.blur()}),j=null,B=0,U=null,S=null,I=e("<ul />").addClass(o.classes.tokenList).click(function(t){var n=e(t.target).closest("li");n&&n.get(0)&&e.data(n.get(0),"tokeninput")?p(n):(j&&d(e(j),l.END),F.focus())}).mouseover(function(t){var n=e(t.target).closest("li");n&&j!==this&&n.addClass(o.classes.highlightedToken)}).mouseout(function(t){var n=e(t.target).closest("li");n&&j!==this&&n.removeClass(o.classes.highlightedToken)}).insertBefore(_);o.makeSortable&&I.addClass(o.classes.sortable);var M=e("<li />").addClass(o.classes.inputToken).appendTo(I).append(F),G=e("<div>").addClass(o.classes.dropdown).insertAfter(F).hide(),H=e(n).val()||o.prePopulate;if(o.processPrePopulate&&e.isFunction(o.onResult)&&(H=o.onResult.call(_,H)),e(n).val(""),_.val(""),F.val(""),H&&H.length&&("string"==typeof H?i(H,H):e.each(H,function(e,t){i(t.id,t.name)})),null!==o.tokenLimit&&x>=o.tokenLimit&&F.hide(),o.liveParams){var W=o.liveParams.split("&");e.each(W,function(t,n){var a=n.split("="),o="#"+a[1]+" input";0===e(o).size()&&(o="#"+a[1]),e(o).each(function(t,n){e(n).hasClass("autocomplete")&&(n=e(n).prev().find("input").first()),e(n).change(function(e){R.clear_data()})})})}},e.TokenList.Cache=function(t){var n=e.extend({max_size:500},t),a={},o=0,i=function(){a={},o=0};this.clear_data=function(){i()},this.add=function(e,t){o>n.max_size&&i(),a[e]||(o+=1),a[e]=t},this.get=function(e){return a[e]}}})(jQuery);