<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>Class: UsersController</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/controllers/users_controller.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="ApplicationController.html">ApplicationController</a>
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-i-activate">#activate</a>
    
    <li><a href="#method-i-browse">#browse</a>
    
    <li><a href="#method-i-change_email">#change_email</a>
    
    <li><a href="#method-i-change_openid">#change_openid</a>
    
    <li><a href="#method-i-change_password">#change_password</a>
    
    <li><a href="#method-i-change_username">#change_username</a>
    
    <li><a href="#method-i-check_account_creation_status">#check_account_creation_status</a>
    
    <li><a href="#method-i-create">#create</a>
    
    <li><a href="#method-i-delete_confirmation">#delete_confirmation</a>
    
    <li><a href="#method-i-destroy">#destroy</a>
    
    <li><a href="#method-i-edit">#edit</a>
    
    <li><a href="#method-i-end_banner">#end_banner</a>
    
    <li><a href="#method-i-end_first_login">#end_first_login</a>
    
    <li><a href="#method-i-index">#index</a>
    
    <li><a href="#method-i-load_user">#load_user</a>
    
    <li><a href="#method-i-new">#new</a>
    
    <li><a href="#method-i-show">#show</a>
    
    <li><a href="#method-i-update">#update</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./app/mailers/README.html">README</a>
  
    <li class="file"><a href="./app/views/epub/mimetype.html">mimetype</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./Static.html">Static</a>
  
    <li><a href="./Static/BaseController.html">Static::BaseController</a>
  
    <li><a href="./Static/CollectionsController.html">Static::CollectionsController</a>
  
    <li><a href="./Static/FandomsController.html">Static::FandomsController</a>
  
    <li><a href="./Static/MediaController.html">Static::MediaController</a>
  
    <li><a href="./Static/RestrictedWorksController.html">Static::RestrictedWorksController</a>
  
    <li><a href="./Static/WorksController.html">Static::WorksController</a>
  
    <li><a href="./Admin.html">Admin</a>
  
    <li><a href="./Admin/AdminInvitationsController.html">Admin::AdminInvitationsController</a>
  
    <li><a href="./Admin/AdminUsersController.html">Admin::AdminUsersController</a>
  
    <li><a href="./Admin/SettingsController.html">Admin::SettingsController</a>
  
    <li><a href="./Admin/SkinsController.html">Admin::SkinsController</a>
  
    <li><a href="./Admin/UserCreationsController.html">Admin::UserCreationsController</a>
  
    <li><a href="./Challenge.html">Challenge</a>
  
    <li><a href="./Challenge/GiftExchangeController.html">Challenge::GiftExchangeController</a>
  
    <li><a href="./Challenge/PromptMemeController.html">Challenge::PromptMemeController</a>
  
    <li><a href="./StoryParser.html">StoryParser</a>
  
    <li><a href="./StoryParser/Error.html">StoryParser::Error</a>
  
    <li><a href="./AbuseReport.html">AbuseReport</a>
  
    <li><a href="./AbuseReportsController.html">AbuseReportsController</a>
  
    <li><a href="./AdminMailer.html">AdminMailer</a>
  
    <li><a href="./AdminPost.html">AdminPost</a>
  
    <li><a href="./AdminPostTag.html">AdminPostTag</a>
  
    <li><a href="./AdminPostTagging.html">AdminPostTagging</a>
  
    <li><a href="./AdminPostsController.html">AdminPostsController</a>
  
    <li><a href="./AdminSession.html">AdminSession</a>
  
    <li><a href="./AdminSessionsController.html">AdminSessionsController</a>
  
    <li><a href="./AdminSetting.html">AdminSetting</a>
  
    <li><a href="./AdminsController.html">AdminsController</a>
  
    <li><a href="./AdvancedSearchHelper.html">AdvancedSearchHelper</a>
  
    <li><a href="./AlphabetHelper.html">AlphabetHelper</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./ArchiveFaq.html">ArchiveFaq</a>
  
    <li><a href="./ArchiveFaqsController.html">ArchiveFaqsController</a>
  
    <li><a href="./AutocompleteController.html">AutocompleteController</a>
  
    <li><a href="./Banned.html">Banned</a>
  
    <li><a href="./Bookmark.html">Bookmark</a>
  
    <li><a href="./BookmarksController.html">BookmarksController</a>
  
    <li><a href="./BookmarksHelper.html">BookmarksHelper</a>
  
    <li><a href="./CacheHelper.html">CacheHelper</a>
  
    <li><a href="./CastNomination.html">CastNomination</a>
  
    <li><a href="./Category.html">Category</a>
  
    <li><a href="./ChallengeAssignment.html">ChallengeAssignment</a>
  
    <li><a href="./ChallengeAssignmentsController.html">ChallengeAssignmentsController</a>
  
    <li><a href="./ChallengeClaim.html">ChallengeClaim</a>
  
    <li><a href="./ChallengeClaimsController.html">ChallengeClaimsController</a>
  
    <li><a href="./ChallengeHelper.html">ChallengeHelper</a>
  
    <li><a href="./ChallengeRequestsController.html">ChallengeRequestsController</a>
  
    <li><a href="./ChallengeSignup.html">ChallengeSignup</a>
  
    <li><a href="./ChallengeSignupObserver.html">ChallengeSignupObserver</a>
  
    <li><a href="./ChallengeSignupSweeper.html">ChallengeSignupSweeper</a>
  
    <li><a href="./ChallengeSignupsController.html">ChallengeSignupsController</a>
  
    <li><a href="./ChallengeSweeper.html">ChallengeSweeper</a>
  
    <li><a href="./ChallengesController.html">ChallengesController</a>
  
    <li><a href="./Chapter.html">Chapter</a>
  
    <li><a href="./ChapterSweeper.html">ChapterSweeper</a>
  
    <li><a href="./ChaptersController.html">ChaptersController</a>
  
    <li><a href="./ChaptersHelper.html">ChaptersHelper</a>
  
    <li><a href="./Character.html">Character</a>
  
    <li><a href="./CharacterNomination.html">CharacterNomination</a>
  
    <li><a href="./Collection.html">Collection</a>
  
    <li><a href="./CollectionItem.html">CollectionItem</a>
  
    <li><a href="./CollectionItemsController.html">CollectionItemsController</a>
  
    <li><a href="./CollectionObserver.html">CollectionObserver</a>
  
    <li><a href="./CollectionParticipant.html">CollectionParticipant</a>
  
    <li><a href="./CollectionParticipantsController.html">CollectionParticipantsController</a>
  
    <li><a href="./CollectionPreference.html">CollectionPreference</a>
  
    <li><a href="./CollectionProfile.html">CollectionProfile</a>
  
    <li><a href="./CollectionProfileController.html">CollectionProfileController</a>
  
    <li><a href="./CollectionSweeper.html">CollectionSweeper</a>
  
    <li><a href="./CollectionsController.html">CollectionsController</a>
  
    <li><a href="./CollectionsHelper.html">CollectionsHelper</a>
  
    <li><a href="./Comment.html">Comment</a>
  
    <li><a href="./CommentMailer.html">CommentMailer</a>
  
    <li><a href="./CommentObserver.html">CommentObserver</a>
  
    <li><a href="./CommentSweeper.html">CommentSweeper</a>
  
    <li><a href="./CommentsController.html">CommentsController</a>
  
    <li><a href="./CommentsHelper.html">CommentsHelper</a>
  
    <li><a href="./CommonTagging.html">CommonTagging</a>
  
    <li><a href="./CreationObserver.html">CreationObserver</a>
  
    <li><a href="./Creatorship.html">Creatorship</a>
  
    <li><a href="./DateHelper.html">DateHelper</a>
  
    <li><a href="./DevmodeController.html">DevmodeController</a>
  
    <li><a href="./DownloadsController.html">DownloadsController</a>
  
    <li><a href="./EmailVeracityValidator.html">EmailVeracityValidator</a>
  
    <li><a href="./ErrorsController.html">ErrorsController</a>
  
    <li><a href="./ExternalAuthor.html">ExternalAuthor</a>
  
    <li><a href="./ExternalAuthorName.html">ExternalAuthorName</a>
  
    <li><a href="./ExternalAuthorsController.html">ExternalAuthorsController</a>
  
    <li><a href="./ExternalAuthorsHelper.html">ExternalAuthorsHelper</a>
  
    <li><a href="./ExternalCreatorship.html">ExternalCreatorship</a>
  
    <li><a href="./ExternalWork.html">ExternalWork</a>
  
    <li><a href="./ExternalWorksController.html">ExternalWorksController</a>
  
    <li><a href="./Fandom.html">Fandom</a>
  
    <li><a href="./FandomNomination.html">FandomNomination</a>
  
    <li><a href="./FandomsController.html">FandomsController</a>
  
    <li><a href="./FeedSweeper.html">FeedSweeper</a>
  
    <li><a href="./Feedback.html">Feedback</a>
  
    <li><a href="./FeedbacksController.html">FeedbacksController</a>
  
    <li><a href="./FilterCount.html">FilterCount</a>
  
    <li><a href="./FilterTagging.html">FilterTagging</a>
  
    <li><a href="./Freeform.html">Freeform</a>
  
    <li><a href="./FreeformNomination.html">FreeformNomination</a>
  
    <li><a href="./Gift.html">Gift</a>
  
    <li><a href="./GiftExchange.html">GiftExchange</a>
  
    <li><a href="./GiftsController.html">GiftsController</a>
  
    <li><a href="./HitCounter.html">HitCounter</a>
  
    <li><a href="./HomeController.html">HomeController</a>
  
    <li><a href="./HomeHelper.html">HomeHelper</a>
  
    <li><a href="./InboxComment.html">InboxComment</a>
  
    <li><a href="./InboxController.html">InboxController</a>
  
    <li><a href="./InboxHelper.html">InboxHelper</a>
  
    <li><a href="./Invitation.html">Invitation</a>
  
    <li><a href="./InvitationsController.html">InvitationsController</a>
  
    <li><a href="./InvitationsHelper.html">InvitationsHelper</a>
  
    <li><a href="./InviteRequest.html">InviteRequest</a>
  
    <li><a href="./InviteRequestsController.html">InviteRequestsController</a>
  
    <li><a href="./KnownIssue.html">KnownIssue</a>
  
    <li><a href="./KnownIssuesController.html">KnownIssuesController</a>
  
    <li><a href="./Kudo.html">Kudo</a>
  
    <li><a href="./KudoMailer.html">KudoMailer</a>
  
    <li><a href="./KudoObserver.html">KudoObserver</a>
  
    <li><a href="./KudosController.html">KudosController</a>
  
    <li><a href="./Language.html">Language</a>
  
    <li><a href="./LanguagesController.html">LanguagesController</a>
  
    <li><a href="./Locale.html">Locale</a>
  
    <li><a href="./LocalesController.html">LocalesController</a>
  
    <li><a href="./LogItem.html">LogItem</a>
  
    <li><a href="./Media.html">Media</a>
  
    <li><a href="./MediaController.html">MediaController</a>
  
    <li><a href="./MetaTagging.html">MetaTagging</a>
  
    <li><a href="./Object.html">Object</a>
  
    <li><a href="./Offer.html">Offer</a>
  
    <li><a href="./OrphansController.html">OrphansController</a>
  
    <li><a href="./OrphansHelper.html">OrphansHelper</a>
  
    <li><a href="./OwnedSetTagging.html">OwnedSetTagging</a>
  
    <li><a href="./OwnedTagSet.html">OwnedTagSet</a>
  
    <li><a href="./OwnedTagSetsController.html">OwnedTagSetsController</a>
  
    <li><a href="./PasswordsController.html">PasswordsController</a>
  
    <li><a href="./People.html">People</a>
  
    <li><a href="./PeopleController.html">PeopleController</a>
  
    <li><a href="./PotentialMatch.html">PotentialMatch</a>
  
    <li><a href="./PotentialMatchSettings.html">PotentialMatchSettings</a>
  
    <li><a href="./PotentialMatchesController.html">PotentialMatchesController</a>
  
    <li><a href="./PotentialPromptMatch.html">PotentialPromptMatch</a>
  
    <li><a href="./Preference.html">Preference</a>
  
    <li><a href="./PreferencesController.html">PreferencesController</a>
  
    <li><a href="./Profile.html">Profile</a>
  
    <li><a href="./ProfileController.html">ProfileController</a>
  
    <li><a href="./Prompt.html">Prompt</a>
  
    <li><a href="./PromptMeme.html">PromptMeme</a>
  
    <li><a href="./PromptRestriction.html">PromptRestriction</a>
  
    <li><a href="./PromptRestrictionsHelper.html">PromptRestrictionsHelper</a>
  
    <li><a href="./PromptsController.html">PromptsController</a>
  
    <li><a href="./Pseud.html">Pseud</a>
  
    <li><a href="./PseudSweeper.html">PseudSweeper</a>
  
    <li><a href="./PseudsController.html">PseudsController</a>
  
    <li><a href="./PseudsHelper.html">PseudsHelper</a>
  
    <li><a href="./Rating.html">Rating</a>
  
    <li><a href="./Reading.html">Reading</a>
  
    <li><a href="./ReadingsController.html">ReadingsController</a>
  
    <li><a href="./RedirectController.html">RedirectController</a>
  
    <li><a href="./RelatedWork.html">RelatedWork</a>
  
    <li><a href="./RelatedWorksController.html">RelatedWorksController</a>
  
    <li><a href="./Relationship.html">Relationship</a>
  
    <li><a href="./RelationshipNomination.html">RelationshipNomination</a>
  
    <li><a href="./Request.html">Request</a>
  
    <li><a href="./Role.html">Role</a>
  
    <li><a href="./RolesUser.html">RolesUser</a>
  
    <li><a href="./SearchController.html">SearchController</a>
  
    <li><a href="./SearchHelper.html">SearchHelper</a>
  
    <li><a href="./SerialWork.html">SerialWork</a>
  
    <li><a href="./SerialWorksController.html">SerialWorksController</a>
  
    <li><a href="./Series.html">Series</a>
  
    <li><a href="./SeriesController.html">SeriesController</a>
  
    <li><a href="./SeriesHelper.html">SeriesHelper</a>
  
    <li><a href="./SetTagging.html">SetTagging</a>
  
    <li><a href="./Skin.html">Skin</a>
  
    <li><a href="./SkinParent.html">SkinParent</a>
  
    <li><a href="./SkinsController.html">SkinsController</a>
  
    <li><a href="./SkinsHelper.html">SkinsHelper</a>
  
    <li><a href="./StaticSweeper.html">StaticSweeper</a>
  
    <li><a href="./StatsController.html">StatsController</a>
  
    <li><a href="./StatsHelper.html">StatsHelper</a>
  
    <li><a href="./Subscription.html">Subscription</a>
  
    <li><a href="./SubscriptionsController.html">SubscriptionsController</a>
  
    <li><a href="./Tag.html">Tag</a>
  
    <li><a href="./TagNomination.html">TagNomination</a>
  
    <li><a href="./TagNominationsController.html">TagNominationsController</a>
  
    <li><a href="./TagSet.html">TagSet</a>
  
    <li><a href="./TagSetAssociation.html">TagSetAssociation</a>
  
    <li><a href="./TagSetAssociationsController.html">TagSetAssociationsController</a>
  
    <li><a href="./TagSetNomination.html">TagSetNomination</a>
  
    <li><a href="./TagSetNominationsController.html">TagSetNominationsController</a>
  
    <li><a href="./TagSetOwnership.html">TagSetOwnership</a>
  
    <li><a href="./TagSetSweeper.html">TagSetSweeper</a>
  
    <li><a href="./TagSetsHelper.html">TagSetsHelper</a>
  
    <li><a href="./TagSweeper.html">TagSweeper</a>
  
    <li><a href="./TagWranglersController.html">TagWranglersController</a>
  
    <li><a href="./TagWranglingsController.html">TagWranglingsController</a>
  
    <li><a href="./Tagging.html">Tagging</a>
  
    <li><a href="./TagsController.html">TagsController</a>
  
    <li><a href="./TagsHelper.html">TagsHelper</a>
  
    <li><a href="./TranslationHelper.html">TranslationHelper</a>
  
    <li><a href="./TranslationNote.html">TranslationNote</a>
  
    <li><a href="./TranslationNotesController.html">TranslationNotesController</a>
  
    <li><a href="./TranslationsController.html">TranslationsController</a>
  
    <li><a href="./TranslatorsController.html">TranslatorsController</a>
  
    <li><a href="./UrlActiveValidator.html">UrlActiveValidator</a>
  
    <li><a href="./UrlFormatValidator.html">UrlFormatValidator</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./UserInviteRequest.html">UserInviteRequest</a>
  
    <li><a href="./UserInviteRequestsController.html">UserInviteRequestsController</a>
  
    <li><a href="./UserInviteRequestsHelper.html">UserInviteRequestsHelper</a>
  
    <li><a href="./UserMailer.html">UserMailer</a>
  
    <li><a href="./UserSession.html">UserSession</a>
  
    <li><a href="./UserSessionsController.html">UserSessionsController</a>
  
    <li><a href="./UsersController.html">UsersController</a>
  
    <li><a href="./UsersHelper.html">UsersHelper</a>
  
    <li><a href="./ValidationHelper.html">ValidationHelper</a>
  
    <li><a href="./Warning.html">Warning</a>
  
    <li><a href="./WeightedRandom.html">WeightedRandom</a>
  
    <li><a href="./Work.html">Work</a>
  
    <li><a href="./WorkObserver.html">WorkObserver</a>
  
    <li><a href="./WorkSkin.html">WorkSkin</a>
  
    <li><a href="./WorkSweeper.html">WorkSweeper</a>
  
    <li><a href="./WorksController.html">WorksController</a>
  
    <li><a href="./WorksHelper.html">WorksHelper</a>
  
    <li><a href="./WranglingAssignment.html">WranglingAssignment</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class UsersController</h1>

  <div id="description" class="description">
    
  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-activate" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">activate</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="activate-source">
            <pre><span class="ruby-comment"># File app/controllers/users_controller.rb, line 223</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">activate</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>].<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;Your activation key is missing.&quot;</span>)
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-string">''</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_activation_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">active?</span>
        <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>].<span class="ruby-identifier">now</span> = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;Your account has already been activated.&quot;</span>)
        <span class="ruby-identifier">redirect_to</span> <span class="ruby-ivar">@user</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">activate</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">activation</span>(<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">deliver</span>
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;Signup complete! Please log in.&quot;</span>)
      <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">create_log_item</span>( <span class="ruby-identifier">options</span> = {<span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">ACTION_ACTIVATE</span>})
      <span class="ruby-comment"># assign over any external authors that belong to this user</span>
      <span class="ruby-identifier">external_authors</span> = []
      <span class="ruby-identifier">external_authors</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">ExternalAuthor</span>.<span class="ruby-identifier">find_by_email</span>(<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email</span>)
      <span class="ruby-ivar">@invitation</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">invitation</span>
      <span class="ruby-identifier">external_authors</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@invitation</span>.<span class="ruby-identifier">external_author</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@invitation</span>
      <span class="ruby-identifier">external_authors</span>.<span class="ruby-identifier">compact!</span>
      <span class="ruby-keyword">unless</span> <span class="ruby-identifier">external_authors</span>.<span class="ruby-identifier">empty?</span>
        <span class="ruby-identifier">external_authors</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">external_author</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">external_author</span>.<span class="ruby-identifier">claim!</span>(<span class="ruby-ivar">@user</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot; We found some works already uploaded to the Archive of Our Own that we think belong to you! You'll see them on your homepage when you've logged in.&quot;</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">identity_url</span>
        <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">login_path</span>(<span class="ruby-value">:use_openid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>))
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">login_path</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;Your activation key is invalid. If you didn't activate within 14 days, your account was deleted. Please sign up again, or contact support via the link in our footer for more help.&quot;</span>).<span class="ruby-identifier">html_safe</span>
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-string">''</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- activate-source -->
          
        </div>

        

        
      </div><!-- activate-method -->

    
      <div id="method-i-browse" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">browse</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="browse-source">
            <pre><span class="ruby-comment"># File app/controllers/users_controller.rb, line 403</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">browse</span>
  <span class="ruby-ivar">@co_authors</span> = <span class="ruby-constant">Pseud</span>.<span class="ruby-identifier">order</span>(<span class="ruby-value">:name</span>).<span class="ruby-identifier">coauthor_of</span>(<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">pseuds</span>)
  <span class="ruby-ivar">@tag_types</span> = <span class="ruby-node">%w(Fandom Character Relationship Freeform)</span>
  <span class="ruby-ivar">@tags</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">tags</span>.<span class="ruby-identifier">with_scoped_count</span>.<span class="ruby-identifier">includes</span>(<span class="ruby-value">:merger</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:sort</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;count&quot;</span>
    <span class="ruby-ivar">@tags</span> = <span class="ruby-ivar">@tags</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;count DESC&quot;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@tags</span> = <span class="ruby-ivar">@tags</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;name ASC&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@tags</span> = <span class="ruby-ivar">@tags</span>.<span class="ruby-identifier">group_by</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span>}
<span class="ruby-keyword">end</span></pre>
          </div><!-- browse-source -->
          
        </div>

        

        
      </div><!-- browse-method -->

    
      <div id="method-i-change_email" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">change_email</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="change_email-source">
            <pre><span class="ruby-comment"># File app/controllers/users_controller.rb, line 273</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">change_email</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:new_email</span>].<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:change_email</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">reauthenticate</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">:change_email</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
    <span class="ruby-keyword">else</span>
  <span class="ruby-ivar">@old_email</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email</span>
  <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:new_email</span>]
  <span class="ruby-ivar">@new_email</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:new_email</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;Your email has been successfully updated&quot;</span>)
    <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">change_email</span>(<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">id</span>, <span class="ruby-ivar">@old_email</span>, <span class="ruby-ivar">@new_email</span>).<span class="ruby-identifier">deliver</span>
    <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">create_log_item</span>( <span class="ruby-identifier">options</span> = {<span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">ACTION_NEW_EMAIL</span>})
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:change_email</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-identifier">render</span> <span class="ruby-value">:change_email</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- change_email-source -->
          
        </div>

        

        
      </div><!-- change_email-method -->

    
      <div id="method-i-change_openid" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">change_openid</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="change_openid-source">
            <pre><span class="ruby-comment"># File app/controllers/users_controller.rb, line 124</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">change_openid</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:identity_url</span>]
    <span class="ruby-ivar">@openid_url</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:identity_url</span>]
    <span class="ruby-ivar">@openid_url</span> = <span class="ruby-node">&quot;http://#{@openid_url}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@openid_url</span>.<span class="ruby-identifier">match</span>(<span class="ruby-string">&quot;http://&quot;</span>)
    <span class="ruby-ivar">@openid_url</span> = <span class="ruby-constant">OpenID</span>.<span class="ruby-identifier">normalize_url</span>(<span class="ruby-ivar">@openid_url</span>)
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">reauthenticate</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">:change_openid</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">identity_url</span> = <span class="ruby-ivar">@openid_url</span>
    <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">recently_reset</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">'Your OpenID URL has been successfully updated.'</span>)
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">user_profile_path</span>(<span class="ruby-ivar">@user</span>) <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">:change_password</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- change_openid-source -->
          
        </div>

        

        
      </div><!-- change_openid-method -->

    
      <div id="method-i-change_password" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">change_password</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="change_password-source">
            <pre><span class="ruby-comment"># File app/controllers/users_controller.rb, line 105</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">change_password</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:password</span>]
    <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">recently_reset?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">reauthenticate</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">:change_password</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">password</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:password</span>]
    <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">password_confirmation</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:password_confirmation</span>]
    <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">recently_reset</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;Your password has been changed&quot;</span>)
      <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">create_log_item</span>( <span class="ruby-identifier">options</span> = {<span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">ACTION_PASSWORD_RESET</span>})
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">user_profile_path</span>(<span class="ruby-ivar">@user</span>) <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">:change_password</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- change_password-source -->
          
        </div>

        

        
      </div><!-- change_password-method -->

    
      <div id="method-i-change_username" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">change_username</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="change_username-source">
            <pre><span class="ruby-comment"># File app/controllers/users_controller.rb, line 143</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">change_username</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:new_login</span>]
    <span class="ruby-ivar">@new_login</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:new_login</span>]
    <span class="ruby-identifier">session</span> = <span class="ruby-constant">UserSession</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:login</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">login</span>, <span class="ruby-value">:password</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:password</span>])
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">session</span>.<span class="ruby-identifier">valid?</span>
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;Your password was incorrect&quot;</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_login</span>(<span class="ruby-ivar">@new_login</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">user</span> <span class="ruby-operator">!=</span> <span class="ruby-ivar">@user</span>)
        <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;User name already taken.&quot;</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">old_login</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">login</span>
        <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">login</span> = <span class="ruby-ivar">@new_login</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">save</span>
          <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;Your user name was changed&quot;</span>)

          <span class="ruby-identifier">new_pseud</span> = <span class="ruby-constant">Pseud</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@new_login</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">first</span>
          <span class="ruby-identifier">old_pseud</span> = <span class="ruby-constant">Pseud</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">old_login</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">first</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">new_pseud</span>
            <span class="ruby-comment"># do nothing - they already have the matching pseud</span>
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">old_pseud</span>
            <span class="ruby-comment"># change the old pseud to match</span>
            <span class="ruby-identifier">old_pseud</span>.<span class="ruby-identifier">update_attribute</span>(<span class="ruby-value">:name</span>, <span class="ruby-ivar">@new_login</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-comment"># shouldn't be able to get here, but just in case</span>
            <span class="ruby-constant">Pseud</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@new_login</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">id</span>)
          <span class="ruby-keyword">end</span>

          <span class="ruby-identifier">redirect_to</span> <span class="ruby-ivar">@user</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">clear</span>
          <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">reload</span>
          <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;User name must begin and end with a letter or number; it may also contain underscores but no other characters.&quot;</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- change_username-source -->
          
        </div>

        

        
      </div><!-- change_username-method -->

    
      <div id="method-i-check_account_creation_status" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">check_account_creation_status</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="check_account_creation_status-source">
            <pre><span class="ruby-comment"># File app/controllers/users_controller.rb, line 14</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">check_account_creation_status</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_registered_user?</span>
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;You are already logged in!&quot;</span>)
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">root_path</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">token</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:invitation_token</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">token</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@admin_settings</span>.<span class="ruby-identifier">account_creation_enabled?</span>
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;You need an invitation to sign up.&quot;</span>)
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">invite_requests_path</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">invitation</span> = <span class="ruby-constant">Invitation</span>.<span class="ruby-identifier">find_by_token</span>(<span class="ruby-identifier">token</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">invitation</span>
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;There was an error with your invitation token, please contact support&quot;</span>)
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">new_feedback_report_path</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">invitation</span>.<span class="ruby-identifier">redeemed_at</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">invitation</span>.<span class="ruby-identifier">invitee</span>
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;This invitation has already been used to create an account, sorry!&quot;</span>)
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">root_path</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- check_account_creation_status-source -->
          
        </div>

        

        
      </div><!-- check_account_creation_status-method -->

    
      <div id="method-i-create" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>POST /users POST /users.xml</p>
          

          
          <div class="method-source-code" id="create-source">
            <pre><span class="ruby-comment"># File app/controllers/users_controller.rb, line 184</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create</span>
  <span class="ruby-ivar">@hide_dashboard</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:cancel_create_account</span>]
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">root_path</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">login</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:user</span>][<span class="ruby-value">:login</span>]
    <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:user</span>][<span class="ruby-value">:email</span>]
    <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">invitation_token</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:invitation_token</span>]
    <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">age_over_13</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:user</span>][<span class="ruby-value">:age_over_13</span>]
    <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">terms_of_service</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:user</span>][<span class="ruby-value">:terms_of_service</span>]
    <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">password</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:user</span>][<span class="ruby-value">:password</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user</span>][<span class="ruby-value">:password</span>]
    <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">password_confirmation</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:user</span>][<span class="ruby-value">:password_confirmation</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user</span>][<span class="ruby-value">:password_confirmation</span>]
    <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">activation_code</span> = <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA1</span>.<span class="ruby-identifier">hexdigest</span>( <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">//</span>).<span class="ruby-identifier">sort_by</span> {<span class="ruby-identifier">rand</span>}.<span class="ruby-identifier">join</span> )
    <span class="ruby-identifier">openid_url</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:user</span>][<span class="ruby-value">:identity_url</span>]
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">openid_url</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-comment"># normalize OpenID url before saving</span>
      <span class="ruby-comment"># TODO validate openid before creating account</span>
      <span class="ruby-identifier">openid_url</span> = <span class="ruby-node">&quot;http://#{openid_url}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">openid_url</span>.<span class="ruby-identifier">match</span>(<span class="ruby-string">&quot;http://&quot;</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_identity_url</span>(<span class="ruby-identifier">openid_url</span>)
        <span class="ruby-identifier">params</span>[<span class="ruby-value">:use_openid</span>] = <span class="ruby-keyword">true</span>
        <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-value">:error</span>] = <span class="ruby-string">&quot;OpenID url is already being used&quot;</span>
        <span class="ruby-identifier">render</span> <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;new&quot;</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">identity_url</span> = <span class="ruby-constant">OpenID</span>.<span class="ruby-identifier">normalize_url</span>(<span class="ruby-identifier">openid_url</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">signup_notification</span>(<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">deliver</span>
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;During testing you can activate via &lt;a href='%{activation_url}'&gt;your activation url&lt;/a&gt;.&quot;</span>,
                          <span class="ruby-value">:activation_url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">activate_path</span>(<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">activation_code</span>)) <span class="ruby-keyword">if</span> <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">env</span>.<span class="ruby-identifier">development?</span>
      <span class="ruby-identifier">render</span> <span class="ruby-string">&quot;confirmation&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">params</span>[<span class="ruby-value">:use_openid</span>] = <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">openid_url</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;new&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- create-source -->
          
        </div>

        

        
      </div><!-- create-method -->

    
      <div id="method-i-delete_confirmation" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_confirmation</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="delete_confirmation-source">
            <pre><span class="ruby-comment"># File app/controllers/users_controller.rb, line 384</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_confirmation</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- delete_confirmation-source -->
          
        </div>

        

        
      </div><!-- delete_confirmation-method -->

    
      <div id="method-i-destroy" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">destroy</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>DELETE /users/1 DELETE /users/1.xml</p>
          

          
          <div class="method-source-code" id="destroy-source">
            <pre><span class="ruby-comment"># File app/controllers/users_controller.rb, line 297</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">destroy</span>
  <span class="ruby-ivar">@hide_dashboard</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">works</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>, <span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:posted</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>})
  <span class="ruby-ivar">@sole_owned_collections</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">collections</span>.<span class="ruby-identifier">delete_if</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">collection</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">collection</span>.<span class="ruby-identifier">all_owners</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">pseuds</span>).<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@sole_owned_collections</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">unposted_works</span>
      <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">wipeout_unposted_works</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">destroy</span>
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">'You have successfully deleted your account.'</span>)
   <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">delete_confirmation_path</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:coauthor</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:sole_author</span>].<span class="ruby-identifier">blank?</span>
    <span class="ruby-ivar">@sole_authored_works</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">sole_authored_works</span>
    <span class="ruby-ivar">@coauthored_works</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">coauthored_works</span>
    <span class="ruby-identifier">render</span> <span class="ruby-string">'delete_preview'</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:coauthor</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:sole_author</span>]
    <span class="ruby-ivar">@sole_authored_works</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">sole_authored_works</span>
    <span class="ruby-ivar">@coauthored_works</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">coauthored_works</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:cancel_button</span>]
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;Account deletion canceled.&quot;</span>)
     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">user_profile_path</span>(<span class="ruby-ivar">@user</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment"># Orphans co-authored works, keeps the user's pseud on the orphan account</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:coauthor</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'keep_pseud'</span>
        <span class="ruby-identifier">pseuds</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">pseuds</span>
        <span class="ruby-identifier">works</span> = <span class="ruby-ivar">@coauthored_works</span>
        <span class="ruby-identifier">use_default</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:use_default</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;true&quot;</span>
        <span class="ruby-constant">Creatorship</span>.<span class="ruby-identifier">orphan</span>(<span class="ruby-identifier">pseuds</span>, <span class="ruby-identifier">works</span>, <span class="ruby-identifier">use_default</span>)
        <span class="ruby-comment"># Orphans co-authored works, changes pseud to the default orphan pseud</span>
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:coauthor</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'orphan_pseud'</span>
        <span class="ruby-identifier">pseuds</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">pseuds</span>
        <span class="ruby-identifier">works</span> = <span class="ruby-ivar">@coauthored_works</span>
        <span class="ruby-constant">Creatorship</span>.<span class="ruby-identifier">orphan</span>(<span class="ruby-identifier">pseuds</span>, <span class="ruby-identifier">works</span>)
        <span class="ruby-comment"># Removes user as an author from co-authored works</span>
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:coauthor</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'remove'</span>
        <span class="ruby-ivar">@coauthored_works</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">pseuds_with_author_removed</span> = <span class="ruby-identifier">w</span>.<span class="ruby-identifier">pseuds</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">pseuds</span>
          <span class="ruby-identifier">w</span>.<span class="ruby-identifier">pseuds</span> = <span class="ruby-identifier">pseuds_with_author_removed</span>
          <span class="ruby-identifier">w</span>.<span class="ruby-identifier">save</span>
          <span class="ruby-identifier">w</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">c</span>.<span class="ruby-identifier">pseuds</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">pseuds</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">pseuds</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">pseuds</span>.<span class="ruby-identifier">empty?</span>
              <span class="ruby-identifier">c</span>.<span class="ruby-identifier">pseuds</span> = <span class="ruby-identifier">w</span>.<span class="ruby-identifier">pseuds</span>
            <span class="ruby-keyword">end</span>
            <span class="ruby-identifier">c</span>.<span class="ruby-identifier">save</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:sole_author</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'keep_pseud'</span>
        <span class="ruby-comment"># Orphans works where user is sole author, keeps their pseud on the orphan account</span>
        <span class="ruby-identifier">pseuds</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">pseuds</span>
        <span class="ruby-identifier">works</span> = <span class="ruby-ivar">@sole_authored_works</span>
        <span class="ruby-identifier">use_default</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:use_default</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;true&quot;</span>
        <span class="ruby-constant">Creatorship</span>.<span class="ruby-identifier">orphan</span>(<span class="ruby-identifier">pseuds</span>, <span class="ruby-identifier">works</span>, <span class="ruby-identifier">use_default</span>)
        <span class="ruby-constant">Collection</span>.<span class="ruby-identifier">orphan</span>(<span class="ruby-identifier">pseuds</span>, <span class="ruby-ivar">@sole_owned_collections</span>, <span class="ruby-identifier">use_default</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:sole_author</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'orphan_pseud'</span>
        <span class="ruby-comment"># Orphans works where user is sole author, uses the default orphan pseud</span>
        <span class="ruby-identifier">pseuds</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">pseuds</span>
        <span class="ruby-identifier">works</span> = <span class="ruby-ivar">@sole_authored_works</span>
        <span class="ruby-constant">Creatorship</span>.<span class="ruby-identifier">orphan</span>(<span class="ruby-identifier">pseuds</span>, <span class="ruby-identifier">works</span>)
        <span class="ruby-constant">Collection</span>.<span class="ruby-identifier">orphan</span>(<span class="ruby-identifier">pseuds</span>, <span class="ruby-ivar">@sole_owned_collections</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:sole_author</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'delete'</span>
        <span class="ruby-comment"># Deletes works where user is sole author</span>
        <span class="ruby-ivar">@sole_authored_works</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">s</span>.<span class="ruby-identifier">destroy</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-comment"># Deletes collections where user is sole author</span>
        <span class="ruby-ivar">@sole_owned_collections</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">c</span>.<span class="ruby-identifier">destroy</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">works</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>, <span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:posted</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>})
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">blank?</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">unposted_works</span>
          <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">wipeout_unposted_works</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">destroy</span>
        <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">'You have successfully deleted your account.'</span>)
        <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">delete_confirmation_path</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;Sorry, something went wrong! Please try again.&quot;</span>)
        <span class="ruby-identifier">redirect_to</span>(<span class="ruby-ivar">@user</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- destroy-source -->
          
        </div>

        

        
      </div><!-- destroy-method -->

    
      <div id="method-i-edit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">edit</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>GET /users/1/edit</p>
          

          
          <div class="method-source-code" id="edit-source">
            <pre><span class="ruby-comment"># File app/controllers/users_controller.rb, line 102</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">edit</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- edit-source -->
          
        </div>

        

        
      </div><!-- edit-method -->

    
      <div id="method-i-end_banner" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">end_banner</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="end_banner-source">
            <pre><span class="ruby-comment"># File app/controllers/users_controller.rb, line 395</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">end_banner</span>
  <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">preference</span>.<span class="ruby-identifier">update_attribute</span>(<span class="ruby-value">:banner_seen</span>, <span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">&quot;HTTP_REFERER&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">root_path</span>) <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span> }
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- end_banner-source -->
          
        </div>

        

        
      </div><!-- end_banner-method -->

    
      <div id="method-i-end_first_login" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">end_first_login</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="end_first_login-source">
            <pre><span class="ruby-comment"># File app/controllers/users_controller.rb, line 387</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">end_first_login</span>
  <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">preference</span>.<span class="ruby-identifier">update_attribute</span>(<span class="ruby-value">:first_login</span>, <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span> <span class="ruby-ivar">@user</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span> }
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- end_first_login-source -->
          
        </div>

        

        
      </div><!-- end_first_login-method -->

    
      <div id="method-i-index" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">index</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="index-source">
            <pre><span class="ruby-comment"># File app/controllers/users_controller.rb, line 37</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">index</span>
  <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">keep</span>
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:people</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:index</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- index-source -->
          
        </div>

        

        
      </div><!-- index-method -->

    
      <div id="method-i-load_user" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">load_user</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="load_user-source">
            <pre><span class="ruby-comment"># File app/controllers/users_controller.rb, line 9</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">load_user</span>
  <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_login</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
  <span class="ruby-ivar">@check_ownership_of</span> = <span class="ruby-ivar">@user</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- load_user-source -->
          
        </div>

        

        
      </div><!-- load_user-method -->

    
      <div id="method-i-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>GET /users/new GET /users/new.xml</p>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File app/controllers/users_controller.rb, line 91</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:invitation_token</span>]
    <span class="ruby-ivar">@invitation</span> = <span class="ruby-constant">Invitation</span>.<span class="ruby-identifier">find_by_token</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:invitation_token</span>])
    <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">invitation_token</span> = <span class="ruby-ivar">@invitation</span>.<span class="ruby-identifier">token</span>
    <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email</span> = <span class="ruby-ivar">@invitation</span>.<span class="ruby-identifier">invitee_email</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@hide_dashboard</span> = <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
      <div id="method-i-show" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">show</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>GET /users/1</p>
          

          
          <div class="method-source-code" id="show-source">
            <pre><span class="ruby-comment"># File app/controllers/users_controller.rb, line 43</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">show</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;Sorry, could not find this user.&quot;</span>)
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">people_path</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># very similar to show under pseuds - if you change something here, change it there too</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-comment"># hahaha omg so ugly BUT IT WORKS :P</span>
    <span class="ruby-ivar">@fandoms</span> = <span class="ruby-constant">Fandom</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;tags.*, count(tags.id) as work_count&quot;</span>).
                 <span class="ruby-identifier">joins</span>(<span class="ruby-value">:direct_filter_taggings</span>).
                 <span class="ruby-identifier">joins</span>(<span class="ruby-string">&quot;INNER JOIN works ON filter_taggings.filterable_id = works.id AND filter_taggings.filterable_type = 'Work'&quot;</span>).
                 <span class="ruby-identifier">group</span>(<span class="ruby-string">&quot;tags.id&quot;</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;work_count DESC&quot;</span>) &amp;
                 <span class="ruby-constant">Work</span>.<span class="ruby-identifier">visible_to_all</span>.<span class="ruby-identifier">revealed</span> &amp;
                 <span class="ruby-constant">Work</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-string">&quot;INNER JOIN creatorships ON creatorships.creation_id = works.id AND creatorships.creation_type = 'Work'
  INNER JOIN pseuds ON creatorships.pseud_id = pseuds.id
  INNER JOIN users ON pseuds.user_id = users.id&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;users.id = ?&quot;</span>, <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">id</span>)
    <span class="ruby-identifier">visible_works</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">works</span>.<span class="ruby-identifier">visible_to_all</span>
    <span class="ruby-identifier">visible_series</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">series</span>.<span class="ruby-identifier">visible_to_all</span>
    <span class="ruby-identifier">visible_bookmarks</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">bookmarks</span>.<span class="ruby-identifier">visible_to_all</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@fandoms</span> = <span class="ruby-constant">Fandom</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;tags.*, count(tags.id) as work_count&quot;</span>).
                 <span class="ruby-identifier">joins</span>(<span class="ruby-value">:direct_filter_taggings</span>).
                 <span class="ruby-identifier">joins</span>(<span class="ruby-string">&quot;INNER JOIN works ON filter_taggings.filterable_id = works.id AND filter_taggings.filterable_type = 'Work'&quot;</span>).
                 <span class="ruby-identifier">group</span>(<span class="ruby-string">&quot;tags.id&quot;</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;work_count DESC&quot;</span>) &amp;
                 <span class="ruby-constant">Work</span>.<span class="ruby-identifier">visible_to_registered_user</span>.<span class="ruby-identifier">revealed</span> &amp;
                 <span class="ruby-constant">Work</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-string">&quot;INNER JOIN creatorships ON creatorships.creation_id = works.id AND creatorships.creation_type = 'Work'
  INNER JOIN pseuds ON creatorships.pseud_id = pseuds.id
  INNER JOIN users ON pseuds.user_id = users.id&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;users.id = ?&quot;</span>, <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">id</span>)
    <span class="ruby-identifier">visible_works</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">works</span>.<span class="ruby-identifier">visible_to_registered_user</span>
    <span class="ruby-identifier">visible_series</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">series</span>.<span class="ruby-identifier">visible_to_registered_user</span>
    <span class="ruby-identifier">visible_bookmarks</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">bookmarks</span>.<span class="ruby-identifier">visible_to_registered_user</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@fandoms</span> = <span class="ruby-ivar">@fandoms</span>.<span class="ruby-identifier">all</span> <span class="ruby-comment"># force eager loading</span>
  <span class="ruby-ivar">@works</span> = <span class="ruby-identifier">visible_works</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;revised_at DESC&quot;</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">NUMBER_OF_ITEMS_VISIBLE_IN_DASHBOARD</span>)
  <span class="ruby-ivar">@series</span> = <span class="ruby-identifier">visible_series</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;updated_at DESC&quot;</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">NUMBER_OF_ITEMS_VISIBLE_IN_DASHBOARD</span>)
  <span class="ruby-ivar">@bookmarks</span> = <span class="ruby-identifier">visible_bookmarks</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;updated_at DESC&quot;</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">NUMBER_OF_ITEMS_VISIBLE_IN_DASHBOARD</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:subscriptions</span>)
    <span class="ruby-ivar">@subscription</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">subscriptions</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:subscribable_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">id</span>,
                                                     <span class="ruby-value">:subscribable_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'User'</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span>
                    <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">subscriptions</span>.<span class="ruby-identifier">build</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- show-source -->
          
        </div>

        

        
      </div><!-- show-method -->

    
      <div id="method-i-update" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>PUT /users/1 PUT /users/1.xml</p>
          

          
          <div class="method-source-code" id="update-source">
            <pre><span class="ruby-comment"># File app/controllers/users_controller.rb, line 263</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update</span>
  <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">profile</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:profile_attributes</span>])
<span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">profile</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;Your profile has been successfully updated&quot;</span>)
  <span class="ruby-identifier">render</span> <span class="ruby-value">:edit</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
<span class="ruby-keyword">else</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:edit</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
<span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- update-source -->
          
        </div>

        

        
      </div><!-- update-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.11.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

