<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>class TagsController - RDoc Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/controllers/tags_controller.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="ApplicationController.html">ApplicationController</a>
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-i-create">#create</a>
    
    <li><a href="#method-i-edit">#edit</a>
    
    <li><a href="#method-i-feed">#feed</a>
    
    <li><a href="#method-i-index">#index</a>
    
    <li><a href="#method-i-load_tag">#load_tag</a>
    
    <li><a href="#method-i-mass_update">#mass_update</a>
    
    <li><a href="#method-i-new">#new</a>
    
    <li><a href="#method-i-search">#search</a>
    
    <li><a href="#method-i-show">#show</a>
    
    <li><a href="#method-i-show_hidden">#show_hidden</a>
    
    <li><a href="#method-i-update">#update</a>
    
    <li><a href="#method-i-wrangle">#wrangle</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./app/mailers/README.html">README</a>
  
    <li class="file"><a href="./app/views/epub/mimetype.html">mimetype</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./Admin.html">Admin</a>
  
    <li><a href="./Admin/AdminInvitationsController.html">Admin::AdminInvitationsController</a>
  
    <li><a href="./Admin/AdminUsersController.html">Admin::AdminUsersController</a>
  
    <li><a href="./Admin/SettingsController.html">Admin::SettingsController</a>
  
    <li><a href="./Admin/SkinsController.html">Admin::SkinsController</a>
  
    <li><a href="./Admin/StatsController.html">Admin::StatsController</a>
  
    <li><a href="./Admin/UserCreationsController.html">Admin::UserCreationsController</a>
  
    <li><a href="./Static.html">Static</a>
  
    <li><a href="./Static/BaseController.html">Static::BaseController</a>
  
    <li><a href="./Static/CollectionsController.html">Static::CollectionsController</a>
  
    <li><a href="./Static/FandomsController.html">Static::FandomsController</a>
  
    <li><a href="./Static/MediaController.html">Static::MediaController</a>
  
    <li><a href="./Static/RestrictedWorksController.html">Static::RestrictedWorksController</a>
  
    <li><a href="./Static/WorksController.html">Static::WorksController</a>
  
    <li><a href="./Challenge.html">Challenge</a>
  
    <li><a href="./Challenge/GiftExchangeController.html">Challenge::GiftExchangeController</a>
  
    <li><a href="./Challenge/PromptMemeController.html">Challenge::PromptMemeController</a>
  
    <li><a href="./Opendoors.html">Opendoors</a>
  
    <li><a href="./Opendoors/ExternalAuthorsController.html">Opendoors::ExternalAuthorsController</a>
  
    <li><a href="./Opendoors/ToolsController.html">Opendoors::ToolsController</a>
  
    <li><a href="./StoryParser.html">StoryParser</a>
  
    <li><a href="./StoryParser/Error.html">StoryParser::Error</a>
  
    <li><a href="./AbuseReport.html">AbuseReport</a>
  
    <li><a href="./AbuseReportsController.html">AbuseReportsController</a>
  
    <li><a href="./AdminMailer.html">AdminMailer</a>
  
    <li><a href="./AdminPost.html">AdminPost</a>
  
    <li><a href="./AdminPostTag.html">AdminPostTag</a>
  
    <li><a href="./AdminPostTagging.html">AdminPostTagging</a>
  
    <li><a href="./AdminPostsController.html">AdminPostsController</a>
  
    <li><a href="./AdminSession.html">AdminSession</a>
  
    <li><a href="./AdminSessionsController.html">AdminSessionsController</a>
  
    <li><a href="./AdminSetting.html">AdminSetting</a>
  
    <li><a href="./AdminsController.html">AdminsController</a>
  
    <li><a href="./AdvancedSearchHelper.html">AdvancedSearchHelper</a>
  
    <li><a href="./AlphabetHelper.html">AlphabetHelper</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./ArchiveFaq.html">ArchiveFaq</a>
  
    <li><a href="./ArchiveFaqsController.html">ArchiveFaqsController</a>
  
    <li><a href="./AutocompleteController.html">AutocompleteController</a>
  
    <li><a href="./Banned.html">Banned</a>
  
    <li><a href="./Bookmark.html">Bookmark</a>
  
    <li><a href="./BookmarksController.html">BookmarksController</a>
  
    <li><a href="./BookmarksHelper.html">BookmarksHelper</a>
  
    <li><a href="./CacheHelper.html">CacheHelper</a>
  
    <li><a href="./CastNomination.html">CastNomination</a>
  
    <li><a href="./Category.html">Category</a>
  
    <li><a href="./ChallengeAssignment.html">ChallengeAssignment</a>
  
    <li><a href="./ChallengeAssignmentsController.html">ChallengeAssignmentsController</a>
  
    <li><a href="./ChallengeClaim.html">ChallengeClaim</a>
  
    <li><a href="./ChallengeClaimsController.html">ChallengeClaimsController</a>
  
    <li><a href="./ChallengeHelper.html">ChallengeHelper</a>
  
    <li><a href="./ChallengeRequestsController.html">ChallengeRequestsController</a>
  
    <li><a href="./ChallengeSignup.html">ChallengeSignup</a>
  
    <li><a href="./ChallengeSignupObserver.html">ChallengeSignupObserver</a>
  
    <li><a href="./ChallengeSignupSweeper.html">ChallengeSignupSweeper</a>
  
    <li><a href="./ChallengeSignupsController.html">ChallengeSignupsController</a>
  
    <li><a href="./ChallengeSweeper.html">ChallengeSweeper</a>
  
    <li><a href="./ChallengesController.html">ChallengesController</a>
  
    <li><a href="./Chapter.html">Chapter</a>
  
    <li><a href="./ChapterSweeper.html">ChapterSweeper</a>
  
    <li><a href="./ChaptersController.html">ChaptersController</a>
  
    <li><a href="./ChaptersHelper.html">ChaptersHelper</a>
  
    <li><a href="./Character.html">Character</a>
  
    <li><a href="./CharacterNomination.html">CharacterNomination</a>
  
    <li><a href="./Collection.html">Collection</a>
  
    <li><a href="./CollectionItem.html">CollectionItem</a>
  
    <li><a href="./CollectionItemsController.html">CollectionItemsController</a>
  
    <li><a href="./CollectionObserver.html">CollectionObserver</a>
  
    <li><a href="./CollectionParticipant.html">CollectionParticipant</a>
  
    <li><a href="./CollectionParticipantsController.html">CollectionParticipantsController</a>
  
    <li><a href="./CollectionPreference.html">CollectionPreference</a>
  
    <li><a href="./CollectionProfile.html">CollectionProfile</a>
  
    <li><a href="./CollectionProfileController.html">CollectionProfileController</a>
  
    <li><a href="./CollectionSweeper.html">CollectionSweeper</a>
  
    <li><a href="./CollectionsController.html">CollectionsController</a>
  
    <li><a href="./CollectionsHelper.html">CollectionsHelper</a>
  
    <li><a href="./Comment.html">Comment</a>
  
    <li><a href="./CommentMailer.html">CommentMailer</a>
  
    <li><a href="./CommentObserver.html">CommentObserver</a>
  
    <li><a href="./CommentSweeper.html">CommentSweeper</a>
  
    <li><a href="./CommentsController.html">CommentsController</a>
  
    <li><a href="./CommentsHelper.html">CommentsHelper</a>
  
    <li><a href="./CommonTagging.html">CommonTagging</a>
  
    <li><a href="./CreationObserver.html">CreationObserver</a>
  
    <li><a href="./Creatorship.html">Creatorship</a>
  
    <li><a href="./DateHelper.html">DateHelper</a>
  
    <li><a href="./DevmodeController.html">DevmodeController</a>
  
    <li><a href="./DownloadsController.html">DownloadsController</a>
  
    <li><a href="./EmailVeracityValidator.html">EmailVeracityValidator</a>
  
    <li><a href="./ErrorsController.html">ErrorsController</a>
  
    <li><a href="./ExternalAuthor.html">ExternalAuthor</a>
  
    <li><a href="./ExternalAuthorName.html">ExternalAuthorName</a>
  
    <li><a href="./ExternalAuthorsController.html">ExternalAuthorsController</a>
  
    <li><a href="./ExternalAuthorsHelper.html">ExternalAuthorsHelper</a>
  
    <li><a href="./ExternalCreatorship.html">ExternalCreatorship</a>
  
    <li><a href="./ExternalWork.html">ExternalWork</a>
  
    <li><a href="./ExternalWorksController.html">ExternalWorksController</a>
  
    <li><a href="./Fandom.html">Fandom</a>
  
    <li><a href="./FandomNomination.html">FandomNomination</a>
  
    <li><a href="./FandomsController.html">FandomsController</a>
  
    <li><a href="./FeedSweeper.html">FeedSweeper</a>
  
    <li><a href="./Feedback.html">Feedback</a>
  
    <li><a href="./FeedbacksController.html">FeedbacksController</a>
  
    <li><a href="./FilterCount.html">FilterCount</a>
  
    <li><a href="./FilterTagging.html">FilterTagging</a>
  
    <li><a href="./Freeform.html">Freeform</a>
  
    <li><a href="./FreeformNomination.html">FreeformNomination</a>
  
    <li><a href="./Gift.html">Gift</a>
  
    <li><a href="./GiftExchange.html">GiftExchange</a>
  
    <li><a href="./GiftsController.html">GiftsController</a>
  
    <li><a href="./HitCounter.html">HitCounter</a>
  
    <li><a href="./HomeController.html">HomeController</a>
  
    <li><a href="./HomeHelper.html">HomeHelper</a>
  
    <li><a href="./InboxComment.html">InboxComment</a>
  
    <li><a href="./InboxController.html">InboxController</a>
  
    <li><a href="./InboxHelper.html">InboxHelper</a>
  
    <li><a href="./Invitation.html">Invitation</a>
  
    <li><a href="./InvitationsController.html">InvitationsController</a>
  
    <li><a href="./InvitationsHelper.html">InvitationsHelper</a>
  
    <li><a href="./InviteRequest.html">InviteRequest</a>
  
    <li><a href="./InviteRequestsController.html">InviteRequestsController</a>
  
    <li><a href="./KnownIssue.html">KnownIssue</a>
  
    <li><a href="./KnownIssuesController.html">KnownIssuesController</a>
  
    <li><a href="./Kudo.html">Kudo</a>
  
    <li><a href="./KudoMailer.html">KudoMailer</a>
  
    <li><a href="./KudoObserver.html">KudoObserver</a>
  
    <li><a href="./KudosController.html">KudosController</a>
  
    <li><a href="./KudosSweeper.html">KudosSweeper</a>
  
    <li><a href="./Language.html">Language</a>
  
    <li><a href="./LanguagesController.html">LanguagesController</a>
  
    <li><a href="./Locale.html">Locale</a>
  
    <li><a href="./LocalesController.html">LocalesController</a>
  
    <li><a href="./LogItem.html">LogItem</a>
  
    <li><a href="./Media.html">Media</a>
  
    <li><a href="./MediaController.html">MediaController</a>
  
    <li><a href="./MetaTagging.html">MetaTagging</a>
  
    <li><a href="./Object.html">Object</a>
  
    <li><a href="./Offer.html">Offer</a>
  
    <li><a href="./OrphansController.html">OrphansController</a>
  
    <li><a href="./OrphansHelper.html">OrphansHelper</a>
  
    <li><a href="./OwnedSetTagging.html">OwnedSetTagging</a>
  
    <li><a href="./OwnedTagSet.html">OwnedTagSet</a>
  
    <li><a href="./OwnedTagSetsController.html">OwnedTagSetsController</a>
  
    <li><a href="./PasswordsController.html">PasswordsController</a>
  
    <li><a href="./People.html">People</a>
  
    <li><a href="./PeopleController.html">PeopleController</a>
  
    <li><a href="./PotentialMatch.html">PotentialMatch</a>
  
    <li><a href="./PotentialMatchSettings.html">PotentialMatchSettings</a>
  
    <li><a href="./PotentialMatchesController.html">PotentialMatchesController</a>
  
    <li><a href="./PotentialPromptMatch.html">PotentialPromptMatch</a>
  
    <li><a href="./Preference.html">Preference</a>
  
    <li><a href="./PreferencesController.html">PreferencesController</a>
  
    <li><a href="./Profile.html">Profile</a>
  
    <li><a href="./ProfileController.html">ProfileController</a>
  
    <li><a href="./Prompt.html">Prompt</a>
  
    <li><a href="./PromptMeme.html">PromptMeme</a>
  
    <li><a href="./PromptRestriction.html">PromptRestriction</a>
  
    <li><a href="./PromptRestrictionsHelper.html">PromptRestrictionsHelper</a>
  
    <li><a href="./PromptsController.html">PromptsController</a>
  
    <li><a href="./Pseud.html">Pseud</a>
  
    <li><a href="./PseudSweeper.html">PseudSweeper</a>
  
    <li><a href="./PseudsController.html">PseudsController</a>
  
    <li><a href="./PseudsHelper.html">PseudsHelper</a>
  
    <li><a href="./Rating.html">Rating</a>
  
    <li><a href="./Reading.html">Reading</a>
  
    <li><a href="./ReadingsController.html">ReadingsController</a>
  
    <li><a href="./RedirectController.html">RedirectController</a>
  
    <li><a href="./RedisMailQueue.html">RedisMailQueue</a>
  
    <li><a href="./RelatedWork.html">RelatedWork</a>
  
    <li><a href="./RelatedWorksController.html">RelatedWorksController</a>
  
    <li><a href="./Relationship.html">Relationship</a>
  
    <li><a href="./RelationshipNomination.html">RelationshipNomination</a>
  
    <li><a href="./Request.html">Request</a>
  
    <li><a href="./Role.html">Role</a>
  
    <li><a href="./RolesUser.html">RolesUser</a>
  
    <li><a href="./SearchController.html">SearchController</a>
  
    <li><a href="./SearchHelper.html">SearchHelper</a>
  
    <li><a href="./SerialWork.html">SerialWork</a>
  
    <li><a href="./SerialWorksController.html">SerialWorksController</a>
  
    <li><a href="./Series.html">Series</a>
  
    <li><a href="./SeriesController.html">SeriesController</a>
  
    <li><a href="./SeriesHelper.html">SeriesHelper</a>
  
    <li><a href="./SetTagging.html">SetTagging</a>
  
    <li><a href="./Skin.html">Skin</a>
  
    <li><a href="./SkinParent.html">SkinParent</a>
  
    <li><a href="./SkinsController.html">SkinsController</a>
  
    <li><a href="./SkinsHelper.html">SkinsHelper</a>
  
    <li><a href="./StatCounter.html">StatCounter</a>
  
    <li><a href="./StaticSweeper.html">StaticSweeper</a>
  
    <li><a href="./StatsController.html">StatsController</a>
  
    <li><a href="./StatsHelper.html">StatsHelper</a>
  
    <li><a href="./Subscription.html">Subscription</a>
  
    <li><a href="./SubscriptionsController.html">SubscriptionsController</a>
  
    <li><a href="./Tag.html">Tag</a>
  
    <li><a href="./TagNomination.html">TagNomination</a>
  
    <li><a href="./TagNominationsController.html">TagNominationsController</a>
  
    <li><a href="./TagSet.html">TagSet</a>
  
    <li><a href="./TagSetAssociation.html">TagSetAssociation</a>
  
    <li><a href="./TagSetAssociationsController.html">TagSetAssociationsController</a>
  
    <li><a href="./TagSetNomination.html">TagSetNomination</a>
  
    <li><a href="./TagSetNominationsController.html">TagSetNominationsController</a>
  
    <li><a href="./TagSetOwnership.html">TagSetOwnership</a>
  
    <li><a href="./TagSetSweeper.html">TagSetSweeper</a>
  
    <li><a href="./TagSetsHelper.html">TagSetsHelper</a>
  
    <li><a href="./TagSweeper.html">TagSweeper</a>
  
    <li><a href="./TagWranglersController.html">TagWranglersController</a>
  
    <li><a href="./TagWranglingsController.html">TagWranglingsController</a>
  
    <li><a href="./Tagging.html">Tagging</a>
  
    <li><a href="./TagsController.html">TagsController</a>
  
    <li><a href="./TagsHelper.html">TagsHelper</a>
  
    <li><a href="./TranslationHelper.html">TranslationHelper</a>
  
    <li><a href="./TranslationNote.html">TranslationNote</a>
  
    <li><a href="./TranslationNotesController.html">TranslationNotesController</a>
  
    <li><a href="./TranslationsController.html">TranslationsController</a>
  
    <li><a href="./TranslatorsController.html">TranslatorsController</a>
  
    <li><a href="./UnsortedTag.html">UnsortedTag</a>
  
    <li><a href="./UnsortedTagsController.html">UnsortedTagsController</a>
  
    <li><a href="./UrlActiveValidator.html">UrlActiveValidator</a>
  
    <li><a href="./UrlFormatValidator.html">UrlFormatValidator</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./UserInviteRequest.html">UserInviteRequest</a>
  
    <li><a href="./UserInviteRequestsController.html">UserInviteRequestsController</a>
  
    <li><a href="./UserInviteRequestsHelper.html">UserInviteRequestsHelper</a>
  
    <li><a href="./UserMailer.html">UserMailer</a>
  
    <li><a href="./UserSession.html">UserSession</a>
  
    <li><a href="./UserSessionsController.html">UserSessionsController</a>
  
    <li><a href="./UsersController.html">UsersController</a>
  
    <li><a href="./UsersHelper.html">UsersHelper</a>
  
    <li><a href="./ValidationHelper.html">ValidationHelper</a>
  
    <li><a href="./Warning.html">Warning</a>
  
    <li><a href="./WeightedRandom.html">WeightedRandom</a>
  
    <li><a href="./Work.html">Work</a>
  
    <li><a href="./WorkLink.html">WorkLink</a>
  
    <li><a href="./WorkLinksController.html">WorkLinksController</a>
  
    <li><a href="./WorkObserver.html">WorkObserver</a>
  
    <li><a href="./WorkSkin.html">WorkSkin</a>
  
    <li><a href="./WorkSweeper.html">WorkSweeper</a>
  
    <li><a href="./WorksController.html">WorksController</a>
  
    <li><a href="./WorksHelper.html">WorksHelper</a>
  
    <li><a href="./WranglingAssignment.html">WranglingAssignment</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class TagsController</h1>

  <div id="description" class="description">
    
  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-create" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>POST /tags POST /tags.xml</p>
          

          
          <div class="method-source-code" id="create-source">
            <pre><span class="ruby-comment"># File app/controllers/tags_controller.rb, line 159</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create</span>
  <span class="ruby-identifier">type</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:tag</span>][<span class="ruby-value">:type</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:tag</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span>
    <span class="ruby-identifier">model</span> = <span class="ruby-identifier">type</span>.<span class="ruby-identifier">classify</span>.<span class="ruby-identifier">constantize</span> <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-ivar">@tag</span> = <span class="ruby-identifier">model</span>.<span class="ruby-identifier">find_or_create_by_name</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:tag</span>][<span class="ruby-value">:name</span>])  <span class="ruby-keyword">if</span> <span class="ruby-identifier">model</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Class</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">setflash</span>; <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;Please provide a category.&quot;</span>)
    <span class="ruby-ivar">@tag</span> = <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:tag</span>][<span class="ruby-value">:name</span>])
    <span class="ruby-identifier">render</span> <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;new&quot;</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@tag</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">valid?</span>
    <span class="ruby-keyword">if</span> (<span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:tag</span>][<span class="ruby-value">:name</span>]) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:tag</span>][<span class="ruby-value">:name</span>].<span class="ruby-identifier">downcase</span>) <span class="ruby-comment"># only capitalization different</span>
      <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">update_attribute</span>(<span class="ruby-value">:name</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:tag</span>][<span class="ruby-value">:name</span>])  <span class="ruby-comment"># use the new capitalization</span>
      <span class="ruby-identifier">setflash</span>; <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;Tag was successfully modified.&quot;</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">setflash</span>; <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;Tag was successfully created.&quot;</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">update_attribute</span>(<span class="ruby-value">:canonical</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:tag</span>][<span class="ruby-value">:canonical</span>])
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">url_for</span>(<span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;tags&quot;</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;edit&quot;</span>, <span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@tag</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;new&quot;</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- create-source -->
          
        </div>

        

        
      </div><!-- create-method -->

    
      <div id="method-i-edit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">edit</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="edit-source">
            <pre><span class="ruby-comment"># File app/controllers/tags_controller.rb, line 183</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">edit</span>
  <span class="ruby-ivar">@page_subtitle</span> = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">name</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Banned</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">logged_in_as_admin?</span>
    <span class="ruby-identifier">setflash</span>; <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;Please log in as admin&quot;</span>)
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">tag_wranglings_path</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@counts</span> = {}
  <span class="ruby-ivar">@uses</span> = [<span class="ruby-string">'Works'</span>, <span class="ruby-string">'Drafts'</span>, <span class="ruby-string">'Bookmarks'</span>, <span class="ruby-string">'Private Bookmarks'</span>, <span class="ruby-string">'External Works'</span>]
  <span class="ruby-ivar">@counts</span>[<span class="ruby-string">'Works'</span>] = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">visible_works_count</span>
  <span class="ruby-ivar">@counts</span>[<span class="ruby-string">'Drafts'</span>] = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">works</span>.<span class="ruby-identifier">unposted</span>.<span class="ruby-identifier">count</span>
  <span class="ruby-ivar">@counts</span>[<span class="ruby-string">'Bookmarks'</span>] = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">visible_bookmarks_count</span>
  <span class="ruby-ivar">@counts</span>[<span class="ruby-string">'Private Bookmarks'</span>] = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">bookmarks</span>.<span class="ruby-identifier">not_public</span>.<span class="ruby-identifier">count</span>
  <span class="ruby-ivar">@counts</span>[<span class="ruby-string">'External Works'</span>] = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">visible_external_works_count</span>

  <span class="ruby-ivar">@parents</span> = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">parents</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>, <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:name</span>).<span class="ruby-identifier">group_by</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">tag</span><span class="ruby-operator">|</span> <span class="ruby-identifier">tag</span>[<span class="ruby-value">:type</span>]}
  <span class="ruby-ivar">@parents</span>[<span class="ruby-string">'MetaTag'</span>] = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">direct_meta_tags</span>.<span class="ruby-identifier">by_name</span>
  <span class="ruby-ivar">@children</span> = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>, <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:name</span>).<span class="ruby-identifier">group_by</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">tag</span><span class="ruby-operator">|</span> <span class="ruby-identifier">tag</span>[<span class="ruby-value">:type</span>]}
  <span class="ruby-ivar">@children</span>[<span class="ruby-string">'SubTag'</span>] = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">direct_sub_tags</span>.<span class="ruby-identifier">by_name</span>
  <span class="ruby-ivar">@children</span>[<span class="ruby-string">'Merger'</span>] = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">mergers</span>.<span class="ruby-identifier">by_name</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:wranglers</span>)
    <span class="ruby-ivar">@wranglers</span> = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">canonical</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">wranglers</span> <span class="ruby-operator">:</span> (<span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">merger</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">merger</span>.<span class="ruby-identifier">wranglers</span> <span class="ruby-operator">:</span> [])
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:fandoms</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">fandoms</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-ivar">@wranglers</span> = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">fandoms</span>.<span class="ruby-identifier">collect</span>(&amp;<span class="ruby-value">:wranglers</span>).<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@suggested_fandoms</span> = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">suggested_fandoms</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">fandoms</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:fandoms</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- edit-source -->
          
        </div>

        

        
      </div><!-- edit-method -->

    
      <div id="method-i-feed" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">feed</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="feed-source">
            <pre><span class="ruby-comment"># File app/controllers/tags_controller.rb, line 86</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">feed</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-ivar">@tag</span> = <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">RecordNotFound</span>
    <span class="ruby-identifier">setflash</span>; <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;Tag not found!&quot;</span>)
    <span class="ruby-identifier">redirect_back_or_default</span>(<span class="ruby-identifier">tags_path</span>)
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">canonical?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">merger</span>
    <span class="ruby-ivar">@tag</span> = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">merger</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># Temp for testing</span>
  <span class="ruby-keyword">if</span> <span class="ruby-node">%w(Fandom Character Relationship)</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span>) <span class="ruby-operator">||</span> <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;F/F&quot;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">canonical?</span>
      <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">filtered_works</span>.<span class="ruby-identifier">visible_to_all</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;created_at DESC&quot;</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-value">25</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">works</span>.<span class="ruby-identifier">visible_to_all</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;created_at DESC&quot;</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-value">25</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">tag_works_path</span>(<span class="ruby-value">:tag_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">to_param</span>) <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">atom</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- feed-source -->
          
        </div>

        

        
      </div><!-- feed-method -->

    
      <div id="method-i-index" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">index</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>GET /tags GET /tags.xml</p>
          

          
          <div class="method-source-code" id="index-source">
            <pre><span class="ruby-comment"># File app/controllers/tags_controller.rb, line 21</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">index</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@collection</span>
    <span class="ruby-ivar">@tags</span> = <span class="ruby-constant">Freeform</span>.<span class="ruby-identifier">canonical</span>.<span class="ruby-identifier">for_collections_with_count</span>([<span class="ruby-ivar">@collection</span>] <span class="ruby-operator">+</span> <span class="ruby-ivar">@collection</span>.<span class="ruby-identifier">children</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">no_fandom</span> = <span class="ruby-constant">Fandom</span>.<span class="ruby-identifier">find_by_name</span>(<span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">FANDOM_NO_TAG_NAME</span>)
    <span class="ruby-ivar">@tags</span> = <span class="ruby-identifier">no_fandom</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">by_type</span>(<span class="ruby-string">&quot;Freeform&quot;</span>).<span class="ruby-identifier">first_class</span>.<span class="ruby-identifier">limit</span>(<span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">TAGS_IN_CLOUD</span>)
    <span class="ruby-comment"># have to put canonical at the end so that it doesn't overwrite sort order for random and popular</span>
    <span class="ruby-comment"># and then sort again at the very end to make it alphabetic</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:show</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;random&quot;</span>
      <span class="ruby-ivar">@tags</span> = <span class="ruby-ivar">@tags</span>.<span class="ruby-identifier">random</span>.<span class="ruby-identifier">canonical</span>.<span class="ruby-identifier">sort</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@tags</span> = <span class="ruby-ivar">@tags</span>.<span class="ruby-identifier">popular</span>.<span class="ruby-identifier">canonical</span>.<span class="ruby-identifier">sort</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- index-source -->
          
        </div>

        

        
      </div><!-- index-method -->

    
      <div id="method-i-load_tag" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">load_tag</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="load_tag-source">
            <pre><span class="ruby-comment"># File app/controllers/tags_controller.rb, line 11</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">load_tag</span>
  <span class="ruby-ivar">@tag</span> = <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">find_by_name</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
  <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@tag</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Tag</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">RecordNotFound</span>, <span class="ruby-node">&quot;Couldn't find tag named '#{params[:id]}'&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- load_tag-source -->
          
        </div>

        

        
      </div><!-- load_tag-method -->

    
      <div id="method-i-mass_update" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mass_update</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="mass_update-source">
            <pre><span class="ruby-comment"># File app/controllers/tags_controller.rb, line 265</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mass_update</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>] = <span class="ruby-string">'1'</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">blank?</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_column</span>] = <span class="ruby-string">'name'</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">valid_sort_column</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_column</span>], <span class="ruby-string">'tag'</span>)
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_direction</span>] = <span class="ruby-string">'ASC'</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">valid_sort_direction</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_direction</span>])

  <span class="ruby-identifier">saved</span> = []
  <span class="ruby-identifier">not_saved</span> = []
  
  <span class="ruby-comment"># make tags canonical</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:canonicals</span>].<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:canonicals</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tag_id</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">tag</span> = <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">tag_id</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:canonical</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>)
        <span class="ruby-identifier">saved</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">tag</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">not_saved</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">tag</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># remove associated tags</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:remove_associated</span>].<span class="ruby-identifier">blank?</span>      
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:remove_associated</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tag_id</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">tag_to_remove</span> = <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">tag_id</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">tag_to_remove</span>
        <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">remove_association</span>(<span class="ruby-identifier">tag_to_remove</span>)
        <span class="ruby-identifier">saved</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">tag_to_remove</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">setflash</span>; <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;The following tags were successfully updated: %{tags_saved}&quot;</span>, <span class="ruby-value">:tags_saved</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">saved</span>.<span class="ruby-identifier">collect</span>(&amp;<span class="ruby-value">:name</span>).<span class="ruby-identifier">join</span>(<span class="ruby-string">', '</span>)) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">saved</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-identifier">setflash</span>; <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;The following tags weren't saved: %{tags_not_saved}&quot;</span>, <span class="ruby-value">:tags_not_saved</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">not_saved</span>.<span class="ruby-identifier">collect</span>(&amp;<span class="ruby-value">:name</span>).<span class="ruby-identifier">join</span>(<span class="ruby-string">', '</span>)) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">not_saved</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">url_for</span>(<span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:tags</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:wrangle</span>, <span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>], <span class="ruby-value">:show</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:show</span>], <span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:sort_column</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_column</span>], <span class="ruby-value">:sort_direction</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_direction</span>], <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:status</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- mass_update-source -->
          
        </div>

        

        
      </div><!-- mass_update-method -->

    
      <div id="method-i-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>GET /tags/new GET /tags/new.xml</p>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File app/controllers/tags_controller.rb, line 149</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@tag</span> = <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">new</span>

  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment"># new.html.erb</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
      <div id="method-i-search" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="search-source">
            <pre><span class="ruby-comment"># File app/controllers/tags_controller.rb, line 37</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search</span>
  <span class="ruby-ivar">@query</span> = {}
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:query</span>]
    <span class="ruby-ivar">@query</span> = <span class="ruby-constant">Query</span>.<span class="ruby-identifier">standardize</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:query</span>])
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">page</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>] <span class="ruby-operator">||</span> <span class="ruby-value">1</span>
      <span class="ruby-identifier">errors</span>, <span class="ruby-ivar">@tags</span> = <span class="ruby-constant">Query</span>.<span class="ruby-identifier">search_with_sphinx</span>(<span class="ruby-constant">Tag</span>, <span class="ruby-ivar">@query</span>, <span class="ruby-identifier">page</span>)
      <span class="ruby-identifier">setflash</span>; <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot; &quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Riddle</span><span class="ruby-operator">::</span><span class="ruby-constant">ConnectionError</span>
      <span class="ruby-identifier">setflash</span>; <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;The search engine seems to be down at the moment, sorry!&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- search-source -->
          
        </div>

        

        
      </div><!-- search-method -->

    
      <div id="method-i-show" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">show</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>if user is <a href="Admin.html">Admin</a> or <a href="Tag.html">Tag</a>
Wrangler, show them details about the tag if user is not logged in or a
regular user, show them</p>

<pre>1. the works, if the tag had been wrangled and we can redirect them to works using it or its canonical merger
2. the tag, the works and the bookmarks using it, if the tag is unwrangled (because we can't redirect them
    to the works controller)</pre>
          

          
          <div class="method-source-code" id="show-source">
            <pre><span class="ruby-comment"># File app/controllers/tags_controller.rb, line 56</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">show</span>
  <span class="ruby-ivar">@page_subtitle</span> = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">name</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Banned</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">logged_in_as_admin?</span>
    <span class="ruby-identifier">setflash</span>; <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;Please log in as admin&quot;</span>)
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">tag_wranglings_path</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># if tag is NOT wrangled, prepare to show works and bookmarks that are using it</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">canonical</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">merger</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">logged_in?</span> <span class="ruby-comment">#current_user.is_a?User</span>
      <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">works</span>.<span class="ruby-identifier">visible_to_registered_user</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>])
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">logged_in_as_admin?</span>
      <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">works</span>.<span class="ruby-identifier">visible_to_owner</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>])
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">works</span>.<span class="ruby-identifier">visible_to_all</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>])
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@bookmarks</span> = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">bookmarks</span>.<span class="ruby-identifier">visible</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>])
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># cache the children, since it's a possibly massive query</span>
  <span class="ruby-ivar">@tag_children</span> = <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">cache</span>.<span class="ruby-identifier">fetch</span> <span class="ruby-node">&quot;views/tags/#{@tag.cache_key}/children&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">children</span> = {}
    (<span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">child_types</span> <span class="ruby-operator">-</span> <span class="ruby-node">%w(SubTag)</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">child_type</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">tags</span> = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">child_type</span>.<span class="ruby-identifier">underscore</span>.<span class="ruby-identifier">pluralize</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">'taggings_count DESC'</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">TAG_LIST_LIMIT</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>)
      <span class="ruby-keyword">unless</span> <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">blank?</span>
        <span class="ruby-identifier">children</span>[<span class="ruby-identifier">child_type</span>] = <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">uniq</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">children</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- show-source -->
          
        </div>

        

        
      </div><!-- show-method -->

    
      <div id="method-i-show_hidden" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">show_hidden</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="show_hidden-source">
            <pre><span class="ruby-comment"># File app/controllers/tags_controller.rb, line 114</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">show_hidden</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:creation_id</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:creation_type</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:tag_type</span>].<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">model</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:creation_type</span>].<span class="ruby-identifier">classify</span>.<span class="ruby-identifier">constantize</span> <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-ivar">@display_creation</span> = <span class="ruby-identifier">model</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:creation_id</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">model</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Class</span>
    <span class="ruby-comment"># Tags aren't directly on series, so we need to handle them differently</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:creation_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'Series'</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:tag_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'warnings'</span>
        <span class="ruby-ivar">@display_tags</span> = <span class="ruby-ivar">@display_creation</span>.<span class="ruby-identifier">works</span>.<span class="ruby-identifier">visible</span>.<span class="ruby-identifier">collect</span>(&amp;<span class="ruby-value">:warning_tags</span>).<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">sort</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@display_tags</span> = <span class="ruby-ivar">@display_creation</span>.<span class="ruby-identifier">works</span>.<span class="ruby-identifier">visible</span>.<span class="ruby-identifier">collect</span>(&amp;<span class="ruby-value">:freeform_tags</span>).<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">sort</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">if</span> <span class="ruby-node">%w(warnings freeforms)</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:tag_type</span>])
        <span class="ruby-ivar">@display_tags</span> = <span class="ruby-ivar">@display_creation</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:tag_type</span>]).<span class="ruby-identifier">sort</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@display_category</span> = <span class="ruby-ivar">@display_tags</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">pluralize</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-keyword">do</span>
      <span class="ruby-comment"># This is just a quick fix to avoid script barf if JavaScript is disabled</span>
      <span class="ruby-identifier">setflash</span>; <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">&quot;Sorry, you need to have JavaScript enabled for this.&quot;</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">&quot;HTTP_REFERER&quot;</span>]
        <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">&quot;HTTP_REFERER&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">root_path</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-comment"># else branch needed to deal with bots, which don't have a referer</span>
        <span class="ruby-identifier">redirect_to</span> <span class="ruby-string">'/'</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- show_hidden-source -->
          
        </div>

        

        
      </div><!-- show_hidden-method -->

    
      <div id="method-i-update" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="update-source">
            <pre><span class="ruby-comment"># File app/controllers/tags_controller.rb, line 210</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update</span>
  <span class="ruby-comment"># update everything except for the synonym,</span>
  <span class="ruby-comment"># so that the associations are there to move when the synonym is created</span>
  <span class="ruby-identifier">syn_string</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:tag</span>].<span class="ruby-identifier">delete</span>(<span class="ruby-value">:syn_string</span>)
  <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">attributes</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:tag</span>]
  <span class="ruby-comment"># Limiting the conditions under which you can update the tag type</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">can_change_type?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-node">%w(Fandom Character Relationship Freeform UnsortedTag)</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:tag</span>][<span class="ruby-value">:type</span>])
    <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">type</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:tag</span>][<span class="ruby-value">:type</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">syn_string</span> = <span class="ruby-identifier">syn_string</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-identifier">setflash</span>; <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-string">'Tag was updated.'</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:commit</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Wrangle&quot;</span>
      <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>] = <span class="ruby-string">'1'</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">blank?</span>
      <span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_column</span>] = <span class="ruby-string">'name'</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">valid_sort_column</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_column</span>], <span class="ruby-string">&quot;tag&quot;</span>)
      <span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_direction</span>] = <span class="ruby-string">'ASC'</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">valid_sort_direction</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_direction</span>])
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">url_for</span>(<span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:tags</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:wrangle</span>, <span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>], <span class="ruby-value">:show</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:show</span>], <span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:sort_column</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_column</span>], <span class="ruby-value">:sort_direction</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_direction</span>], <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:status</span>])
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">url_for</span>(<span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;tags&quot;</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;edit&quot;</span>, <span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@tag</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@parents</span> = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">parents</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>, <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:name</span>).<span class="ruby-identifier">group_by</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">tag</span><span class="ruby-operator">|</span> <span class="ruby-identifier">tag</span>[<span class="ruby-value">:type</span>]}
    <span class="ruby-ivar">@parents</span>[<span class="ruby-string">'MetaTag'</span>] = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">direct_meta_tags</span>.<span class="ruby-identifier">by_name</span>
    <span class="ruby-ivar">@children</span> = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>, <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:name</span>).<span class="ruby-identifier">group_by</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">tag</span><span class="ruby-operator">|</span> <span class="ruby-identifier">tag</span>[<span class="ruby-value">:type</span>]}
    <span class="ruby-ivar">@children</span>[<span class="ruby-string">'SubTag'</span>] = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">direct_sub_tags</span>.<span class="ruby-identifier">by_name</span>
    <span class="ruby-ivar">@children</span>[<span class="ruby-string">'Merger'</span>] = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">mergers</span>.<span class="ruby-identifier">by_name</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:edit</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- update-source -->
          
        </div>

        

        
      </div><!-- update-method -->

    
      <div id="method-i-wrangle" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">wrangle</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="wrangle-source">
            <pre><span class="ruby-comment"># File app/controllers/tags_controller.rb, line 240</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">wrangle</span>
  <span class="ruby-ivar">@page_subtitle</span> = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">name</span>
  <span class="ruby-ivar">@counts</span> = {}
  <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">child_types</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">underscore</span>.<span class="ruby-identifier">pluralize</span>.<span class="ruby-identifier">to_sym</span>}.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tag_type</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@counts</span>[<span class="ruby-identifier">tag_type</span>] = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">tag_type</span>).<span class="ruby-identifier">count</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-node">%w(fandoms characters relationships freeforms sub_tags mergers)</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:show</span>])
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_column</span>] = <span class="ruby-string">'name'</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">valid_sort_column</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_column</span>], <span class="ruby-string">'tag'</span>)
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_direction</span>] = <span class="ruby-string">'ASC'</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">valid_sort_direction</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_direction</span>])
    <span class="ruby-identifier">sort</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_column</span>] <span class="ruby-operator">+</span> <span class="ruby-string">&quot; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_direction</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">sort</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">'suggested'</span>)
      <span class="ruby-identifier">sort</span> = <span class="ruby-identifier">sort</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;, name ASC&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment"># this makes sure params[:status] is safe</span>
    <span class="ruby-keyword">if</span> <span class="ruby-node">%w(unfilterable canonical noncanonical unwrangleable)</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:status</span>])
      <span class="ruby-ivar">@tags</span> = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:show</span>]).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">sort</span>).<span class="ruby-identifier">send</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:status</span>]).<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">ITEMS_PER_PAGE</span>)
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:status</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;unwrangled&quot;</span>
      <span class="ruby-ivar">@tags</span> = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">same_work_tags</span>.<span class="ruby-identifier">unwrangled</span>.<span class="ruby-identifier">by_type</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:show</span>].<span class="ruby-identifier">singularize</span>.<span class="ruby-identifier">camelize</span>).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">sort</span>).<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">ITEMS_PER_PAGE</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@tags</span> = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:show</span>]).<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>, <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sort</span>).<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">ITEMS_PER_PAGE</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- wrangle-source -->
          
        </div>

        

        
      </div><!-- wrangle-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

