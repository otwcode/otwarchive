<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>Class: DevmodeController</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/controllers/devmode_controller.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="ApplicationController.html">ApplicationController</a>
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-i-_get_view_paths">#_get_view_paths</a>
    
    <li><a href="#method-i-backtrace_view">#backtrace_view</a>
    
    <li><a href="#method-i-comment_work">#comment_work</a>
    
    <li><a href="#method-i-comment_works">#comment_works</a>
    
    <li><a href="#method-i-create_work">#create_work</a>
    
    <li><a href="#method-i-development_only">#development_only</a>
    
    <li><a href="#method-i-get_controller_dir">#get_controller_dir</a>
    
    <li><a href="#method-i-get_links_to">#get_links_to</a>
    
    <li><a href="#method-i-get_view_dir">#get_view_dir</a>
    
    <li><a href="#method-i-get_view_paths">#get_view_paths</a>
    
    <li><a href="#method-i-index">#index</a>
    
    <li><a href="#method-i-inspect_view">#inspect_view</a>
    
    <li><a href="#method-i-list_controllers">#list_controllers</a>
    
    <li><a href="#method-i-list_views">#list_views</a>
    
    <li><a href="#method-i-load_erb">#load_erb</a>
    
    <li><a href="#method-i-process_dir">#process_dir</a>
    
    <li><a href="#method-i-process_file">#process_file</a>
    
    <li><a href="#method-i-profile_logs">#profile_logs</a>
    
    <li><a href="#method-i-random_chapter">#random_chapter</a>
    
    <li><a href="#method-i-random_sentence">#random_sentence</a>
    
    <li><a href="#method-i-seedusers">#seedusers</a>
    
    <li><a href="#method-i-seedworks">#seedworks</a>
    
    <li><a href="#method-i-unregister_imports">#unregister_imports</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./app/mailers/README.html">README</a>
  
    <li class="file"><a href="./app/views/epub/mimetype.html">mimetype</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./Static.html">Static</a>
  
    <li><a href="./Static/BaseController.html">Static::BaseController</a>
  
    <li><a href="./Static/CollectionsController.html">Static::CollectionsController</a>
  
    <li><a href="./Static/FandomsController.html">Static::FandomsController</a>
  
    <li><a href="./Static/MediaController.html">Static::MediaController</a>
  
    <li><a href="./Static/RestrictedWorksController.html">Static::RestrictedWorksController</a>
  
    <li><a href="./Static/WorksController.html">Static::WorksController</a>
  
    <li><a href="./Admin.html">Admin</a>
  
    <li><a href="./Admin/AdminInvitationsController.html">Admin::AdminInvitationsController</a>
  
    <li><a href="./Admin/AdminUsersController.html">Admin::AdminUsersController</a>
  
    <li><a href="./Admin/SettingsController.html">Admin::SettingsController</a>
  
    <li><a href="./Admin/SkinsController.html">Admin::SkinsController</a>
  
    <li><a href="./Admin/UserCreationsController.html">Admin::UserCreationsController</a>
  
    <li><a href="./Challenge.html">Challenge</a>
  
    <li><a href="./Challenge/GiftExchangeController.html">Challenge::GiftExchangeController</a>
  
    <li><a href="./Challenge/PromptMemeController.html">Challenge::PromptMemeController</a>
  
    <li><a href="./StoryParser.html">StoryParser</a>
  
    <li><a href="./StoryParser/Error.html">StoryParser::Error</a>
  
    <li><a href="./AbuseReport.html">AbuseReport</a>
  
    <li><a href="./AbuseReportsController.html">AbuseReportsController</a>
  
    <li><a href="./AdminMailer.html">AdminMailer</a>
  
    <li><a href="./AdminPost.html">AdminPost</a>
  
    <li><a href="./AdminPostTag.html">AdminPostTag</a>
  
    <li><a href="./AdminPostTagging.html">AdminPostTagging</a>
  
    <li><a href="./AdminPostsController.html">AdminPostsController</a>
  
    <li><a href="./AdminSession.html">AdminSession</a>
  
    <li><a href="./AdminSessionsController.html">AdminSessionsController</a>
  
    <li><a href="./AdminSetting.html">AdminSetting</a>
  
    <li><a href="./AdminsController.html">AdminsController</a>
  
    <li><a href="./AdvancedSearchHelper.html">AdvancedSearchHelper</a>
  
    <li><a href="./AlphabetHelper.html">AlphabetHelper</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./ArchiveFaq.html">ArchiveFaq</a>
  
    <li><a href="./ArchiveFaqsController.html">ArchiveFaqsController</a>
  
    <li><a href="./AutocompleteController.html">AutocompleteController</a>
  
    <li><a href="./Banned.html">Banned</a>
  
    <li><a href="./Bookmark.html">Bookmark</a>
  
    <li><a href="./BookmarksController.html">BookmarksController</a>
  
    <li><a href="./BookmarksHelper.html">BookmarksHelper</a>
  
    <li><a href="./CacheHelper.html">CacheHelper</a>
  
    <li><a href="./CastNomination.html">CastNomination</a>
  
    <li><a href="./Category.html">Category</a>
  
    <li><a href="./ChallengeAssignment.html">ChallengeAssignment</a>
  
    <li><a href="./ChallengeAssignmentsController.html">ChallengeAssignmentsController</a>
  
    <li><a href="./ChallengeClaim.html">ChallengeClaim</a>
  
    <li><a href="./ChallengeClaimsController.html">ChallengeClaimsController</a>
  
    <li><a href="./ChallengeHelper.html">ChallengeHelper</a>
  
    <li><a href="./ChallengeRequestsController.html">ChallengeRequestsController</a>
  
    <li><a href="./ChallengeSignup.html">ChallengeSignup</a>
  
    <li><a href="./ChallengeSignupObserver.html">ChallengeSignupObserver</a>
  
    <li><a href="./ChallengeSignupSweeper.html">ChallengeSignupSweeper</a>
  
    <li><a href="./ChallengeSignupsController.html">ChallengeSignupsController</a>
  
    <li><a href="./ChallengeSweeper.html">ChallengeSweeper</a>
  
    <li><a href="./ChallengesController.html">ChallengesController</a>
  
    <li><a href="./Chapter.html">Chapter</a>
  
    <li><a href="./ChapterSweeper.html">ChapterSweeper</a>
  
    <li><a href="./ChaptersController.html">ChaptersController</a>
  
    <li><a href="./ChaptersHelper.html">ChaptersHelper</a>
  
    <li><a href="./Character.html">Character</a>
  
    <li><a href="./CharacterNomination.html">CharacterNomination</a>
  
    <li><a href="./Collection.html">Collection</a>
  
    <li><a href="./CollectionItem.html">CollectionItem</a>
  
    <li><a href="./CollectionItemsController.html">CollectionItemsController</a>
  
    <li><a href="./CollectionObserver.html">CollectionObserver</a>
  
    <li><a href="./CollectionParticipant.html">CollectionParticipant</a>
  
    <li><a href="./CollectionParticipantsController.html">CollectionParticipantsController</a>
  
    <li><a href="./CollectionPreference.html">CollectionPreference</a>
  
    <li><a href="./CollectionProfile.html">CollectionProfile</a>
  
    <li><a href="./CollectionProfileController.html">CollectionProfileController</a>
  
    <li><a href="./CollectionSweeper.html">CollectionSweeper</a>
  
    <li><a href="./CollectionsController.html">CollectionsController</a>
  
    <li><a href="./CollectionsHelper.html">CollectionsHelper</a>
  
    <li><a href="./Comment.html">Comment</a>
  
    <li><a href="./CommentMailer.html">CommentMailer</a>
  
    <li><a href="./CommentObserver.html">CommentObserver</a>
  
    <li><a href="./CommentSweeper.html">CommentSweeper</a>
  
    <li><a href="./CommentsController.html">CommentsController</a>
  
    <li><a href="./CommentsHelper.html">CommentsHelper</a>
  
    <li><a href="./CommonTagging.html">CommonTagging</a>
  
    <li><a href="./CreationObserver.html">CreationObserver</a>
  
    <li><a href="./Creatorship.html">Creatorship</a>
  
    <li><a href="./DateHelper.html">DateHelper</a>
  
    <li><a href="./DevmodeController.html">DevmodeController</a>
  
    <li><a href="./DownloadsController.html">DownloadsController</a>
  
    <li><a href="./EmailVeracityValidator.html">EmailVeracityValidator</a>
  
    <li><a href="./ErrorsController.html">ErrorsController</a>
  
    <li><a href="./ExternalAuthor.html">ExternalAuthor</a>
  
    <li><a href="./ExternalAuthorName.html">ExternalAuthorName</a>
  
    <li><a href="./ExternalAuthorsController.html">ExternalAuthorsController</a>
  
    <li><a href="./ExternalAuthorsHelper.html">ExternalAuthorsHelper</a>
  
    <li><a href="./ExternalCreatorship.html">ExternalCreatorship</a>
  
    <li><a href="./ExternalWork.html">ExternalWork</a>
  
    <li><a href="./ExternalWorksController.html">ExternalWorksController</a>
  
    <li><a href="./Fandom.html">Fandom</a>
  
    <li><a href="./FandomNomination.html">FandomNomination</a>
  
    <li><a href="./FandomsController.html">FandomsController</a>
  
    <li><a href="./FeedSweeper.html">FeedSweeper</a>
  
    <li><a href="./Feedback.html">Feedback</a>
  
    <li><a href="./FeedbacksController.html">FeedbacksController</a>
  
    <li><a href="./FilterCount.html">FilterCount</a>
  
    <li><a href="./FilterTagging.html">FilterTagging</a>
  
    <li><a href="./Freeform.html">Freeform</a>
  
    <li><a href="./FreeformNomination.html">FreeformNomination</a>
  
    <li><a href="./Gift.html">Gift</a>
  
    <li><a href="./GiftExchange.html">GiftExchange</a>
  
    <li><a href="./GiftsController.html">GiftsController</a>
  
    <li><a href="./HitCounter.html">HitCounter</a>
  
    <li><a href="./HomeController.html">HomeController</a>
  
    <li><a href="./HomeHelper.html">HomeHelper</a>
  
    <li><a href="./InboxComment.html">InboxComment</a>
  
    <li><a href="./InboxController.html">InboxController</a>
  
    <li><a href="./InboxHelper.html">InboxHelper</a>
  
    <li><a href="./Invitation.html">Invitation</a>
  
    <li><a href="./InvitationsController.html">InvitationsController</a>
  
    <li><a href="./InvitationsHelper.html">InvitationsHelper</a>
  
    <li><a href="./InviteRequest.html">InviteRequest</a>
  
    <li><a href="./InviteRequestsController.html">InviteRequestsController</a>
  
    <li><a href="./KnownIssue.html">KnownIssue</a>
  
    <li><a href="./KnownIssuesController.html">KnownIssuesController</a>
  
    <li><a href="./Kudo.html">Kudo</a>
  
    <li><a href="./KudoMailer.html">KudoMailer</a>
  
    <li><a href="./KudoObserver.html">KudoObserver</a>
  
    <li><a href="./KudosController.html">KudosController</a>
  
    <li><a href="./Language.html">Language</a>
  
    <li><a href="./LanguagesController.html">LanguagesController</a>
  
    <li><a href="./Locale.html">Locale</a>
  
    <li><a href="./LocalesController.html">LocalesController</a>
  
    <li><a href="./LogItem.html">LogItem</a>
  
    <li><a href="./Media.html">Media</a>
  
    <li><a href="./MediaController.html">MediaController</a>
  
    <li><a href="./MetaTagging.html">MetaTagging</a>
  
    <li><a href="./Object.html">Object</a>
  
    <li><a href="./Offer.html">Offer</a>
  
    <li><a href="./OrphansController.html">OrphansController</a>
  
    <li><a href="./OrphansHelper.html">OrphansHelper</a>
  
    <li><a href="./OwnedSetTagging.html">OwnedSetTagging</a>
  
    <li><a href="./OwnedTagSet.html">OwnedTagSet</a>
  
    <li><a href="./OwnedTagSetsController.html">OwnedTagSetsController</a>
  
    <li><a href="./PasswordsController.html">PasswordsController</a>
  
    <li><a href="./People.html">People</a>
  
    <li><a href="./PeopleController.html">PeopleController</a>
  
    <li><a href="./PotentialMatch.html">PotentialMatch</a>
  
    <li><a href="./PotentialMatchSettings.html">PotentialMatchSettings</a>
  
    <li><a href="./PotentialMatchesController.html">PotentialMatchesController</a>
  
    <li><a href="./PotentialPromptMatch.html">PotentialPromptMatch</a>
  
    <li><a href="./Preference.html">Preference</a>
  
    <li><a href="./PreferencesController.html">PreferencesController</a>
  
    <li><a href="./Profile.html">Profile</a>
  
    <li><a href="./ProfileController.html">ProfileController</a>
  
    <li><a href="./Prompt.html">Prompt</a>
  
    <li><a href="./PromptMeme.html">PromptMeme</a>
  
    <li><a href="./PromptRestriction.html">PromptRestriction</a>
  
    <li><a href="./PromptRestrictionsHelper.html">PromptRestrictionsHelper</a>
  
    <li><a href="./PromptsController.html">PromptsController</a>
  
    <li><a href="./Pseud.html">Pseud</a>
  
    <li><a href="./PseudSweeper.html">PseudSweeper</a>
  
    <li><a href="./PseudsController.html">PseudsController</a>
  
    <li><a href="./PseudsHelper.html">PseudsHelper</a>
  
    <li><a href="./Rating.html">Rating</a>
  
    <li><a href="./Reading.html">Reading</a>
  
    <li><a href="./ReadingsController.html">ReadingsController</a>
  
    <li><a href="./RedirectController.html">RedirectController</a>
  
    <li><a href="./RelatedWork.html">RelatedWork</a>
  
    <li><a href="./RelatedWorksController.html">RelatedWorksController</a>
  
    <li><a href="./Relationship.html">Relationship</a>
  
    <li><a href="./RelationshipNomination.html">RelationshipNomination</a>
  
    <li><a href="./Request.html">Request</a>
  
    <li><a href="./Role.html">Role</a>
  
    <li><a href="./RolesUser.html">RolesUser</a>
  
    <li><a href="./SearchController.html">SearchController</a>
  
    <li><a href="./SearchHelper.html">SearchHelper</a>
  
    <li><a href="./SerialWork.html">SerialWork</a>
  
    <li><a href="./SerialWorksController.html">SerialWorksController</a>
  
    <li><a href="./Series.html">Series</a>
  
    <li><a href="./SeriesController.html">SeriesController</a>
  
    <li><a href="./SeriesHelper.html">SeriesHelper</a>
  
    <li><a href="./SetTagging.html">SetTagging</a>
  
    <li><a href="./Skin.html">Skin</a>
  
    <li><a href="./SkinParent.html">SkinParent</a>
  
    <li><a href="./SkinsController.html">SkinsController</a>
  
    <li><a href="./SkinsHelper.html">SkinsHelper</a>
  
    <li><a href="./StaticSweeper.html">StaticSweeper</a>
  
    <li><a href="./StatsController.html">StatsController</a>
  
    <li><a href="./StatsHelper.html">StatsHelper</a>
  
    <li><a href="./Subscription.html">Subscription</a>
  
    <li><a href="./SubscriptionsController.html">SubscriptionsController</a>
  
    <li><a href="./Tag.html">Tag</a>
  
    <li><a href="./TagNomination.html">TagNomination</a>
  
    <li><a href="./TagNominationsController.html">TagNominationsController</a>
  
    <li><a href="./TagSet.html">TagSet</a>
  
    <li><a href="./TagSetAssociation.html">TagSetAssociation</a>
  
    <li><a href="./TagSetAssociationsController.html">TagSetAssociationsController</a>
  
    <li><a href="./TagSetNomination.html">TagSetNomination</a>
  
    <li><a href="./TagSetNominationsController.html">TagSetNominationsController</a>
  
    <li><a href="./TagSetOwnership.html">TagSetOwnership</a>
  
    <li><a href="./TagSetSweeper.html">TagSetSweeper</a>
  
    <li><a href="./TagSetsHelper.html">TagSetsHelper</a>
  
    <li><a href="./TagSweeper.html">TagSweeper</a>
  
    <li><a href="./TagWranglersController.html">TagWranglersController</a>
  
    <li><a href="./TagWranglingsController.html">TagWranglingsController</a>
  
    <li><a href="./Tagging.html">Tagging</a>
  
    <li><a href="./TagsController.html">TagsController</a>
  
    <li><a href="./TagsHelper.html">TagsHelper</a>
  
    <li><a href="./TranslationHelper.html">TranslationHelper</a>
  
    <li><a href="./TranslationNote.html">TranslationNote</a>
  
    <li><a href="./TranslationNotesController.html">TranslationNotesController</a>
  
    <li><a href="./TranslationsController.html">TranslationsController</a>
  
    <li><a href="./TranslatorsController.html">TranslatorsController</a>
  
    <li><a href="./UrlActiveValidator.html">UrlActiveValidator</a>
  
    <li><a href="./UrlFormatValidator.html">UrlFormatValidator</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./UserInviteRequest.html">UserInviteRequest</a>
  
    <li><a href="./UserInviteRequestsController.html">UserInviteRequestsController</a>
  
    <li><a href="./UserInviteRequestsHelper.html">UserInviteRequestsHelper</a>
  
    <li><a href="./UserMailer.html">UserMailer</a>
  
    <li><a href="./UserSession.html">UserSession</a>
  
    <li><a href="./UserSessionsController.html">UserSessionsController</a>
  
    <li><a href="./UsersController.html">UsersController</a>
  
    <li><a href="./UsersHelper.html">UsersHelper</a>
  
    <li><a href="./ValidationHelper.html">ValidationHelper</a>
  
    <li><a href="./Warning.html">Warning</a>
  
    <li><a href="./WeightedRandom.html">WeightedRandom</a>
  
    <li><a href="./Work.html">Work</a>
  
    <li><a href="./WorkObserver.html">WorkObserver</a>
  
    <li><a href="./WorkSkin.html">WorkSkin</a>
  
    <li><a href="./WorkSweeper.html">WorkSweeper</a>
  
    <li><a href="./WorksController.html">WorksController</a>
  
    <li><a href="./WorksHelper.html">WorksHelper</a>
  
    <li><a href="./WranglingAssignment.html">WranglingAssignment</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class DevmodeController</h1>

  <div id="description" class="description">
    
  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-_get_view_paths" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">_get_view_paths</span><span
            class="method-args">(controller, view, stack)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="_get_view_paths-source">
            <pre><span class="ruby-comment"># File app/controllers/devmode_controller.rb, line 101</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">_get_view_paths</span>(<span class="ruby-identifier">controller</span>, <span class="ruby-identifier">view</span>, <span class="ruby-identifier">stack</span>)
  <span class="ruby-identifier">label</span> = <span class="ruby-node">&quot;#{controller}/#{view}&quot;</span>
  <span class="ruby-keyword">return</span> [[<span class="ruby-node">&quot;*** Recurses to #{label}&quot;</span>]] <span class="ruby-keyword">if</span> <span class="ruby-identifier">stack</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">label</span>
  <span class="ruby-identifier">sub_stack</span> = <span class="ruby-identifier">stack</span> <span class="ruby-operator">+</span> [<span class="ruby-identifier">label</span>]
  <span class="ruby-comment"># Load the appropriate erb file</span>
  <span class="ruby-identifier">erb_data</span> = <span class="ruby-identifier">load_erb</span> <span class="ruby-identifier">controller</span>, <span class="ruby-identifier">view</span>
  <span class="ruby-comment"># Scan for ':partial' and '.replace_html'</span>
  <span class="ruby-identifier">partials</span> = []
  <span class="ruby-identifier">erb_data</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/&lt;%[=-]?((?:[^%]|%[^&gt;])*?(?:\:partial|\.replace_html)(?:[^%]|%[^&gt;])*)%&gt;/</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">block</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-string">'unexpected length: '</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">block</span>.<span class="ruby-identifier">inspect</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">!=</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">block</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/:partial *=&gt; *['&quot;]([a-zA-Z\/_]*)[&quot;']/</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-string">'unexpected length: '</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">inspect</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">!=</span> <span class="ruby-value">1</span>
      <span class="ruby-identifier">partials</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">name</span>[<span class="ruby-value">0</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># Now take the names of the partial references, and look them up</span>
  <span class="ruby-identifier">link_paths</span> = []
  <span class="ruby-identifier">partials</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">l</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">'/'</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">l</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
      <span class="ruby-identifier">part_controller</span> = <span class="ruby-identifier">controller</span>
      <span class="ruby-identifier">part_view</span> = <span class="ruby-identifier">l</span>[<span class="ruby-value">0</span>]
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">part_controller</span> = <span class="ruby-identifier">l</span>[<span class="ruby-value">0</span>]
      <span class="ruby-identifier">part_view</span> = <span class="ruby-identifier">l</span>[<span class="ruby-value">1</span>]
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">part_view</span> = <span class="ruby-string">'_'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">part_view</span>
    <span class="ruby-identifier">link_paths</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">_get_view_paths</span>(<span class="ruby-identifier">part_controller</span>, <span class="ruby-identifier">part_view</span>, <span class="ruby-identifier">sub_stack</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># Next, we format these into a list of paths, and return</span>
  <span class="ruby-keyword">return</span> [[<span class="ruby-identifier">label</span>]] <span class="ruby-operator">+</span> <span class="ruby-identifier">link_paths</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">label</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">path</span>}
<span class="ruby-keyword">end</span></pre>
          </div><!-- _get_view_paths-source -->
          
        </div>

        

        
      </div><!-- _get_view_paths-method -->

    
      <div id="method-i-backtrace_view" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">backtrace_view</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="backtrace_view-source">
            <pre><span class="ruby-comment"># File app/controllers/devmode_controller.rb, line 204</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">backtrace_view</span>
  <span class="ruby-ivar">@links</span> = []
  <span class="ruby-identifier">view</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:viewname</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">view</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">view</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-ivar">@errors</span> = <span class="ruby-string">&quot;No view name provided. Go through devmode menus&quot;</span>
    <span class="ruby-identifier">render</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@viewname</span> = <span class="ruby-identifier">view</span>
  <span class="ruby-ivar">@links</span> = <span class="ruby-identifier">get_links_to</span> <span class="ruby-identifier">view</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- backtrace_view-source -->
          
        </div>

        

        
      </div><!-- backtrace_view-method -->

    
      <div id="method-i-comment_work" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">comment_work</span><span
            class="method-args">(work, comments, subcomment_chance, comment_length)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Assists seedworks</p>
          

          
          <div class="method-source-code" id="comment_work-source">
            <pre><span class="ruby-comment"># File app/controllers/devmode_controller.rb, line 439</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">comment_work</span>(<span class="ruby-identifier">work</span>, <span class="ruby-identifier">comments</span>, <span class="ruby-identifier">subcomment_chance</span>, <span class="ruby-identifier">comment_length</span>)
  <span class="ruby-comment"># not implemented yet</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- comment_work-source -->
          
        </div>

        

        
      </div><!-- comment_work-method -->

    
      <div id="method-i-comment_works" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">comment_works</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="comment_works-source">
            <pre><span class="ruby-comment"># File app/controllers/devmode_controller.rb, line 427</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">comment_works</span>
  <span class="ruby-comment"># GET params</span>
  <span class="ruby-ivar">@params</span> = {
    <span class="ruby-comment">#</span>
  }
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:create</span>]
    <span class="ruby-comment"># POST</span>
    <span class="ruby-comment"># do the actual creation</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- comment_works-source -->
          
        </div>

        

        
      </div><!-- comment_works-method -->

    
      <div id="method-i-create_work" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_work</span><span
            class="method-args">(name, authors, ratings, warnings, characters, relationships, fandoms, chapter_count, chapter_char_count)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Assists seedworks</p>
          

          
          <div class="method-source-code" id="create_work-source">
            <pre><span class="ruby-comment"># File app/controllers/devmode_controller.rb, line 360</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">create_work</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">authors</span>, <span class="ruby-identifier">ratings</span>, <span class="ruby-identifier">warnings</span>, <span class="ruby-identifier">characters</span>, <span class="ruby-identifier">relationships</span>, <span class="ruby-identifier">fandoms</span>, <span class="ruby-identifier">chapter_count</span>, <span class="ruby-identifier">chapter_char_count</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Provide fandoms&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">fandoms</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">fandoms</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Provide chapter count&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">chapter_count</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Provide chapter char count&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">chapter_char_count</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Provide authors&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">authors</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">authors</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Non unique fandoms&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">fandoms</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">sort</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">fandoms</span>.<span class="ruby-identifier">sort</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Non unique characters #{characters.map(&amp;:to_str).inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">characters</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">sort</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">characters</span>.<span class="ruby-identifier">sort</span>

    <span class="ruby-comment"># Provide a function to generate new chapters. Keeps them all different</span>
    <span class="ruby-identifier">new_chapter</span> = <span class="ruby-identifier">lambda</span> {<span class="ruby-node">&quot;#{WORK_CREATOR_VERSION} #{random_chapter chapter_char_count}&quot;</span>}

    <span class="ruby-identifier">notes</span> = <span class="ruby-identifier">new_chapter</span>.<span class="ruby-identifier">call</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">500</span>]
    <span class="ruby-identifier">end_notes</span> = <span class="ruby-identifier">new_chapter</span>.<span class="ruby-identifier">call</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">500</span>]
    <span class="ruby-identifier">summary</span> = <span class="ruby-identifier">new_chapter</span>.<span class="ruby-identifier">call</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">1250</span>]

    <span class="ruby-comment"># Taggings:</span>
    <span class="ruby-comment"># # rating</span>
    <span class="ruby-comment"># # warning</span>
    <span class="ruby-comment"># # fandoms</span>
    <span class="ruby-comment"># # category</span>
    <span class="ruby-comment"># # relationships</span>
    <span class="ruby-comment"># # characters</span>
    <span class="ruby-comment"># # freeform</span>

    <span class="ruby-identifier">chapters</span> = []
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">c_idx</span> <span class="ruby-keyword">in</span> (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-identifier">chapter_count</span>)
      <span class="ruby-identifier">title</span> = <span class="ruby-identifier">new_chapter</span>.<span class="ruby-identifier">call</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">255</span>]
      <span class="ruby-comment"># title =</span>
      <span class="ruby-identifier">position</span> = <span class="ruby-identifier">c_idx</span>
      <span class="ruby-identifier">content</span> = <span class="ruby-identifier">new_chapter</span>.<span class="ruby-identifier">call</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">500000</span>]
      <span class="ruby-comment"># Authorship + pseuds</span>
      <span class="ruby-identifier">chapter</span> = <span class="ruby-constant">Chapter</span>.<span class="ruby-identifier">new</span>(
        <span class="ruby-value">:authors</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">authors</span>,
        <span class="ruby-value">:content</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">content</span>,
        <span class="ruby-value">:position</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">position</span>,
        <span class="ruby-value">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">title</span>,
        <span class="ruby-value">:posted</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
      )
      <span class="ruby-identifier">chapter</span>.<span class="ruby-identifier">set_word_count</span>
      <span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">chapter</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">work_params</span> = {
      <span class="ruby-value">:collection_ids</span> =<span class="ruby-operator">&gt;</span> [],
      <span class="ruby-value">:wip_length</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">chapter_count</span>,
      <span class="ruby-value">:series</span> =<span class="ruby-operator">&gt;</span> [],
      <span class="ruby-value">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">name</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">255</span>],
      <span class="ruby-value">:chapters</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">chapters</span>,
      <span class="ruby-value">:authors</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">authors</span>,
      <span class="ruby-value">:summary</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">summary</span>,
      <span class="ruby-value">:fandoms</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">fandoms</span>,
      <span class="ruby-value">:ratings</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ratings</span>,
      <span class="ruby-value">:characters</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">characters</span>,
      <span class="ruby-value">:relationships</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">relationships</span>,
      <span class="ruby-value">:warnings</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">warnings</span>,
      <span class="ruby-value">:notes</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">notes</span>,
      <span class="ruby-value">:endnotes</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">end_notes</span>,
<span class="ruby-comment">#      :parent_url =&gt; nil,</span>
      <span class="ruby-value">:restricted</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>,
      <span class="ruby-value">:ratings</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ratings</span>,
      <span class="ruby-value">:posted</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
    }
    <span class="ruby-identifier">work</span> = <span class="ruby-constant">Work</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">work_params</span>)
    <span class="ruby-identifier">work</span>.<span class="ruby-identifier">set_word_count</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">work</span>
  <span class="ruby-keyword">end</span></pre>
          </div><!-- create_work-source -->
          
        </div>

        

        
      </div><!-- create_work-method -->

    
      <div id="method-i-development_only" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">development_only</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="development_only-source">
            <pre><span class="ruby-comment"># File app/controllers/devmode_controller.rb, line 7</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">development_only</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">env</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;development&quot;</span>
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-string">&quot;For development only&quot;</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">root_path</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- development_only-source -->
          
        </div>

        

        
      </div><!-- development_only-method -->

    
      <div id="method-i-get_controller_dir" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_controller_dir</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_controller_dir-source">
            <pre><span class="ruby-comment"># File app/controllers/devmode_controller.rb, line 215</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_controller_dir</span>
  <span class="ruby-keyword">return</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword">__FILE__</span>))
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_controller_dir-source -->
          
        </div>

        

        
      </div><!-- get_controller_dir-method -->

    
      <div id="method-i-get_links_to" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_links_to</span><span
            class="method-args">(view)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_links_to-source">
            <pre><span class="ruby-comment"># File app/controllers/devmode_controller.rb, line 163</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_links_to</span>(<span class="ruby-identifier">view</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">view</span>.<span class="ruby-identifier">include?</span> <span class="ruby-string">'/'</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-string">'Need to know view controller'</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">process_dir</span>(<span class="ruby-identifier">dirname</span>, <span class="ruby-identifier">links</span>, <span class="ruby-identifier">view</span>, <span class="ruby-identifier">stack</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;recurse #{dirname}, #{stack.inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">stack</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">dirname</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;stack #{stack.inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">stack</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">20</span>
    <span class="ruby-identifier">substack</span> = <span class="ruby-identifier">stack</span> <span class="ruby-operator">+</span> [<span class="ruby-identifier">dirname</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span> <span class="ruby-identifier">dirname</span>
      <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">dirname</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">filename</span>.<span class="ruby-identifier">end_with?</span> <span class="ruby-string">&quot;.html.erb&quot;</span>
      <span class="ruby-identifier">process_file</span> <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">links</span>, <span class="ruby-identifier">view</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span> <span class="ruby-identifier">dirname</span>
      <span class="ruby-identifier">dir</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">dirname</span>)
      <span class="ruby-identifier">dir</span>.<span class="ruby-identifier">entries</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">process_dir</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">dirname</span>, <span class="ruby-identifier">name</span>), <span class="ruby-identifier">links</span>, <span class="ruby-identifier">view</span>, <span class="ruby-identifier">substack</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'.'</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'..'</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">process_file</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">links</span>, <span class="ruby-identifier">view</span>)
    <span class="ruby-identifier">search_view</span> = <span class="ruby-identifier">view</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">'/_'</span>, <span class="ruby-string">'/'</span>)
    <span class="ruby-identifier">main_view_controller</span>, <span class="ruby-identifier">main_view</span> = <span class="ruby-identifier">view</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">'/'</span>)
    <span class="ruby-identifier">view_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-string">'rb'</span>)
    <span class="ruby-identifier">dirname</span>, <span class="ruby-identifier">view_name</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">filename</span>)
    <span class="ruby-identifier">view_name</span> = <span class="ruby-identifier">view_name</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span>(<span class="ruby-identifier">view_name</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">-</span>(<span class="ruby-string">'.html.erb'</span>.<span class="ruby-identifier">length</span>))]
    <span class="ruby-identifier">view_search_name</span> = <span class="ruby-identifier">view_name</span>
    <span class="ruby-identifier">view_search_name</span> = <span class="ruby-identifier">view_search_name</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-identifier">view_search_name</span>.<span class="ruby-identifier">length</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">view_search_name</span>.<span class="ruby-identifier">start_with?</span> <span class="ruby-string">&quot;_&quot;</span>
    <span class="ruby-identifier">controller</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">dirname</span>)[<span class="ruby-value">1</span>]
    <span class="ruby-identifier">erb_data</span> = <span class="ruby-identifier">view_file</span>.<span class="ruby-identifier">read</span>
    <span class="ruby-identifier">view_file</span>.<span class="ruby-identifier">close</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">erb_data</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/'#{search_view}'/</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">erb_data</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/&quot;#{search_view}&quot;/</span> <span class="ruby-keyword">or</span>
      (<span class="ruby-identifier">main_view_controller</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">controller</span> <span class="ruby-keyword">and</span>
      (<span class="ruby-identifier">erb_data</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/'#{view_search_name}'/</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">erb_data</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/&quot;#{view_search_name}&quot;/</span>))
      <span class="ruby-identifier">links</span>.<span class="ruby-identifier">push</span> [<span class="ruby-identifier">controller</span>, <span class="ruby-identifier">view_name</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">links</span> = []
  <span class="ruby-identifier">process_dir</span> <span class="ruby-identifier">get_view_dir</span>, <span class="ruby-identifier">links</span>, <span class="ruby-identifier">view</span>, []
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">links</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_links_to-source -->
          
        </div>

        

        
      </div><!-- get_links_to-method -->

    
      <div id="method-i-get_view_dir" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_view_dir</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_view_dir-source">
            <pre><span class="ruby-comment"># File app/controllers/devmode_controller.rb, line 219</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_view_dir</span>
  <span class="ruby-keyword">return</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword">__FILE__</span>), <span class="ruby-string">'..'</span>, <span class="ruby-string">'views'</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_view_dir-source -->
          
        </div>

        

        
      </div><!-- get_view_dir-method -->

    
      <div id="method-i-get_view_paths" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_view_paths</span><span
            class="method-args">(controller, view)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_view_paths-source">
            <pre><span class="ruby-comment"># File app/controllers/devmode_controller.rb, line 96</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_view_paths</span>(<span class="ruby-identifier">controller</span>, <span class="ruby-identifier">view</span>)
  <span class="ruby-identifier">lst</span> = <span class="ruby-identifier">_get_view_paths</span>(<span class="ruby-identifier">controller</span>, <span class="ruby-identifier">view</span>, <span class="ruby-identifier">stack</span>=[])
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">lst</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_view_paths-source -->
          
        </div>

        

        
      </div><!-- get_view_paths-method -->

    
      <div id="method-i-index" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">index</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="index-source">
            <pre><span class="ruby-comment"># File app/controllers/devmode_controller.rb, line 14</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">index</span>
  <span class="ruby-identifier">render</span> 
<span class="ruby-keyword">end</span></pre>
          </div><!-- index-source -->
          
        </div>

        

        
      </div><!-- index-method -->

    
      <div id="method-i-inspect_view" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">inspect_view</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>GET <a
href="DevmodeController.html#method-i-inspect_view">#inspect_view</a></p>
          

          
          <div class="method-source-code" id="inspect_view-source">
            <pre><span class="ruby-comment"># File app/controllers/devmode_controller.rb, line 145</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">inspect_view</span>
  <span class="ruby-identifier">controller</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:controller_name</span>]
  <span class="ruby-identifier">view</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:view_name</span>]
  <span class="ruby-ivar">@paths</span> = []
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">controller</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">view</span>
    <span class="ruby-comment"># Test controller input format - accept DevmodeController or devmode</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">controller</span>.<span class="ruby-identifier">end_with?</span> <span class="ruby-string">'Controller'</span>
      <span class="ruby-comment"># It's a class name - change it:</span>
      <span class="ruby-identifier">controller</span> = <span class="ruby-identifier">controller</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">controller</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">-</span><span class="ruby-value">10</span>]
      <span class="ruby-identifier">controller</span> = <span class="ruby-identifier">controller</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/[A-Z]/</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-string">'_'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">downcase</span>}
      <span class="ruby-identifier">controller</span> = <span class="ruby-identifier">controller</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-identifier">controller</span>.<span class="ruby-identifier">length</span>]
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment"># get paths, and display</span>
    <span class="ruby-identifier">paths</span> = <span class="ruby-identifier">get_view_paths</span>(<span class="ruby-identifier">controller</span>, <span class="ruby-identifier">view</span>)
    <span class="ruby-ivar">@paths</span> = <span class="ruby-identifier">paths</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- inspect_view-source -->
          
        </div>

        

        
      </div><!-- inspect_view-method -->

    
      <div id="method-i-list_controllers" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">list_controllers</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>GET /devmode/</p>
          

          
          <div class="method-source-code" id="list_controllers-source">
            <pre><span class="ruby-comment"># File app/controllers/devmode_controller.rb, line 224</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">list_controllers</span>
    <span class="ruby-comment"># This magic global method allows us to inspect every object in memory!</span>
<span class="ruby-comment">#    controller_names = ActionController::Routing.possible_controllers</span>
    <span class="ruby-identifier">controllers_list</span> = []
    <span class="ruby-identifier">controller_dir</span> = <span class="ruby-identifier">get_controller_dir</span>
    <span class="ruby-identifier">view_dir</span> = <span class="ruby-identifier">get_view_dir</span>
    <span class="ruby-identifier">all</span> = []
    <span class="ruby-identifier">controller_info</span> = []
    <span class="ruby-identifier">controller_dir</span>.<span class="ruby-identifier">entries</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">controller_dir</span>.<span class="ruby-identifier">path</span>, <span class="ruby-identifier">name</span>)
      <span class="ruby-comment"># Skip non-files</span>
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span> <span class="ruby-identifier">path</span>
      <span class="ruby-comment"># Skip non-controller files</span>
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">name</span>.<span class="ruby-identifier">end_with?</span> <span class="ruby-string">'_controller.rb'</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-string">'nilname'</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">controller</span> = <span class="ruby-identifier">name</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">name</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">-</span><span class="ruby-value">14</span>]
      <span class="ruby-comment"># Save this for use in the view path prefix later.</span>
      <span class="ruby-identifier">underscored_path</span> = <span class="ruby-identifier">controller</span>.<span class="ruby-identifier">dup</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-identifier">name</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">underscored_path</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-comment"># We require the file's contents to be loaded.</span>
      <span class="ruby-identifier">require</span> <span class="ruby-identifier">path</span>
      <span class="ruby-identifier">controller</span>[<span class="ruby-value">0</span>] = <span class="ruby-identifier">controller</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">0</span>].<span class="ruby-identifier">upcase</span>
      <span class="ruby-identifier">controller</span> <span class="ruby-operator">+=</span> <span class="ruby-string">'Controller'</span>
      <span class="ruby-comment"># Need to CamelCase the name at '_' marks</span>
      <span class="ruby-identifier">name_part_list</span> = <span class="ruby-identifier">controller</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">'_'</span>)
      <span class="ruby-identifier">controller</span> = <span class="ruby-identifier">name_part_list</span>.<span class="ruby-identifier">shift</span>
      <span class="ruby-keyword">while</span> <span class="ruby-operator">!</span><span class="ruby-identifier">name_part_list</span>.<span class="ruby-identifier">empty?</span>
        <span class="ruby-identifier">name_part</span> = <span class="ruby-identifier">name_part_list</span>.<span class="ruby-identifier">shift</span>
        <span class="ruby-comment"># First letter upper case</span>
        <span class="ruby-identifier">name_part</span>[<span class="ruby-value">0</span>] = <span class="ruby-identifier">name_part</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">0</span>].<span class="ruby-identifier">upcase</span>
        <span class="ruby-identifier">controller</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">name_part</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-comment"># camel case done</span>
      <span class="ruby-comment"># This trick will </span>
      <span class="ruby-keyword">begin</span>
        <span class="ruby-identifier">controller_obj</span> = <span class="ruby-identifier">eval</span> <span class="ruby-identifier">controller</span>
      <span class="ruby-keyword">rescue</span>
        <span class="ruby-identifier">controller_info</span>.<span class="ruby-identifier">push</span> [
          <span class="ruby-identifier">controller</span>,
          <span class="ruby-string">'Could not evaluate'</span>
        ]
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">controller_obj</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">controller_info</span>.<span class="ruby-identifier">push</span> [
          <span class="ruby-identifier">controller</span>, 
          <span class="ruby-node">&quot;Expected #{controller} class in #{name}&quot;</span>
        ]
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">controllers_list</span>.<span class="ruby-identifier">push</span> [<span class="ruby-identifier">controller_obj</span>, <span class="ruby-identifier">underscored_path</span>]
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">controllers_list</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">controller</span>, <span class="ruby-identifier">dirname</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">info</span> = []
      <span class="ruby-identifier">info</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">controller</span>.<span class="ruby-identifier">name</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-identifier">controllers_list</span>.<span class="ruby-identifier">inspect</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">dirname</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">controller_view_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">view_dir</span>, <span class="ruby-identifier">dirname</span>)
      <span class="ruby-identifier">controller_view_dir</span> = <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span> <span class="ruby-identifier">controller_view_dir</span>
      <span class="ruby-identifier">view_methods</span> = []
      <span class="ruby-identifier">other_methods</span> = []
      <span class="ruby-identifier">controller</span>.<span class="ruby-identifier">instance_methods</span>(<span class="ruby-keyword">false</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">controller_view_dir</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">and</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">controller_view_dir</span>).<span class="ruby-identifier">include?</span> <span class="ruby-node">&quot;#{name}.html.erb&quot;</span>
          <span class="ruby-identifier">view_methods</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">name</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">other_methods</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">name</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">info</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">view_methods</span>
      <span class="ruby-identifier">info</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">other_methods</span>.<span class="ruby-identifier">inspect</span>
      <span class="ruby-identifier">controller_info</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">info</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">controller_info</span>.<span class="ruby-identifier">sort!</span>
    <span class="ruby-ivar">@controllers</span> =  <span class="ruby-identifier">controller_info</span>
  <span class="ruby-keyword">end</span></pre>
          </div><!-- list_controllers-source -->
          
        </div>

        

        
      </div><!-- list_controllers-method -->

    
      <div id="method-i-list_views" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">list_views</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>GET <a href="DevmodeController.html#method-i-list_views">#list_views</a></p>
          

          
          <div class="method-source-code" id="list_views-source">
            <pre><span class="ruby-comment"># File app/controllers/devmode_controller.rb, line 50</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">list_views</span>
  <span class="ruby-identifier">view_list</span> = []
  <span class="ruby-identifier">view_dir</span> = <span class="ruby-identifier">get_view_dir</span>
  <span class="ruby-identifier">all</span> = []
  <span class="ruby-identifier">view_info</span> = []
  <span class="ruby-identifier">view_dir</span>.<span class="ruby-identifier">entries</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">view_dir</span>.<span class="ruby-identifier">path</span>, <span class="ruby-identifier">name</span>)
    <span class="ruby-comment"># Skip non-files</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span> <span class="ruby-identifier">path</span>
    <span class="ruby-comment"># Skip non-controller files</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">name</span>.<span class="ruby-identifier">end_with?</span> <span class="ruby-string">'.html.erb'</span>
    <span class="ruby-identifier">view</span> = <span class="ruby-identifier">name</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">name</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">-</span><span class="ruby-value">9</span>]
    <span class="ruby-identifier">require</span> <span class="ruby-identifier">path</span>
    <span class="ruby-identifier">view</span>[<span class="ruby-value">0</span>] = <span class="ruby-identifier">view</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">0</span>].<span class="ruby-identifier">upcase</span>
    <span class="ruby-identifier">view</span> <span class="ruby-operator">+=</span> <span class="ruby-string">'Controller'</span>
    <span class="ruby-comment"># Need to CamelCase the name at '_' marks</span>
    <span class="ruby-identifier">name_part_list</span> = <span class="ruby-identifier">view</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">'_'</span>)
    <span class="ruby-identifier">view</span> = <span class="ruby-identifier">name_part_list</span>.<span class="ruby-identifier">shift</span>
    <span class="ruby-keyword">while</span> <span class="ruby-operator">!</span><span class="ruby-identifier">name_part_list</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">name_part</span> = <span class="ruby-identifier">name_part_list</span>.<span class="ruby-identifier">pop</span>
      <span class="ruby-comment"># First letter upper case</span>
      <span class="ruby-identifier">name_part</span>[<span class="ruby-value">0</span>] = <span class="ruby-identifier">name_part</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">0</span>].<span class="ruby-identifier">upcase</span>
      <span class="ruby-identifier">view</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">name_part</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment"># camel case done</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">view_obj</span> = <span class="ruby-identifier">eval</span> <span class="ruby-identifier">view</span>
    <span class="ruby-keyword">rescue</span>
      <span class="ruby-identifier">view_info</span>.<span class="ruby-identifier">push</span> [
        <span class="ruby-identifier">view</span>,
        <span class="ruby-string">'Could not evaluate'</span>
      ]
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">controller_obj</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">view_info</span>.<span class="ruby-identifier">push</span> [
        <span class="ruby-identifier">view</span>, 
        <span class="ruby-node">&quot;Expected #{view} class in #{name}&quot;</span>
      ]
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">view_list</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">view_obj</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># Process the view files for display.</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-identifier">view_list</span>.<span class="ruby-identifier">inspect</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- list_views-source -->
          
        </div>

        

        
      </div><!-- list_views-method -->

    
      <div id="method-i-load_erb" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">load_erb</span><span
            class="method-args">(controller, view)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="load_erb-source">
            <pre><span class="ruby-comment"># File app/controllers/devmode_controller.rb, line 134</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">load_erb</span>(<span class="ruby-identifier">controller</span>, <span class="ruby-identifier">view</span>)
  <span class="ruby-identifier">view_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">get_view_dir</span>, <span class="ruby-identifier">controller</span>)
  <span class="ruby-identifier">erb_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">view_dir</span>, <span class="ruby-identifier">view</span> <span class="ruby-operator">+</span> <span class="ruby-string">'.html.erb'</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-string">'view template not found: '</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">controller</span> <span class="ruby-operator">+</span> <span class="ruby-string">'/'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">view</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span> <span class="ruby-identifier">erb_path</span>
  <span class="ruby-identifier">erb_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">erb_path</span>, <span class="ruby-string">'rb'</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">erb_file</span>.<span class="ruby-identifier">read</span>
  <span class="ruby-identifier">erb_file</span>.<span class="ruby-identifier">close</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">data</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- load_erb-source -->
          
        </div>

        

        
      </div><!-- load_erb-method -->

    
      <div id="method-i-process_dir" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_dir</span><span
            class="method-args">(dirname, links, view, stack)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="process_dir-source">
            <pre><span class="ruby-comment"># File app/controllers/devmode_controller.rb, line 167</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_dir</span>(<span class="ruby-identifier">dirname</span>, <span class="ruby-identifier">links</span>, <span class="ruby-identifier">view</span>, <span class="ruby-identifier">stack</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;recurse #{dirname}, #{stack.inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">stack</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">dirname</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;stack #{stack.inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">stack</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">20</span>
  <span class="ruby-identifier">substack</span> = <span class="ruby-identifier">stack</span> <span class="ruby-operator">+</span> [<span class="ruby-identifier">dirname</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span> <span class="ruby-identifier">dirname</span>
    <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">dirname</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">filename</span>.<span class="ruby-identifier">end_with?</span> <span class="ruby-string">&quot;.html.erb&quot;</span>
    <span class="ruby-identifier">process_file</span> <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">links</span>, <span class="ruby-identifier">view</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span> <span class="ruby-identifier">dirname</span>
    <span class="ruby-identifier">dir</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">dirname</span>)
    <span class="ruby-identifier">dir</span>.<span class="ruby-identifier">entries</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">process_dir</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">dirname</span>, <span class="ruby-identifier">name</span>), <span class="ruby-identifier">links</span>, <span class="ruby-identifier">view</span>, <span class="ruby-identifier">substack</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'.'</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'..'</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- process_dir-source -->
          
        </div>

        

        
      </div><!-- process_dir-method -->

    
      <div id="method-i-process_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_file</span><span
            class="method-args">(filename, links, view)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="process_file-source">
            <pre><span class="ruby-comment"># File app/controllers/devmode_controller.rb, line 182</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_file</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">links</span>, <span class="ruby-identifier">view</span>)
  <span class="ruby-identifier">search_view</span> = <span class="ruby-identifier">view</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">'/_'</span>, <span class="ruby-string">'/'</span>)
  <span class="ruby-identifier">main_view_controller</span>, <span class="ruby-identifier">main_view</span> = <span class="ruby-identifier">view</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">'/'</span>)
  <span class="ruby-identifier">view_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-string">'rb'</span>)
  <span class="ruby-identifier">dirname</span>, <span class="ruby-identifier">view_name</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">filename</span>)
  <span class="ruby-identifier">view_name</span> = <span class="ruby-identifier">view_name</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span>(<span class="ruby-identifier">view_name</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">-</span>(<span class="ruby-string">'.html.erb'</span>.<span class="ruby-identifier">length</span>))]
  <span class="ruby-identifier">view_search_name</span> = <span class="ruby-identifier">view_name</span>
  <span class="ruby-identifier">view_search_name</span> = <span class="ruby-identifier">view_search_name</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-identifier">view_search_name</span>.<span class="ruby-identifier">length</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">view_search_name</span>.<span class="ruby-identifier">start_with?</span> <span class="ruby-string">&quot;_&quot;</span>
  <span class="ruby-identifier">controller</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">dirname</span>)[<span class="ruby-value">1</span>]
  <span class="ruby-identifier">erb_data</span> = <span class="ruby-identifier">view_file</span>.<span class="ruby-identifier">read</span>
  <span class="ruby-identifier">view_file</span>.<span class="ruby-identifier">close</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">erb_data</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/'#{search_view}'/</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">erb_data</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/&quot;#{search_view}&quot;/</span> <span class="ruby-keyword">or</span>
    (<span class="ruby-identifier">main_view_controller</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">controller</span> <span class="ruby-keyword">and</span>
    (<span class="ruby-identifier">erb_data</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/'#{view_search_name}'/</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">erb_data</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/&quot;#{view_search_name}&quot;/</span>))
    <span class="ruby-identifier">links</span>.<span class="ruby-identifier">push</span> [<span class="ruby-identifier">controller</span>, <span class="ruby-identifier">view_name</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- process_file-source -->
          
        </div>

        

        
      </div><!-- process_file-method -->

    
      <div id="method-i-profile_logs" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">profile_logs</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="profile_logs-source">
            <pre><span class="ruby-comment"># File app/controllers/devmode_controller.rb, line 30</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">profile_logs</span>
  <span class="ruby-identifier">path</span> = <span class="ruby-constant">ApplicationController</span>.<span class="ruby-identifier">profiler_logging_path</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:logname</span>]
    <span class="ruby-comment"># If fetching a specific log, just return the html in the log file.</span>
    <span class="ruby-identifier">f</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:logname</span>]), <span class="ruby-string">'rb'</span>)
    <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">read</span>()
    <span class="ruby-identifier">f</span>.<span class="ruby-identifier">close</span>()
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># If not fetching a log, return a list of log entries.</span>
  <span class="ruby-identifier">paths</span> = []
  <span class="ruby-identifier">raise</span> [<span class="ruby-string">&quot;bad dir&quot;</span>, <span class="ruby-identifier">path</span>].<span class="ruby-identifier">inspect</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">path</span>).<span class="ruby-identifier">entries</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">end_with?</span> <span class="ruby-string">'.html'</span>
    <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">push</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">name</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@paths</span> = <span class="ruby-identifier">paths</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- profile_logs-source -->
          
        </div>

        

        
      </div><!-- profile_logs-method -->

    
      <div id="method-i-random_chapter" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">random_chapter</span><span
            class="method-args">(characters, fuzziness=50)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="random_chapter-source">
            <pre><span class="ruby-comment"># File app/controllers/devmode_controller.rb, line 443</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">random_chapter</span>(<span class="ruby-identifier">characters</span>, <span class="ruby-identifier">fuzziness</span>=<span class="ruby-value">50</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Provide characters count!&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">characters</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">paragraphs</span> = []
  <span class="ruby-identifier">count</span> = <span class="ruby-value">0</span>
  <span class="ruby-keyword">while</span> <span class="ruby-identifier">count</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">characters</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">fuzziness</span>
    <span class="ruby-identifier">new_paragraph</span> = <span class="ruby-constant">Faker</span><span class="ruby-operator">::</span><span class="ruby-constant">Lorem</span>.<span class="ruby-identifier">paragraph</span>(<span class="ruby-identifier">rand</span>(<span class="ruby-value">4</span>) <span class="ruby-operator">+</span> <span class="ruby-value">6</span>)
    <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">new_paragraph</span>.<span class="ruby-identifier">length</span>
    <span class="ruby-identifier">paragraphs</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">new_paragraph</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">paragraphs</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;&lt;br/&gt;&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- random_chapter-source -->
          
        </div>

        

        
      </div><!-- random_chapter-method -->

    
      <div id="method-i-random_sentence" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">random_sentence</span><span
            class="method-args">(characters, fuzziness=4)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="random_sentence-source">
            <pre><span class="ruby-comment"># File app/controllers/devmode_controller.rb, line 455</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">random_sentence</span>(<span class="ruby-identifier">characters</span>, <span class="ruby-identifier">fuzziness</span>=<span class="ruby-value">4</span>)
  <span class="ruby-identifier">words</span> = []
  <span class="ruby-identifier">count</span> = <span class="ruby-value">0</span>
  <span class="ruby-keyword">while</span> <span class="ruby-identifier">count</span> <span class="ruby-operator">&lt;</span> [<span class="ruby-identifier">characters</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">fuzziness</span>, <span class="ruby-value">1</span>].<span class="ruby-identifier">max</span>
    <span class="ruby-identifier">new_word</span> = <span class="ruby-constant">Faker</span><span class="ruby-operator">::</span><span class="ruby-constant">Lorem</span>.<span class="ruby-identifier">words</span>(<span class="ruby-value">1</span>)
    <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">new_word</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">words</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">new_word</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">words</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot; &quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- random_sentence-source -->
          
        </div>

        

        
      </div><!-- random_sentence-method -->

    
      <div id="method-i-seedusers" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">seedusers</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>GET+POST /devmode/seedusers</p>
          

          
          <div class="method-source-code" id="seedusers-source">
            <pre><span class="ruby-comment"># File app/controllers/devmode_controller.rb, line 299</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">seedusers</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:seed</span>]
    <span class="ruby-comment"># POST</span>
    <span class="ruby-identifier">errors</span> = []

    <span class="ruby-identifier">start</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_start</span>].<span class="ruby-identifier">to_i</span>
    <span class="ruby-identifier">count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_count</span>].<span class="ruby-identifier">to_i</span>
    <span class="ruby-identifier">end_no</span> = <span class="ruby-identifier">start</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">count</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>

    <span class="ruby-identifier">user_name</span> = <span class="ruby-identifier">lambda</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">params</span>[<span class="ruby-value">:user_prefix</span>], <span class="ruby-identifier">i</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;&quot;</span>)}

    <span class="ruby-keyword">for</span> <span class="ruby-identifier">i</span> <span class="ruby-keyword">in</span> (<span class="ruby-identifier">start</span><span class="ruby-operator">..</span><span class="ruby-identifier">end_no</span>)
      <span class="ruby-identifier">email</span> = [<span class="ruby-identifier">params</span>[<span class="ruby-value">:email_prefix</span>], <span class="ruby-identifier">i</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:email_suffix</span>]].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;&quot;</span>)
      <span class="ruby-identifier">login</span> = <span class="ruby-identifier">user_name</span>.<span class="ruby-identifier">call</span> <span class="ruby-identifier">i</span>

      <span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">new</span>(
        <span class="ruby-value">:login</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">login</span>,
        <span class="ruby-value">:email</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">email</span>,
        <span class="ruby-value">:password</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:password</span>],
        <span class="ruby-value">:password_confirmation</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:password</span>],
        <span class="ruby-value">:age_over_13</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;1&quot;</span>,
        <span class="ruby-value">:terms_of_service</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;1&quot;</span>
      )
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">save</span>
        <span class="ruby-comment"># Activation doesn't seem to work in a single save. We now need to </span>
        <span class="ruby-comment"># activate, and save again.</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:prevalidate</span>]
          <span class="ruby-identifier">user</span>.<span class="ruby-identifier">activated_at</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
          <span class="ruby-identifier">user</span>.<span class="ruby-identifier">activation_code</span> = <span class="ruby-keyword">nil</span>
          <span class="ruby-keyword">unless</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">save</span>
            <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">push</span> [<span class="ruby-identifier">login</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">full_messages</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">push</span> [<span class="ruby-identifier">login</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">full_messages</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-node">&quot;Seeding successful from '#{user_name.call start}' to '#{user_name.call end_no}'&quot;</span>
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-string">&quot;/devmode&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@errors</span> = <span class="ruby-string">&quot;Errors: &lt;ul&gt;&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-string">&quot;&lt;li&gt;&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;&lt;/li&gt;&lt;li&gt;&quot;</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&quot;&lt;/li&gt;&quot;</span>}.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;&lt;/ul&gt;&lt;br /&gt;&lt;ul&gt;&quot;</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&quot;&lt;/ul&gt;&quot;</span>
      <span class="ruby-ivar">@params</span> = <span class="ruby-identifier">params</span>
      <span class="ruby-ivar">@params</span>.<span class="ruby-identifier">delete</span> <span class="ruby-string">&quot;seed&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># GET default response</span>
  <span class="ruby-ivar">@params</span> = [
    [<span class="ruby-value">:prevalidate</span>, [<span class="ruby-value">:checkbox</span>, <span class="ruby-string">'&quot; checked=&quot;checked'</span>]],
    [<span class="ruby-value">:user_start</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">&quot;1&quot;</span>]],
    [<span class="ruby-value">:user_count</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">&quot;100&quot;</span>]],
    [<span class="ruby-value">:user_prefix</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">'testuser'</span>]],
    [<span class="ruby-value">:password</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">&quot;password&quot;</span>]],
    [<span class="ruby-value">:email_prefix</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">&quot;user&quot;</span>]],
    [<span class="ruby-value">:email_suffix</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">&quot;.mail@somedomain.com&quot;</span>]],
  ]
<span class="ruby-keyword">end</span></pre>
          </div><!-- seedusers-source -->
          
        </div>

        

        
      </div><!-- seedusers-method -->

    
      <div id="method-i-seedworks" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">seedworks</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="seedworks-source">
            <pre><span class="ruby-comment"># File app/controllers/devmode_controller.rb, line 466</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">seedworks</span>
  <span class="ruby-comment"># GET default response</span>
  <span class="ruby-identifier">max_errors</span> = <span class="ruby-value">1</span>

  <span class="ruby-comment"># This array is rendered in rows by the view. Each element is either:</span>
  <span class="ruby-comment">#  * A heading: [:Title, nil]</span>
  <span class="ruby-comment">#  * An &lt;input&gt;: [:name, [:type, 'default', 'description...']]</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-ivar">@params</span> = [
    [<span class="ruby-value">:Works</span>, <span class="ruby-keyword">nil</span>],
    [<span class="ruby-value">:work_count</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">&quot;10&quot;</span>, <span class="ruby-string">&quot;This many works will be added. Don't try more than about 20 over the web.&quot;</span>]],
    [<span class="ruby-value">:author_prefix</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">&quot;author_&quot;</span>, <span class="ruby-string">&quot;Only users with this name prefix will authors of new works.&quot;</span>]],
    [<span class="ruby-value">:num_authors_two_weight</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">'1'</span>, <span class="ruby-string">&quot;Weighting on work by 2 authors&quot;</span>]],
    [<span class="ruby-value">:num_authors_one_weight</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">'30'</span>, <span class="ruby-string">&quot;Weighting on work by 1 author only&quot;</span>]],

    [<span class="ruby-value">:Content</span>, <span class="ruby-keyword">nil</span>],
    [<span class="ruby-value">:chapter_count_long_weight</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">'1'</span>, <span class="ruby-string">&quot;Weighting on 11-60 chapters&quot;</span>]],
    [<span class="ruby-value">:chapter_count_med_weight</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">'2'</span>, <span class="ruby-string">&quot;Weighting on 2-10 chapters&quot;</span>]],
    [<span class="ruby-value">:chapter_count_short_weight</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">'30'</span>, <span class="ruby-string">&quot;Weighting on 1 chapter&quot;</span>]],
    [<span class="ruby-value">:chapter_long_weight</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">'1'</span>, <span class="ruby-string">&quot;Weighting on chapter length being over 450000 characters&quot;</span>]],
    [<span class="ruby-value">:chapter_med_weight</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">'2'</span>, <span class="ruby-string">&quot;Weighting on chapter length being over 2001-100000 characters&quot;</span>]],
    [<span class="ruby-value">:chapter_short_weight</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">'10'</span>, <span class="ruby-string">&quot;Weighting on chapter length being under 2000 characters&quot;</span>]],
    [<span class="ruby-value">:work_name_long_weight</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">'1'</span>, <span class="ruby-string">&quot;Weighting on work name length being over 301 characters&quot;</span>]],
    [<span class="ruby-value">:work_name_med_weight</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">'2'</span>, <span class="ruby-string">&quot;Weighting on work name length being over 51-300 characters&quot;</span>]],
    [<span class="ruby-value">:work_name_short_weight</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">'10'</span>, <span class="ruby-string">&quot;Weighting on work name length being under 50 characters&quot;</span>]],

    [<span class="ruby-value">:&quot;Comments - (Not implemented yet)&quot;</span>, <span class="ruby-keyword">nil</span>],
    [<span class="ruby-value">:comment_only_by_user_prefix</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;Only users with this prefix to their login will be adding comments&quot;</span>]],
    [<span class="ruby-value">:comment_on_comment_chance</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">&quot;0.5&quot;</span>, <span class="ruby-string">&quot;Probability of a new comment having a further comment added to it.&quot;</span>]],
    [<span class="ruby-value">:chapter_count_med_weight</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">'1'</span>, <span class="ruby-string">&quot;Weighting on full paragraph comment&quot;</span>]],
    [<span class="ruby-value">:chapter_count_short_weight</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">'20'</span>, <span class="ruby-string">&quot;Weighting on one line comment&quot;</span>]],

    [<span class="ruby-value">:Fandoms</span>, <span class="ruby-keyword">nil</span>],
    [<span class="ruby-value">:in_fandoms</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;If not set, random fandoms will be assigned. If set, use a comma separated list, and fandoms will be taken from this list.&quot;</span>]],
    [<span class="ruby-value">:max_new_fandoms</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">'5'</span>, <span class="ruby-string">'When creating fandoms is allowed, at most this many new fandoms will be created.'</span>]],
    [<span class="ruby-value">:fandoms_count_med_weight</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">'2'</span>, <span class="ruby-string">&quot;Weighting on work of 2 fandoms&quot;</span>]],
    [<span class="ruby-value">:fandoms_count_short_weight</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">'30'</span>, <span class="ruby-string">&quot;Weighting on work of 1 fandom only&quot;</span>]],

    [<span class="ruby-value">:Tags</span>, <span class="ruby-keyword">nil</span>],
    [<span class="ruby-value">:max_new_characters</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">'5'</span>, <span class="ruby-string">'At most this many new characters will be created'</span>]],
    [<span class="ruby-value">:max_new_relationships</span>, [<span class="ruby-value">:text</span>, <span class="ruby-string">'5'</span>, <span class="ruby-string">'At most this many new relationships will be created'</span>]]
  ] <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@params</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">'seed'</span>]
    <span class="ruby-comment"># POST</span>

    <span class="ruby-comment"># First, get some data in order before we start creating works.</span>
    <span class="ruby-identifier">errors</span> = []
    <span class="ruby-identifier">new_works</span> = []

    <span class="ruby-comment"># Verify params</span>
    <span class="ruby-identifier">chapter_count</span> = <span class="ruby-constant">WeightedRandom</span>.<span class="ruby-identifier">from_params</span>(<span class="ruby-identifier">params</span>, <span class="ruby-string">&quot;chapter_count&quot;</span>, {
      <span class="ruby-string">'long'</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-value">11</span><span class="ruby-operator">..</span><span class="ruby-value">60</span>),
      <span class="ruby-string">'med'</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-value">2</span><span class="ruby-operator">..</span><span class="ruby-value">10</span>),
      <span class="ruby-string">'short'</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">1</span>),
    })
    <span class="ruby-identifier">chapter_length</span> = <span class="ruby-constant">WeightedRandom</span>.<span class="ruby-identifier">from_params</span>(<span class="ruby-identifier">params</span>, <span class="ruby-string">&quot;chapter&quot;</span>, {
      <span class="ruby-string">'long'</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-value">100001</span><span class="ruby-operator">..</span><span class="ruby-value">450000</span>),
      <span class="ruby-string">'med'</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-value">2001</span><span class="ruby-operator">..</span><span class="ruby-value">100000</span>),
      <span class="ruby-string">'short'</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-value">800</span><span class="ruby-operator">..</span><span class="ruby-value">2000</span>),
    })
    <span class="ruby-identifier">work_name_length</span> = <span class="ruby-constant">WeightedRandom</span>.<span class="ruby-identifier">from_params</span>(<span class="ruby-identifier">params</span>, <span class="ruby-string">&quot;work_name&quot;</span>, {
      <span class="ruby-string">'long'</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-value">301</span><span class="ruby-operator">..</span><span class="ruby-value">500</span>),
      <span class="ruby-string">'med'</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-value">51</span><span class="ruby-operator">..</span><span class="ruby-value">300</span>),
      <span class="ruby-string">'short'</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">50</span>),
    })
    <span class="ruby-identifier">fandoms_count</span> = <span class="ruby-constant">WeightedRandom</span>.<span class="ruby-identifier">from_params</span>(<span class="ruby-identifier">params</span>, <span class="ruby-string">&quot;fandoms_count&quot;</span>, {
      <span class="ruby-string">'long'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">3</span>,
      <span class="ruby-string">'med'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>,
      <span class="ruby-string">'short'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>,
    })
    <span class="ruby-identifier">authors_count</span> = <span class="ruby-constant">WeightedRandom</span>.<span class="ruby-identifier">from_params</span>(<span class="ruby-identifier">params</span>, <span class="ruby-string">&quot;num_authors&quot;</span>, {
      <span class="ruby-string">'two'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>,
      <span class="ruby-string">'one'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>,
    })

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">'work_count'</span>]
      <span class="ruby-identifier">work_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-string">'work_count'</span>].<span class="ruby-identifier">to_i</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">errors</span> = <span class="ruby-string">'Must set work count'</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">work_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-string">'work_count'</span>].<span class="ruby-identifier">to_i</span>

    <span class="ruby-comment"># Fandoms.</span>
    <span class="ruby-identifier">fandom_list</span> = []
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">'in_fandoms'</span>]
      <span class="ruby-identifier">params</span>[<span class="ruby-string">'in_fandoms'</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fandom_name</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">fandom_name</span>.<span class="ruby-identifier">strip!</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">fandom_name</span>
          <span class="ruby-identifier">fandom</span> = <span class="ruby-constant">Fandom</span>.<span class="ruby-identifier">get_by_name</span>(<span class="ruby-identifier">fandom_name</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">fandom</span>
            <span class="ruby-identifier">fandom_list</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">fandom</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">push</span> <span class="ruby-node">&quot;Fandom '#{h fandom_name}' not found&quot;</span>
          <span class="ruby-keyword">end</span> 
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">fandom_list</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">all_fandoms</span> = <span class="ruby-constant">Fandom</span>.<span class="ruby-identifier">all</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">all_fandoms</span> <span class="ruby-operator">+=</span> [<span class="ruby-keyword">nil</span>] * <span class="ruby-identifier">params</span>[<span class="ruby-string">'max_new_fandoms'</span>].<span class="ruby-identifier">to_i</span>
    <span class="ruby-identifier">new_fandom_func</span> = <span class="ruby-identifier">lambda</span> {
      <span class="ruby-identifier">new_name</span> = <span class="ruby-identifier">random_sentence</span>(<span class="ruby-value">8</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">rand</span>(<span class="ruby-value">4</span>) * <span class="ruby-identifier">rand</span>(<span class="ruby-value">4</span>)))
      <span class="ruby-constant">Fandom</span>.<span class="ruby-identifier">new</span>(
        <span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">new_name</span>
      )
    }

    <span class="ruby-identifier">all_categories</span> = []
    <span class="ruby-identifier">all_warnings</span> = <span class="ruby-constant">Warning</span>.<span class="ruby-identifier">all</span>
    <span class="ruby-identifier">all_ratings</span> = <span class="ruby-constant">Rating</span>.<span class="ruby-identifier">all</span>
    <span class="ruby-identifier">all_characters</span> = <span class="ruby-constant">Character</span>.<span class="ruby-identifier">all</span>
    <span class="ruby-identifier">all_characters</span> <span class="ruby-operator">+=</span> [<span class="ruby-keyword">nil</span>] * <span class="ruby-identifier">params</span>[<span class="ruby-string">'max_new_characters'</span>].<span class="ruby-identifier">to_i</span>
    <span class="ruby-identifier">new_character_func</span> = <span class="ruby-identifier">lambda</span> {
      <span class="ruby-identifier">new_name</span> = <span class="ruby-identifier">random_sentence</span>(<span class="ruby-value">4</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">rand</span>(<span class="ruby-value">12</span>))
       <span class="ruby-constant">Character</span>.<span class="ruby-identifier">find_or_create_by_name</span>(
        <span class="ruby-identifier">new_name</span>
      )
    }
    <span class="ruby-identifier">all_relationships</span> = <span class="ruby-constant">Relationship</span>.<span class="ruby-identifier">all</span>
    <span class="ruby-identifier">all_relationships</span> <span class="ruby-operator">+=</span> [<span class="ruby-keyword">nil</span>] * <span class="ruby-identifier">params</span>[<span class="ruby-string">'max_new_relationships'</span>].<span class="ruby-identifier">to_i</span>
    <span class="ruby-identifier">new_relationship_func</span> = <span class="ruby-identifier">lambda</span> {
      <span class="ruby-identifier">new_name</span> = [<span class="ruby-identifier">random_sentence</span>(<span class="ruby-value">4</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">rand</span>(<span class="ruby-value">12</span>)), <span class="ruby-identifier">random_sentence</span>(<span class="ruby-value">4</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">rand</span>(<span class="ruby-value">12</span>))].<span class="ruby-identifier">join</span>(<span class="ruby-string">'/'</span>)
      <span class="ruby-constant">Relationship</span>.<span class="ruby-identifier">new</span>(
        <span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">new_name</span>
      )
    }

    <span class="ruby-identifier">all_authors</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">all</span>.<span class="ruby-identifier">select</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">login</span>.<span class="ruby-identifier">start_with?</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&quot;author_prefix&quot;</span>]}

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">all_authors</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">push</span> <span class="ruby-string">&quot;Author selection failed&quot;</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">all_authors</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">push</span> <span class="ruby-string">&quot;No authors found.&quot;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># All data gathered</span>

    <span class="ruby-comment"># We'll need to pick or create fandoms, characters, tags, etc, so use a Proc</span>
    <span class="ruby-identifier">pick_or_create</span> = <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">list</span>, <span class="ruby-identifier">create_func</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">item</span> = <span class="ruby-identifier">list</span>.<span class="ruby-identifier">choice</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">item</span> = <span class="ruby-identifier">create_func</span>.<span class="ruby-identifier">call</span>
        <span class="ruby-comment"># Put the new item into the list</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">item</span>
          <span class="ruby-identifier">nil_pos</span> = <span class="ruby-identifier">list</span>.<span class="ruby-identifier">index</span> <span class="ruby-keyword">nil</span>
          <span class="ruby-identifier">list</span>[<span class="ruby-identifier">nil_pos</span><span class="ruby-operator">..</span><span class="ruby-identifier">nil_pos</span>] = <span class="ruby-identifier">item</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">item</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Starting to create #{work_count} works&quot;</span>)

    <span class="ruby-comment"># Now the loop to create works. We just go round, picking/creating random</span>
    <span class="ruby-comment"># data according to the conditions and data above.</span>
    <span class="ruby-comment"># There's a condition written at the end of this loop to skip it if</span>
    <span class="ruby-comment"># we've encountered errors already.</span>
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">work_idx</span> <span class="ruby-keyword">in</span> (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-identifier">work_count</span>)
      <span class="ruby-comment"># Create work</span>
      <span class="ruby-identifier">work_name</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword">do</span>
        <span class="ruby-identifier">len</span> = <span class="ruby-identifier">work_name_length</span>.<span class="ruby-identifier">choice</span>
        <span class="ruby-identifier">random_sentence</span>(<span class="ruby-identifier">len</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">num_fandoms</span> = <span class="ruby-identifier">fandoms_count</span>.<span class="ruby-identifier">choice</span>

      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">fandom_list</span>.<span class="ruby-identifier">empty?</span>
        <span class="ruby-identifier">fandoms</span> = <span class="ruby-identifier">fandom_list</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">fandoms</span> = []
        <span class="ruby-comment"># Randomly choose fandoms</span>
        <span class="ruby-identifier">num_fandoms</span>.<span class="ruby-identifier">times</span> {<span class="ruby-identifier">fandoms</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">pick_or_create</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">all_fandoms</span>, <span class="ruby-identifier">new_fandom_func</span>)}
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">warnings</span> = [<span class="ruby-identifier">all_warnings</span>.<span class="ruby-identifier">choice</span>]
      <span class="ruby-identifier">ratings</span> = [<span class="ruby-identifier">all_ratings</span>.<span class="ruby-identifier">choice</span>]
      <span class="ruby-identifier">num_characters</span> = <span class="ruby-value">2</span>
      <span class="ruby-identifier">num_relationships</span> = <span class="ruby-value">1</span>

      <span class="ruby-comment"># parameterise later</span>
      <span class="ruby-identifier">characters</span> = []
      <span class="ruby-identifier">num_characters</span>.<span class="ruby-identifier">times</span> {<span class="ruby-identifier">characters</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">pick_or_create</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">all_characters</span>, <span class="ruby-identifier">new_character_func</span>)}
      <span class="ruby-identifier">relationships</span> = []
      <span class="ruby-identifier">num_relationships</span>.<span class="ruby-identifier">times</span> {<span class="ruby-identifier">relationships</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">pick_or_create</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">all_relationships</span>, <span class="ruby-identifier">new_relationship_func</span>)}

      <span class="ruby-comment"># Select some random authors</span>
      <span class="ruby-identifier">authors</span> = []
      <span class="ruby-identifier">num_authors</span> = <span class="ruby-identifier">authors_count</span>.<span class="ruby-identifier">choice</span>
      <span class="ruby-identifier">num_authors</span>.<span class="ruby-identifier">times</span> {<span class="ruby-identifier">authors</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">all_authors</span>.<span class="ruby-identifier">choice</span>.<span class="ruby-identifier">pseuds</span>.<span class="ruby-identifier">choice</span>}

      <span class="ruby-keyword">begin</span>
        <span class="ruby-identifier">work</span> = <span class="ruby-identifier">create_work</span>(<span class="ruby-identifier">work_name</span>.<span class="ruby-identifier">call</span>, <span class="ruby-identifier">authors</span>, <span class="ruby-identifier">ratings</span>, <span class="ruby-identifier">warnings</span>, <span class="ruby-identifier">characters</span>, <span class="ruby-identifier">relationships</span>, <span class="ruby-identifier">fandoms</span>, <span class="ruby-identifier">chapter_count</span>.<span class="ruby-identifier">choice</span>, <span class="ruby-identifier">chapter_length</span>.<span class="ruby-identifier">choice</span>)
      <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ex</span>
        <span class="ruby-comment"># I include the backtrace because this is a development server tool.</span>
        <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">push</span> <span class="ruby-node">&quot;EXCEPTION OCURRED '#{ex.message}':&lt;br/&gt;#{ex.backtrace}&quot;</span>
      <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">msg</span>
        <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">msg</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">for</span> <span class="ruby-identifier">chapter</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">work</span>.<span class="ruby-identifier">chapters</span>
        <span class="ruby-keyword">unless</span> <span class="ruby-identifier">chapter</span>.<span class="ruby-identifier">save</span>
          <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">chapter</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">full_messages</span>
          <span class="ruby-keyword">break</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">work</span>.<span class="ruby-identifier">nil?</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">work</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">push</span> <span class="ruby-string">&quot;No work created&quot;</span>
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">work</span>.<span class="ruby-identifier">word_count</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
        <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">push</span> <span class="ruby-string">&quot;No words in work&quot;</span>
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">work</span>.<span class="ruby-identifier">save</span>
        <span class="ruby-identifier">new_works</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">work</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">unless</span> <span class="ruby-identifier">new_works</span>.<span class="ruby-identifier">empty?</span>
          <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">push</span> <span class="ruby-node">&quot;After #{new_works.length} works&quot;</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">push</span> <span class="ruby-node">&quot;Save failed: #{work.errors.full_messages}, #{work}; #{characters.collect(&amp;:name)}&quot;</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">max_errors</span>

      <span class="ruby-comment"># Add comments to work</span>

    <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">empty?</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-string">&quot;Seeding successful&quot;</span>
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-string">&quot;/devmode&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;Error creating #{work_count} works. #{errors.join '\n'}&quot;</span>)
      <span class="ruby-keyword">begin</span>
        <span class="ruby-ivar">@errors</span> = <span class="ruby-string">&quot;Errors: &lt;ul&gt;&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span> <span class="ruby-operator">?</span> (<span class="ruby-string">&quot;&lt;li&gt;&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-string">&quot;join&quot;</span>)<span class="ruby-operator">?</span><span class="ruby-identifier">x</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;&lt;/li&gt;&lt;li&gt;&quot;</span>)<span class="ruby-operator">:</span><span class="ruby-identifier">x</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;&lt;/li&gt;&quot;</span>)<span class="ruby-operator">:</span><span class="ruby-string">''</span>}.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;&lt;/ul&gt;&lt;br /&gt;&lt;ul&gt;&quot;</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&quot;&lt;/ul&gt;&quot;</span>
      <span class="ruby-keyword">rescue</span>
        <span class="ruby-ivar">@errors</span> = <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">inspect</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-comment"># Copy input parameters back to the form defining arrays</span>
      <span class="ruby-keyword">for</span> <span class="ruby-identifier">name</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">params</span>.<span class="ruby-identifier">keys</span>
        <span class="ruby-comment"># convert to a symbol for equality tests</span>
        <span class="ruby-identifier">name_sym</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_sym</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">entry</span> = <span class="ruby-ivar">@params</span>.<span class="ruby-identifier">detect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">name_sym</span>}
          <span class="ruby-identifier">entry</span>[<span class="ruby-value">1</span>][<span class="ruby-value">1</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">name</span>]
          <span class="ruby-comment"># A html hack for checkboxes. (I know, but it's a developer tool)</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">entry</span>[<span class="ruby-value">1</span>][<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value">:checkbox</span>
            <span class="ruby-identifier">entry</span>[<span class="ruby-value">1</span>][<span class="ruby-value">1</span>] = <span class="ruby-string">'&quot; checked=&quot;checked'</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@params</span>.<span class="ruby-identifier">delete</span> <span class="ruby-string">&quot;seed&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- seedworks-source -->
          
        </div>

        

        
      </div><!-- seedworks-method -->

    
      <div id="method-i-unregister_imports" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unregister_imports</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="unregister_imports-source">
            <pre><span class="ruby-comment"># File app/controllers/devmode_controller.rb, line 18</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">unregister_imports</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:okgo</span>]
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">work</span> <span class="ruby-keyword">in</span> <span class="ruby-constant">Work</span>.<span class="ruby-identifier">all</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">work</span>.<span class="ruby-identifier">imported_from_url</span>
        <span class="ruby-identifier">work</span>.<span class="ruby-identifier">imported_from_url</span> = <span class="ruby-keyword">nil</span>
        <span class="ruby-identifier">work</span>.<span class="ruby-identifier">save</span> <span class="ruby-keyword">false</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:info</span>] = <span class="ruby-string">'Successfully cleared URL associations'</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- unregister_imports-source -->
          
        </div>

        

        
      </div><!-- unregister_imports-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.11.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

